var Ht=Object.defineProperty;var et=a=>{throw TypeError(a)};var $t=(a,e,t)=>e in a?Ht(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var g=(a,e,t)=>$t(a,typeof e!="symbol"?e+"":e,t),Ft=(a,e,t)=>e.has(a)||et("Cannot "+t);var tt=(a,e,t)=>e.has(a)?et("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,t);var ke=(a,e,t)=>(Ft(a,e,"access private method"),t);import{i as Bt}from"./index-CUxeV2At.js";import{O as U,Q as w,E as Ut,k as jt,X as Xt,A as Yt,V as it,l as Zt,Y as st,W as ge,i as we,Z as Jt,_ as Kt,$ as qt,j as ce,a0 as Qt,a1 as ei,a2 as ti}from"./controls-CkvDthvl.js";import{e as wt}from"./index-WGadAHdA.js";class ii{}class ae extends ii{constructor(e,t,i){super(),this.viewId=e,this.groupId=t,this.panelId=i}}class ue{constructor(){}static getInstance(){return ue.INSTANCE}hasData(e){return e&&e===this.proto}clearData(e){this.hasData(e)&&(this.proto=void 0,this.data=void 0)}getData(e){if(this.hasData(e))return this.data}setData(e,t){t&&(this.data=e,this.proto=t)}}ue.INSTANCE=new ue;function X(){const a=ue.getInstance();if(a.hasData(ae.prototype))return a.getData(ae.prototype)[0]}var de;(function(a){a.any=(...e)=>t=>{const i=e.map(s=>s(t));return{dispose:()=>{i.forEach(s=>{s.dispose()})}}}})(de||(de={}));class Be{constructor(){this._defaultPrevented=!1}get defaultPrevented(){return this._defaultPrevented}preventDefault(){this._defaultPrevented=!0}}class si{constructor(){this._isAccepted=!1}get isAccepted(){return this._isAccepted}accept(){this._isAccepted=!0}}class ni{constructor(){this.events=new Map}get size(){return this.events.size}add(e,t){this.events.set(e,t)}delete(e){this.events.delete(e)}clear(){this.events.clear()}}class Se{static create(){var e;return new Se((e=new Error().stack)!==null&&e!==void 0?e:"")}constructor(e){this.value=e}print(){console.warn("dockview: stacktrace",this.value)}}class oi{constructor(e,t){this.callback=e,this.stacktrace=t}}class v{static setLeakageMonitorEnabled(e){e!==v.ENABLE_TRACKING&&v.MEMORY_LEAK_WATCHER.clear(),v.ENABLE_TRACKING=e}get value(){return this._last}constructor(e){this.options=e,this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=e=>{var t;!((t=this.options)===null||t===void 0)&&t.replay&&this._last!==void 0&&e(this._last);const i=new oi(e,v.ENABLE_TRACKING?Se.create():void 0);return this._listeners.push(i),{dispose:()=>{const s=this._listeners.indexOf(i);s>-1&&this._listeners.splice(s,1)}}},v.ENABLE_TRACKING&&v.MEMORY_LEAK_WATCHER.add(this._event,Se.create())),this._event}fire(e){this._last=e;for(const t of this._listeners)t.callback(e)}dispose(){this._disposed||(this._disposed=!0,this._listeners.length>0&&(v.ENABLE_TRACKING&&queueMicrotask(()=>{var e;for(const t of this._listeners)console.warn("dockview: stacktrace",(e=t.stacktrace)===null||e===void 0?void 0:e.print())}),this._listeners=[]),v.ENABLE_TRACKING&&this._event&&v.MEMORY_LEAK_WATCHER.delete(this._event))}}v.ENABLE_TRACKING=!1;v.MEMORY_LEAK_WATCHER=new ni;function G(a,e,t,i){return a.addEventListener(e,t,i),{dispose:()=>{a.removeEventListener(e,t,i)}}}class nt{constructor(){this._onFired=new v,this._currentFireCount=0,this._queued=!1,this.onEvent=e=>{const t=this._currentFireCount;return this._onFired.event(()=>{this._currentFireCount>t&&e()})}}fire(){this._currentFireCount++,!this._queued&&(this._queued=!0,queueMicrotask(()=>{this._queued=!1,this._onFired.fire()}))}dispose(){this._onFired.dispose()}}var F;(function(a){a.NONE={dispose:()=>{}};function e(t){return{dispose:()=>{t()}}}a.from=e})(F||(F={}));class z{get isDisposed(){return this._isDisposed}constructor(...e){this._isDisposed=!1,this._disposables=e}addDisposables(...e){e.forEach(t=>this._disposables.push(t))}dispose(){this._isDisposed||(this._isDisposed=!0,this._disposables.forEach(e=>e.dispose()),this._disposables=[])}}class J{constructor(){this._disposable=F.NONE}set value(e){this._disposable&&this._disposable.dispose(),this._disposable=e}dispose(){this._disposable&&(this._disposable.dispose(),this._disposable=F.NONE)}}class ri extends z{constructor(e){super(),this._onDidChange=new v,this.onDidChange=this._onDidChange.event,this._value=null,this.addDisposables(this._onDidChange,Ge(e,t=>{const i=t.target.scrollWidth>t.target.clientWidth,s=t.target.scrollHeight>t.target.clientHeight;this._value={hasScrollX:i,hasScrollY:s},this._onDidChange.fire(this._value)}))}}function Ge(a,e){const t=new ResizeObserver(i=>{requestAnimationFrame(()=>{const s=i[0];e(s)})});return t.observe(a),{dispose:()=>{t.unobserve(a),t.disconnect()}}}const Ne=(a,...e)=>{for(const t of e)a.classList.contains(t)&&a.classList.remove(t)},bt=(a,...e)=>{for(const t of e)a.classList.contains(t)||a.classList.add(t)},E=(a,e,t)=>{const i=a.classList.contains(e);t&&!i&&a.classList.add(e),!t&&i&&a.classList.remove(e)};function We(a,e){for(;a;){if(a===e)return!0;a=a.parentNode}return!1}function Dt(a){return new ai(a)}class ai extends z{constructor(e){super(),this._onDidFocus=new v,this.onDidFocus=this._onDidFocus.event,this._onDidBlur=new v,this.onDidBlur=this._onDidBlur.event,this.addDisposables(this._onDidFocus,this._onDidBlur);let t=We(document.activeElement,e),i=!1;const s=()=>{i=!1,t||(t=!0,this._onDidFocus.fire())},n=()=>{t&&(i=!0,window.setTimeout(()=>{i&&(i=!1,t=!1,this._onDidBlur.fire())},0))};this._refreshStateHandler=()=>{We(document.activeElement,e)!==t&&(t?n():s())},this.addDisposables(G(e,"focus",s,!0)),this.addDisposables(G(e,"blur",n,!0))}refreshState(){this._refreshStateHandler()}}const yt="dv-quasiPreventDefault";function li(a){a[yt]=!0}function ot(a){return a[yt]}function hi(a,e){const t=Array.from(e);for(const i of t){if(i.href){const n=a.createElement("link");n.href=i.href,n.type=i.type,n.rel="stylesheet",a.head.appendChild(n)}let s=[];try{i.cssRules&&(s=Array.from(i.cssRules).map(n=>n.cssText))}catch{}for(const n of s){const o=a.createElement("style");o.appendChild(a.createTextNode(n)),a.head.appendChild(o)}}}function Ee(a){const{left:e,top:t,width:i,height:s}=a.getBoundingClientRect();return{left:e+window.scrollX,top:t+window.scrollY,width:i,height:s}}function di(a){let e=a;for(;e!=null&&e.parentNode;){if(e.parentNode===document)return!0;e.parentNode instanceof DocumentFragment?e=e.parentNode.host:e=e.parentNode}return!1}function ci(a,e){a.setAttribute("data-testid",e)}function ui(a){const e=[];function t(i){if(i.nodeType===Node.ELEMENT_NODE){a.includes(i.tagName)&&e.push(i),i.shadowRoot&&t(i.shadowRoot);for(const s of i.children)t(s)}}return t(document.documentElement),e}function Pe(a=document){const e=ui(["IFRAME","WEBVIEW"]),t=new WeakMap;for(const i of e)t.set(i,i.style.pointerEvents),i.style.pointerEvents="none";return{release:()=>{var i;for(const s of e)s.style.pointerEvents=(i=t.get(s))!==null&&i!==void 0?i:"auto";e.splice(0,e.length)}}}function pi(a){function e(s){const n=[];for(let o=0;o<s.classList.length;o++)n.push(s.classList.item(o));return n}let t,i=a;for(;i!==null&&(t=e(i).find(s=>s.startsWith("dockview-theme-")),typeof t!="string");)i=i.parentElement;return t}class Ct{constructor(e){this.element=e,this._classNames=[]}setClassNames(e){for(const t of this._classNames)E(this.element,t,!1);this._classNames=e.split(" ").filter(t=>t.trim().length>0);for(const t of this._classNames)E(this.element,t,!0)}}const xt=100;function mi(a,e){const t=Ee(a),i=Ee(e);return!(t.left<i.left||t.left+t.width>i.left+i.width)}function vi(a){const e=new v;let t=a.screenX,i=a.screenY,s;const n=()=>{if(a.closed)return;const o=a.screenX,l=a.screenY;(o!==t||l!==i)&&(clearTimeout(s),s=setTimeout(()=>{e.fire()},xt),t=o,i=l),requestAnimationFrame(n)};return n(),e}function gi(a,e){let t;return new z(G(a,"resize",()=>{clearTimeout(t),t=setTimeout(()=>{e()},xt)}))}function he(a){if(a.length===0)throw new Error("Invalid tail call");return[a.slice(0,a.length-1),a[a.length-1]]}function fi(a,e){if(a.length!==e.length)return!1;for(let t=0;t<a.length;t++)if(a[t]!==e[t])return!1;return!0}function Te(a,e){const t=a.indexOf(e);t>-1&&(a.splice(t,1),a.unshift(e))}function ye(a,e){const t=a.indexOf(e);t>-1&&(a.splice(t,1),a.push(e))}function _i(a,e){for(let t=0;t<a.length;t++){const i=a[t];if(e(i))return t}return-1}function Ve(a,e){const t=a.findIndex(i=>i===e);return t>-1?(a.splice(t,1),!0):!1}const V=(a,e,t)=>e>t?e:Math.min(t,Math.max(a,e)),At=()=>{let a=1;return{next:()=>(a++).toString()}},q=(a,e)=>{const t=[];if(typeof e!="number"&&(e=a,a=0),a<=e)for(let i=a;i<e;i++)t.push(i);else for(let i=a;i>e;i--)t.push(i);return t};class wi{set size(e){this._size=e}get size(){return this._size}get cachedVisibleSize(){return this._cachedVisibleSize}get visible(){return typeof this._cachedVisibleSize>"u"}get minimumSize(){return this.visible?this.view.minimumSize:0}get viewMinimumSize(){return this.view.minimumSize}get maximumSize(){return this.visible?this.view.maximumSize:0}get viewMaximumSize(){return this.view.maximumSize}get priority(){return this.view.priority}get snap(){return!!this.view.snap}set enabled(e){this.container.style.pointerEvents=e?"":"none"}constructor(e,t,i,s){this.container=e,this.view=t,this.disposable=s,this._cachedVisibleSize=void 0,typeof i=="number"?(this._size=i,this._cachedVisibleSize=void 0,e.classList.add("visible")):(this._size=0,this._cachedVisibleSize=i.cachedVisibleSize)}setVisible(e,t){var i;e!==this.visible&&(e?(this.size=V((i=this._cachedVisibleSize)!==null&&i!==void 0?i:0,this.viewMinimumSize,this.viewMaximumSize),this._cachedVisibleSize=void 0):(this._cachedVisibleSize=typeof t=="number"?t:this.size,this.size=0),this.container.classList.toggle("visible",e),this.view.setVisible&&this.view.setVisible(e))}dispose(){return this.disposable.dispose(),this.view}}var P;(function(a){a.HORIZONTAL="HORIZONTAL",a.VERTICAL="VERTICAL"})(P||(P={}));var Z;(function(a){a[a.MAXIMUM=0]="MAXIMUM",a[a.MINIMUM=1]="MINIMUM",a[a.DISABLED=2]="DISABLED",a[a.ENABLED=3]="ENABLED"})(Z||(Z={}));var $;(function(a){a.Low="low",a.High="high",a.Normal="normal"})($||($={}));var ne;(function(a){a.Distribute={type:"distribute"};function e(i){return{type:"split",index:i}}a.Split=e;function t(i){return{type:"invisible",cachedVisibleSize:i}}a.Invisible=t})(ne||(ne={}));class rt{get contentSize(){return this._contentSize}get size(){return this._size}set size(e){this._size=e}get orthogonalSize(){return this._orthogonalSize}set orthogonalSize(e){this._orthogonalSize=e}get length(){return this.viewItems.length}get proportions(){return this._proportions?[...this._proportions]:void 0}get orientation(){return this._orientation}set orientation(e){this._orientation=e;const t=this.size;this.size=this.orthogonalSize,this.orthogonalSize=t,Ne(this.element,"dv-horizontal","dv-vertical"),this.element.classList.add(this.orientation==P.HORIZONTAL?"dv-horizontal":"dv-vertical")}get minimumSize(){return this.viewItems.reduce((e,t)=>e+t.minimumSize,0)}get maximumSize(){return this.length===0?Number.POSITIVE_INFINITY:this.viewItems.reduce((e,t)=>e+t.maximumSize,0)}get startSnappingEnabled(){return this._startSnappingEnabled}set startSnappingEnabled(e){this._startSnappingEnabled!==e&&(this._startSnappingEnabled=e,this.updateSashEnablement())}get endSnappingEnabled(){return this._endSnappingEnabled}set endSnappingEnabled(e){this._endSnappingEnabled!==e&&(this._endSnappingEnabled=e,this.updateSashEnablement())}get disabled(){return this._disabled}set disabled(e){this._disabled=e,E(this.element,"dv-splitview-disabled",e)}get margin(){return this._margin}set margin(e){this._margin=e,E(this.element,"dv-splitview-has-margin",e!==0)}constructor(e,t){var i,s;this.container=e,this.viewItems=[],this.sashes=[],this._size=0,this._orthogonalSize=0,this._contentSize=0,this._proportions=void 0,this._startSnappingEnabled=!0,this._endSnappingEnabled=!0,this._disabled=!1,this._margin=0,this._onDidSashEnd=new v,this.onDidSashEnd=this._onDidSashEnd.event,this._onDidAddView=new v,this.onDidAddView=this._onDidAddView.event,this._onDidRemoveView=new v,this.onDidRemoveView=this._onDidRemoveView.event,this.resize=(n,o,l=this.viewItems.map(f=>f.size),r,d,h=Number.NEGATIVE_INFINITY,c=Number.POSITIVE_INFINITY,m,p)=>{if(n<0||n>this.viewItems.length)return 0;const f=q(n,-1),u=q(n+1,this.viewItems.length);if(d)for(const b of d)Te(f,b),Te(u,b);if(r)for(const b of r)ye(f,b),ye(u,b);const _=f.map(b=>this.viewItems[b]),A=f.map(b=>l[b]),y=u.map(b=>this.viewItems[b]),C=u.map(b=>l[b]),x=f.reduce((b,S)=>b+this.viewItems[S].minimumSize-l[S],0),I=f.reduce((b,S)=>b+this.viewItems[S].maximumSize-l[S],0),D=u.length===0?Number.POSITIVE_INFINITY:u.reduce((b,S)=>b+l[S]-this.viewItems[S].minimumSize,0),H=u.length===0?Number.NEGATIVE_INFINITY:u.reduce((b,S)=>b+l[S]-this.viewItems[S].maximumSize,0),W=Math.max(x,H),L=Math.min(D,I);let k=!1;if(m){const b=this.viewItems[m.index],S=o>=m.limitDelta;k=S!==b.visible,b.setVisible(S,m.size)}if(!k&&p){const b=this.viewItems[p.index],S=o<p.limitDelta;k=S!==b.visible,b.setVisible(S,p.size)}if(k)return this.resize(n,o,l,r,d,h,c);const K=V(o,W,L);let ee=0,T=K;for(let b=0;b<_.length;b++){const S=_[b],N=V(A[b]+T,S.minimumSize,S.maximumSize),le=N-A[b];ee+=le,T-=le,S.size=N}let M=ee;for(let b=0;b<y.length;b++){const S=y[b],N=V(C[b]-M,S.minimumSize,S.maximumSize),le=N-C[b];M+=le,S.size=N}return o},this._orientation=(i=t.orientation)!==null&&i!==void 0?i:P.VERTICAL,this.element=this.createContainer(),this.margin=(s=t.margin)!==null&&s!==void 0?s:0,this.proportionalLayout=t.proportionalLayout===void 0?!0:!!t.proportionalLayout,this.viewContainer=this.createViewContainer(),this.sashContainer=this.createSashContainer(),this.element.appendChild(this.sashContainer),this.element.appendChild(this.viewContainer),this.container.appendChild(this.element),this.style(t.styles),t.descriptor&&(this._size=t.descriptor.size,t.descriptor.views.forEach((n,o)=>{const l=n.visible===void 0||n.visible?n.size:{type:"invisible",cachedVisibleSize:n.size},r=n.view;this.addView(r,l,o,!0)}),this._contentSize=this.viewItems.reduce((n,o)=>n+o.size,0),this.saveProportions())}style(e){(e==null?void 0:e.separatorBorder)==="transparent"?(Ne(this.element,"dv-separator-border"),this.element.style.removeProperty("--dv-separator-border")):(bt(this.element,"dv-separator-border"),e!=null&&e.separatorBorder&&this.element.style.setProperty("--dv-separator-border",e.separatorBorder))}isViewVisible(e){if(e<0||e>=this.viewItems.length)throw new Error("Index out of bounds");return this.viewItems[e].visible}setViewVisible(e,t){if(e<0||e>=this.viewItems.length)throw new Error("Index out of bounds");const i=this.viewItems[e];i.setVisible(t,i.size),this.distributeEmptySpace(e),this.layoutViews(),this.saveProportions()}getViewSize(e){return e<0||e>=this.viewItems.length?-1:this.viewItems[e].size}resizeView(e,t){if(e<0||e>=this.viewItems.length)return;const i=q(this.viewItems.length).filter(l=>l!==e),s=[...i.filter(l=>this.viewItems[l].priority===$.Low),e],n=i.filter(l=>this.viewItems[l].priority===$.High),o=this.viewItems[e];t=Math.round(t),t=V(t,o.minimumSize,Math.min(o.maximumSize,this._size)),o.size=t,this.relayout(s,n)}getViews(){return this.viewItems.map(e=>e.view)}onDidChange(e,t){const i=this.viewItems.indexOf(e);if(i<0||i>=this.viewItems.length)return;t=typeof t=="number"?t:e.size,t=V(t,e.minimumSize,e.maximumSize),e.size=t;const s=q(this.viewItems.length).filter(l=>l!==i),n=[...s.filter(l=>this.viewItems[l].priority===$.Low),i],o=s.filter(l=>this.viewItems[l].priority===$.High);this.relayout([...n,i],o)}addView(e,t={type:"distribute"},i=this.viewItems.length,s){const n=document.createElement("div");n.className="dv-view",n.appendChild(e.element);let o;typeof t=="number"?o=t:t.type==="split"?o=this.getViewSize(t.index)/2:t.type==="invisible"?o={cachedVisibleSize:t.cachedVisibleSize}:o=e.minimumSize;const l=e.onDidChange(d=>this.onDidChange(r,d.size)),r=new wi(n,e,o,{dispose:()=>{l.dispose(),this.viewContainer.removeChild(n)}});if(i===this.viewItems.length?this.viewContainer.appendChild(n):this.viewContainer.insertBefore(n,this.viewContainer.children.item(i)),this.viewItems.splice(i,0,r),this.viewItems.length>1){const d=document.createElement("div");d.className="dv-sash";const h=m=>{for(const b of this.viewItems)b.enabled=!1;const p=Pe(),f=this._orientation===P.HORIZONTAL?m.clientX:m.clientY,u=_i(this.sashes,b=>b.container===d),_=this.viewItems.map(b=>b.size);let A,y;const C=q(u,-1),x=q(u+1,this.viewItems.length),I=C.reduce((b,S)=>b+(this.viewItems[S].minimumSize-_[S]),0),D=C.reduce((b,S)=>b+(this.viewItems[S].viewMaximumSize-_[S]),0),H=x.length===0?Number.POSITIVE_INFINITY:x.reduce((b,S)=>b+(_[S]-this.viewItems[S].minimumSize),0),W=x.length===0?Number.NEGATIVE_INFINITY:x.reduce((b,S)=>b+(_[S]-this.viewItems[S].viewMaximumSize),0),L=Math.max(I,W),k=Math.min(H,D),K=this.findFirstSnapIndex(C),ee=this.findFirstSnapIndex(x);if(typeof K=="number"){const b=this.viewItems[K],S=Math.floor(b.viewMinimumSize/2);A={index:K,limitDelta:b.visible?L-S:L+S,size:b.size}}if(typeof ee=="number"){const b=this.viewItems[ee],S=Math.floor(b.viewMinimumSize/2);y={index:ee,limitDelta:b.visible?k+S:k-S,size:b.size}}const T=b=>{const N=(this._orientation===P.HORIZONTAL?b.clientX:b.clientY)-f;this.resize(u,N,_,void 0,void 0,L,k,A,y),this.distributeEmptySpace(),this.layoutViews()},M=()=>{for(const b of this.viewItems)b.enabled=!0;p.release(),this.saveProportions(),document.removeEventListener("pointermove",T),document.removeEventListener("pointerup",M),document.removeEventListener("pointercancel",M),this._onDidSashEnd.fire(void 0)};document.addEventListener("pointermove",T),document.addEventListener("pointerup",M),document.addEventListener("pointercancel",M)};d.addEventListener("pointerdown",h);const c={container:d,disposable:()=>{d.removeEventListener("pointerdown",h),this.sashContainer.removeChild(d)}};this.sashContainer.appendChild(d),this.sashes.push(c)}s||this.relayout([i]),!s&&typeof t!="number"&&t.type==="distribute"&&this.distributeViewSizes(),this._onDidAddView.fire(e)}distributeViewSizes(){const e=[];let t=0;for(const l of this.viewItems)l.maximumSize-l.minimumSize>0&&(e.push(l),t+=l.size);const i=Math.floor(t/e.length);for(const l of e)l.size=V(i,l.minimumSize,l.maximumSize);const s=q(this.viewItems.length),n=s.filter(l=>this.viewItems[l].priority===$.Low),o=s.filter(l=>this.viewItems[l].priority===$.High);this.relayout(n,o)}removeView(e,t,i=!1){const s=this.viewItems.splice(e,1)[0];if(s.dispose(),this.viewItems.length>=1){const n=Math.max(e-1,0);this.sashes.splice(n,1)[0].disposable()}return i||this.relayout(),t&&t.type==="distribute"&&this.distributeViewSizes(),this._onDidRemoveView.fire(s.view),s.view}getViewCachedVisibleSize(e){if(e<0||e>=this.viewItems.length)throw new Error("Index out of bounds");return this.viewItems[e].cachedVisibleSize}moveView(e,t){const i=this.getViewCachedVisibleSize(e),s=typeof i>"u"?this.getViewSize(e):ne.Invisible(i),n=this.removeView(e,void 0,!0);this.addView(n,s,t)}layout(e,t){const i=Math.max(this.size,this._contentSize);if(this.size=e,this.orthogonalSize=t,this.proportions){let s=0;for(let n=0;n<this.viewItems.length;n++){const o=this.viewItems[n],l=this.proportions[n];typeof l=="number"?s+=l:e-=o.size}for(let n=0;n<this.viewItems.length;n++){const o=this.viewItems[n],l=this.proportions[n];typeof l=="number"&&s>0&&(o.size=V(Math.round(l*e/s),o.minimumSize,o.maximumSize))}}else{const s=q(this.viewItems.length),n=s.filter(l=>this.viewItems[l].priority===$.Low),o=s.filter(l=>this.viewItems[l].priority===$.High);this.resize(this.viewItems.length-1,e-i,void 0,n,o)}this.distributeEmptySpace(),this.layoutViews()}relayout(e,t){const i=this.viewItems.reduce((s,n)=>s+n.size,0);this.resize(this.viewItems.length-1,this._size-i,void 0,e,t),this.distributeEmptySpace(),this.layoutViews(),this.saveProportions()}distributeEmptySpace(e){const t=this.viewItems.reduce((l,r)=>l+r.size,0);let i=this.size-t;const s=q(this.viewItems.length-1,-1),n=s.filter(l=>this.viewItems[l].priority===$.Low),o=s.filter(l=>this.viewItems[l].priority===$.High);for(const l of o)Te(s,l);for(const l of n)ye(s,l);typeof e=="number"&&ye(s,e);for(let l=0;i!==0&&l<s.length;l++){const r=this.viewItems[s[l]],d=V(r.size+i,r.minimumSize,r.maximumSize),h=d-r.size;i-=h,r.size=d}}saveProportions(){this.proportionalLayout&&this._contentSize>0&&(this._proportions=this.viewItems.map(e=>e.visible?e.size/this._contentSize:void 0))}layoutViews(){if(this._contentSize=this.viewItems.reduce((r,d)=>r+d.size,0),this.updateSashEnablement(),this.viewItems.length===0)return;const e=this.viewItems.filter(r=>r.visible),t=Math.max(0,e.length-1),i=this.margin*t/Math.max(1,e.length);let s=0;const n=[],o=4,l=this.viewItems.reduce((r,d,h)=>{const c=d.visible?1:0;return h===0?r.push(c):r.push(r[h-1]+c),r},[]);this.viewItems.forEach((r,d)=>{s+=this.viewItems[d].size,n.push(s);const h=r.visible?r.size-i:0,c=Math.max(0,l[d]-1),m=d===0||c===0?0:n[d-1]+c/t*i;if(d<this.viewItems.length-1){const p=r.visible?m+h-o/2+this.margin/2:m;this._orientation===P.HORIZONTAL&&(this.sashes[d].container.style.left=`${p}px`,this.sashes[d].container.style.top="0px"),this._orientation===P.VERTICAL&&(this.sashes[d].container.style.left="0px",this.sashes[d].container.style.top=`${p}px`)}this._orientation===P.HORIZONTAL&&(r.container.style.width=`${h}px`,r.container.style.left=`${m}px`,r.container.style.top="",r.container.style.height=""),this._orientation===P.VERTICAL&&(r.container.style.height=`${h}px`,r.container.style.top=`${m}px`,r.container.style.width="",r.container.style.left=""),r.view.layout(r.size-i,this._orthogonalSize)})}findFirstSnapIndex(e){for(const t of e){const i=this.viewItems[t];if(i.visible&&i.snap)return t}for(const t of e){const i=this.viewItems[t];if(i.visible&&i.maximumSize-i.minimumSize>0)return;if(!i.visible&&i.snap)return t}}updateSashEnablement(){let e=!1;const t=this.viewItems.map(r=>e=r.size-r.minimumSize>0||e);e=!1;const i=this.viewItems.map(r=>e=r.maximumSize-r.size>0||e),s=[...this.viewItems].reverse();e=!1;const n=s.map(r=>e=r.size-r.minimumSize>0||e).reverse();e=!1;const o=s.map(r=>e=r.maximumSize-r.size>0||e).reverse();let l=0;for(let r=0;r<this.sashes.length;r++){const d=this.sashes[r],h=this.viewItems[r];l+=h.size;const c=!(t[r]&&o[r+1]),m=!(i[r]&&n[r+1]);if(c&&m){const p=q(r,-1),f=q(r+1,this.viewItems.length),u=this.findFirstSnapIndex(p),_=this.findFirstSnapIndex(f),A=typeof u=="number"&&!this.viewItems[u].visible,y=typeof _=="number"&&!this.viewItems[_].visible;A&&n[r]&&(l>0||this.startSnappingEnabled)?this.updateSash(d,Z.MINIMUM):y&&t[r]&&(l<this._contentSize||this.endSnappingEnabled)?this.updateSash(d,Z.MAXIMUM):this.updateSash(d,Z.DISABLED)}else c&&!m?this.updateSash(d,Z.MINIMUM):!c&&m?this.updateSash(d,Z.MAXIMUM):this.updateSash(d,Z.ENABLED)}}updateSash(e,t){E(e.container,"dv-disabled",t===Z.DISABLED),E(e.container,"dv-enabled",t===Z.ENABLED),E(e.container,"dv-maximum",t===Z.MAXIMUM),E(e.container,"dv-minimum",t===Z.MINIMUM)}createViewContainer(){const e=document.createElement("div");return e.className="dv-view-container",e}createSashContainer(){const e=document.createElement("div");return e.className="dv-sash-container",e}createContainer(){const e=document.createElement("div"),t=this._orientation===P.HORIZONTAL?"dv-horizontal":"dv-vertical";return e.className=`dv-split-view-container ${t}`,e}dispose(){this._onDidSashEnd.dispose(),this._onDidAddView.dispose(),this._onDidRemoveView.dispose();for(let e=0;e<this.element.children.length;e++)if(this.element.children.item(e)===this.element){this.element.removeChild(this.element);break}for(const e of this.viewItems)e.dispose();this.element.remove()}}class j{get minimumWidth(){return this.view.minimumWidth}get maximumWidth(){return this.view.maximumWidth}get minimumHeight(){return this.view.minimumHeight}get maximumHeight(){return this.view.maximumHeight}get priority(){return this.view.priority}get snap(){return this.view.snap}get minimumSize(){return this.orientation===P.HORIZONTAL?this.minimumHeight:this.minimumWidth}get maximumSize(){return this.orientation===P.HORIZONTAL?this.maximumHeight:this.maximumWidth}get minimumOrthogonalSize(){return this.orientation===P.HORIZONTAL?this.minimumWidth:this.minimumHeight}get maximumOrthogonalSize(){return this.orientation===P.HORIZONTAL?this.maximumWidth:this.maximumHeight}get orthogonalSize(){return this._orthogonalSize}get size(){return this._size}get element(){return this.view.element}get width(){return this.orientation===P.HORIZONTAL?this.orthogonalSize:this.size}get height(){return this.orientation===P.HORIZONTAL?this.size:this.orthogonalSize}constructor(e,t,i,s=0){this.view=e,this.orientation=t,this._onDidChange=new v,this.onDidChange=this._onDidChange.event,this._orthogonalSize=i,this._size=s,this._disposable=this.view.onDidChange(n=>{n?this._onDidChange.fire({size:this.orientation===P.VERTICAL?n.width:n.height,orthogonalSize:this.orientation===P.VERTICAL?n.height:n.width}):this._onDidChange.fire({})})}setVisible(e){this.view.setVisible&&this.view.setVisible(e)}layout(e,t){this._size=e,this._orthogonalSize=t,this.view.layout(this.width,this.height)}dispose(){this._onDidChange.dispose(),this._disposable.dispose()}}class R extends z{get width(){return this.orientation===P.HORIZONTAL?this.size:this.orthogonalSize}get height(){return this.orientation===P.HORIZONTAL?this.orthogonalSize:this.size}get minimumSize(){return this.children.length===0?0:Math.max(...this.children.map((e,t)=>this.splitview.isViewVisible(t)?e.minimumOrthogonalSize:0))}get maximumSize(){return Math.min(...this.children.map((e,t)=>this.splitview.isViewVisible(t)?e.maximumOrthogonalSize:Number.POSITIVE_INFINITY))}get minimumOrthogonalSize(){return this.splitview.minimumSize}get maximumOrthogonalSize(){return this.splitview.maximumSize}get orthogonalSize(){return this._orthogonalSize}get size(){return this._size}get minimumWidth(){return this.orientation===P.HORIZONTAL?this.minimumOrthogonalSize:this.minimumSize}get minimumHeight(){return this.orientation===P.HORIZONTAL?this.minimumSize:this.minimumOrthogonalSize}get maximumWidth(){return this.orientation===P.HORIZONTAL?this.maximumOrthogonalSize:this.maximumSize}get maximumHeight(){return this.orientation===P.HORIZONTAL?this.maximumSize:this.maximumOrthogonalSize}get priority(){if(this.children.length===0)return $.Normal;const e=this.children.map(t=>typeof t.priority>"u"?$.Normal:t.priority);return e.some(t=>t===$.High)?$.High:e.some(t=>t===$.Low)?$.Low:$.Normal}get disabled(){return this.splitview.disabled}set disabled(e){this.splitview.disabled=e}get margin(){return this.splitview.margin}set margin(e){this.splitview.margin=e,this.children.forEach(t=>{t instanceof R&&(t.margin=e)})}constructor(e,t,i,s,n,o,l,r){if(super(),this.orientation=e,this.proportionalLayout=t,this.styles=i,this._childrenDisposable=F.NONE,this.children=[],this._onDidChange=new v,this.onDidChange=this._onDidChange.event,this._onDidVisibilityChange=new v,this.onDidVisibilityChange=this._onDidVisibilityChange.event,this._orthogonalSize=n,this._size=s,this.element=document.createElement("div"),this.element.className="dv-branch-node",!r)this.splitview=new rt(this.element,{orientation:this.orientation,proportionalLayout:t,styles:i,margin:l}),this.splitview.layout(this.size,this.orthogonalSize);else{const d={views:r.map(h=>({view:h.node,size:h.node.size,visible:h.node instanceof j&&h.visible!==void 0?h.visible:!0})),size:this.orthogonalSize};this.children=r.map(h=>h.node),this.splitview=new rt(this.element,{orientation:this.orientation,descriptor:d,proportionalLayout:t,styles:i,margin:l})}this.disabled=o,this.addDisposables(this._onDidChange,this._onDidVisibilityChange,this.splitview.onDidSashEnd(()=>{this._onDidChange.fire({})})),this.setupChildrenEvents()}setVisible(e){}isChildVisible(e){if(e<0||e>=this.children.length)throw new Error("Invalid index");return this.splitview.isViewVisible(e)}setChildVisible(e,t){if(e<0||e>=this.children.length)throw new Error("Invalid index");if(this.splitview.isViewVisible(e)===t)return;const i=this.splitview.contentSize===0;this.splitview.setViewVisible(e,t);const s=this.splitview.contentSize===0;(t&&i||!t&&s)&&this._onDidVisibilityChange.fire({visible:t})}moveChild(e,t){if(e===t)return;if(e<0||e>=this.children.length)throw new Error("Invalid from index");e<t&&t--,this.splitview.moveView(e,t);const i=this._removeChild(e);this._addChild(i,t)}getChildSize(e){if(e<0||e>=this.children.length)throw new Error("Invalid index");return this.splitview.getViewSize(e)}resizeChild(e,t){if(e<0||e>=this.children.length)throw new Error("Invalid index");this.splitview.resizeView(e,t)}layout(e,t){this._size=t,this._orthogonalSize=e,this.splitview.layout(t,e)}addChild(e,t,i,s){if(i<0||i>this.children.length)throw new Error("Invalid index");this.splitview.addView(e,t,i,s),this._addChild(e,i)}getChildCachedVisibleSize(e){if(e<0||e>=this.children.length)throw new Error("Invalid index");return this.splitview.getViewCachedVisibleSize(e)}removeChild(e,t){if(e<0||e>=this.children.length)throw new Error("Invalid index");return this.splitview.removeView(e,t),this._removeChild(e)}_addChild(e,t){this.children.splice(t,0,e),this.setupChildrenEvents()}_removeChild(e){const[t]=this.children.splice(e,1);return this.setupChildrenEvents(),t}setupChildrenEvents(){this._childrenDisposable.dispose(),this._childrenDisposable=new z(de.any(...this.children.map(e=>e.onDidChange))(e=>{this._onDidChange.fire({size:e.orthogonalSize})}),...this.children.map((e,t)=>e instanceof R?e.onDidVisibilityChange(({visible:i})=>{this.setChildVisible(t,i)}):F.NONE))}dispose(){this._childrenDisposable.dispose(),this.splitview.dispose(),this.children.forEach(e=>e.dispose()),super.dispose()}}function Re(a,e){if(a instanceof j)return a;if(a instanceof R)return Re(a.children[e?a.children.length-1:0],e);throw new Error("invalid node")}function He(a,e,t){if(a instanceof R){const i=new R(ie(a.orientation),a.proportionalLayout,a.styles,e,t,a.disabled,a.margin);let s=0;for(let n=a.children.length-1;n>=0;n--){const o=a.children[n],l=o instanceof R?o.orthogonalSize:o.size;let r=a.size===0?0:Math.round(e*l/a.size);s+=r,n===0&&(r+=e-s),i.addChild(He(o,t,r),r,0,!0)}return i}else return new j(a.view,ie(a.orientation),t)}function bi(a){const e=a.parentElement;if(!e)throw new Error("Invalid grid element");let t=e.firstElementChild,i=0;for(;t!==a&&t!==e.lastElementChild&&t;)t=t.nextElementSibling,i++;return i}function B(a){const e=a.parentElement;if(!e)throw new Error("Invalid grid element");if(/\bdv-grid-view\b/.test(e.className))return[];const t=bi(e),i=e.parentElement.parentElement.parentElement;return[...B(i),t]}function me(a,e,t){const i=yi(a,e),s=Di(t);if(i===s){const[n,o]=he(e);let l=o;return(t==="right"||t==="bottom")&&(l+=1),[...n,l]}else{const n=t==="right"||t==="bottom"?1:0;return[...e,n]}}function Di(a){return a==="top"||a==="bottom"?P.VERTICAL:P.HORIZONTAL}function yi(a,e){return e.length%2===0?ie(a):a}const ie=a=>a===P.HORIZONTAL?P.VERTICAL:P.HORIZONTAL;function Ci(a){return!!a.children}const $e=(a,e)=>{const t=e===P.VERTICAL?a.box.width:a.box.height;return Ci(a)?{type:"branch",data:a.children.map(i=>$e(i,ie(e))),size:t}:typeof a.cachedVisibleSize=="number"?{type:"leaf",data:a.view.toJSON(),size:a.cachedVisibleSize,visible:!1}:{type:"leaf",data:a.view.toJSON(),size:t}};class xi{get length(){return this._root?this._root.children.length:0}get orientation(){return this.root.orientation}set orientation(e){if(this.root.orientation===e)return;const{size:t,orthogonalSize:i}=this.root;this.root=He(this.root,i,t),this.root.layout(t,i)}get width(){return this.root.width}get height(){return this.root.height}get minimumWidth(){return this.root.minimumWidth}get minimumHeight(){return this.root.minimumHeight}get maximumWidth(){return this.root.maximumHeight}get maximumHeight(){return this.root.maximumHeight}get locked(){return this._locked}set locked(e){this._locked=e;const t=[this.root];for(;t.length>0;){const i=t.pop();i instanceof R&&(i.disabled=e,t.push(...i.children))}}get margin(){return this._margin}set margin(e){this._margin=e,this.root.margin=e}maximizedView(){var e;return(e=this._maximizedNode)===null||e===void 0?void 0:e.leaf.view}hasMaximizedView(){return this._maximizedNode!==void 0}maximizeView(e){var t;const i=B(e.element),[s,n]=this.getNode(i);if(!(n instanceof j)||((t=this._maximizedNode)===null||t===void 0?void 0:t.leaf)===n)return;this.hasMaximizedView()&&this.exitMaximizedView(),$e(this.getView(),this.orientation);const o=[];function l(r,d){for(let h=0;h<r.children.length;h++){const c=r.children[h];c instanceof j?c!==d&&(r.isChildVisible(h)?r.setChildVisible(h,!1):o.push(c)):l(c,d)}}l(this.root,n),this._maximizedNode={leaf:n,hiddenOnMaximize:o},this._onDidMaximizedNodeChange.fire({view:n.view,isMaximized:!0})}exitMaximizedView(){if(!this._maximizedNode)return;const e=this._maximizedNode.hiddenOnMaximize;function t(s){for(let n=s.children.length-1;n>=0;n--){const o=s.children[n];o instanceof j?e.includes(o)||s.setChildVisible(n,!0):t(o)}}t(this.root);const i=this._maximizedNode.leaf;this._maximizedNode=void 0,this._onDidMaximizedNodeChange.fire({view:i.view,isMaximized:!1})}serialize(){const e=this.maximizedView();let t;e&&(t=B(e.element)),this.hasMaximizedView()&&this.exitMaximizedView();const s={root:$e(this.getView(),this.orientation),width:this.width,height:this.height,orientation:this.orientation};return t&&(s.maximizedNode={location:t}),e&&this.maximizeView(e),s}dispose(){this.disposable.dispose(),this._onDidChange.dispose(),this._onDidMaximizedNodeChange.dispose(),this._onDidViewVisibilityChange.dispose(),this.root.dispose(),this._maximizedNode=void 0,this.element.remove()}clear(){const e=this.root.orientation;this.root=new R(e,this.proportionalLayout,this.styles,this.root.size,this.root.orthogonalSize,this.locked,this.margin)}deserialize(e,t){const i=e.orientation,s=i===P.VERTICAL?e.height:e.width;if(this._deserialize(e.root,i,t,s),this.layout(e.width,e.height),e.maximizedNode){const n=e.maximizedNode.location,[o,l]=this.getNode(n);if(!(l instanceof j))return;this.maximizeView(l.view)}}_deserialize(e,t,i,s){this.root=this._deserializeNode(e,t,i,s)}_deserializeNode(e,t,i,s){var n;let o;if(e.type==="branch"){const r=e.data.map(d=>({node:this._deserializeNode(d,ie(t),i,e.size),visible:d.visible}));o=new R(t,this.proportionalLayout,this.styles,e.size,s,this.locked,this.margin,r)}else{const l=i.fromJSON(e);typeof e.visible=="boolean"&&((n=l.setVisible)===null||n===void 0||n.call(l,e.visible)),o=new j(l,t,s,e.size)}return o}get root(){return this._root}set root(e){const t=this._root;t&&(t.dispose(),this._maximizedNode=void 0,this.element.removeChild(t.element)),this._root=e,this.element.appendChild(this._root.element),this.disposable.value=this._root.onDidChange(i=>{this._onDidChange.fire(i)})}insertOrthogonalSplitviewAtRoot(){if(!this._root)return;const e=this.root;if(e.element.remove(),this._root=new R(ie(e.orientation),this.proportionalLayout,this.styles,this.root.orthogonalSize,this.root.size,this.locked,this.margin),e.children.length!==0)if(e.children.length===1){const t=e.children[0];e.removeChild(0).dispose(),e.dispose(),this._root.addChild(He(t,t.orthogonalSize,t.size),ne.Distribute,0)}else this._root.addChild(e,ne.Distribute,0);this.element.appendChild(this._root.element),this.disposable.value=this._root.onDidChange(t=>{this._onDidChange.fire(t)})}next(e){return this.progmaticSelect(e)}previous(e){return this.progmaticSelect(e,!0)}getView(e){const t=e?this.getNode(e)[1]:this.root;return this._getViews(t,this.orientation)}_getViews(e,t,i){const s={height:e.height,width:e.width};if(e instanceof j)return{box:s,view:e.view,cachedVisibleSize:i};const n=[];for(let o=0;o<e.children.length;o++){const l=e.children[o],r=e.getChildCachedVisibleSize(o);n.push(this._getViews(l,ie(t),r))}return{box:s,children:n}}progmaticSelect(e,t=!1){const[i,s]=this.getNode(e);if(!(s instanceof j))throw new Error("invalid location");for(let n=i.length-1;n>-1;n--){const o=i[n],l=e[n]||0;if(t?l-1>-1:l+1<o.children.length)return Re(o.children[t?l-1:l+1],t)}return Re(this.root,t)}constructor(e,t,i,s,n){this.proportionalLayout=e,this.styles=t,this._locked=!1,this._margin=0,this._maximizedNode=void 0,this.disposable=new J,this._onDidChange=new v,this.onDidChange=this._onDidChange.event,this._onDidViewVisibilityChange=new v,this.onDidViewVisibilityChange=this._onDidViewVisibilityChange.event,this._onDidMaximizedNodeChange=new v,this.onDidMaximizedNodeChange=this._onDidMaximizedNodeChange.event,this.element=document.createElement("div"),this.element.className="dv-grid-view",this._locked=s??!1,this._margin=n??0,this.root=new R(i,e,t,0,0,this.locked,this.margin)}isViewVisible(e){const[t,i]=he(e),[,s]=this.getNode(t);if(!(s instanceof R))throw new Error("Invalid from location");return s.isChildVisible(i)}setViewVisible(e,t){this.hasMaximizedView()&&this.exitMaximizedView();const[i,s]=he(e),[,n]=this.getNode(i);if(!(n instanceof R))throw new Error("Invalid from location");this._onDidViewVisibilityChange.fire(),n.setChildVisible(s,t)}moveView(e,t,i){this.hasMaximizedView()&&this.exitMaximizedView();const[,s]=this.getNode(e);if(!(s instanceof R))throw new Error("Invalid location");s.moveChild(t,i)}addView(e,t,i){this.hasMaximizedView()&&this.exitMaximizedView();const[s,n]=he(i),[o,l]=this.getNode(s);if(l instanceof R){const r=new j(e,ie(l.orientation),l.orthogonalSize);l.addChild(r,t,n)}else{const[r,...d]=[...o].reverse(),[h,...c]=[...s].reverse();let m=0;const p=r.getChildCachedVisibleSize(h);typeof p=="number"&&(m=ne.Invisible(p)),r.removeChild(h).dispose();const u=new R(l.orientation,this.proportionalLayout,this.styles,l.size,l.orthogonalSize,this.locked,this.margin);r.addChild(u,l.size,h);const _=new j(l.view,r.orientation,l.size);u.addChild(_,m,0),typeof t!="number"&&t.type==="split"&&(t={type:"split",index:0});const A=new j(e,r.orientation,l.size);u.addChild(A,t,n)}}remove(e,t){const i=B(e.element);return this.removeView(i,t)}removeView(e,t){this.hasMaximizedView()&&this.exitMaximizedView();const[i,s]=he(e),[n,o]=this.getNode(i);if(!(o instanceof R))throw new Error("Invalid location");const l=o.children[s];if(!(l instanceof j))throw new Error("Invalid location");if(o.removeChild(s,t),l.dispose(),o.children.length!==1)return l.view;const r=o.children[0];if(n.length===0)return r instanceof j||(o.removeChild(0,t),this.root=r),l.view;const[d,...h]=[...n].reverse(),[c,...m]=[...i].reverse(),p=o.isChildVisible(0);o.removeChild(0,t);const f=d.children.map((u,_)=>d.getChildSize(_));if(d.removeChild(c,t).dispose(),r instanceof R){f.splice(c,1,...r.children.map(u=>u.size));for(let u=0;u<r.children.length;u++){const _=r.children[u];d.addChild(_,_.size,c+u)}for(;r.children.length>0;)r.removeChild(0)}else{const u=new j(r.view,ie(r.orientation),r.size),_=p?r.orthogonalSize:ne.Invisible(r.orthogonalSize);d.addChild(u,_,c)}r.dispose();for(let u=0;u<f.length;u++)d.resizeChild(u,f[u]);return l.view}layout(e,t){const[i,s]=this.root.orientation===P.HORIZONTAL?[t,e]:[e,t];this.root.layout(i,s)}getNode(e,t=this.root,i=[]){if(e.length===0)return[i,t];if(!(t instanceof R))throw new Error("Invalid location");const[s,...n]=e;if(s<0||s>=t.children.length)throw new Error("Invalid location");const o=t.children[s];return i.push(t),this.getNode(n,o,i)}}class Ai extends z{get element(){return this._element}get disableResizing(){return this._disableResizing}set disableResizing(e){this._disableResizing=e}constructor(e,t=!1){super(),this._disableResizing=t,this._element=e,this.addDisposables(Ge(this._element,i=>{if(this.isDisposed||this.disableResizing||!this._element.offsetParent||!di(this._element))return;const{width:s,height:n}=i.contentRect;this.layout(s,n)}))}}const Si=At();function at(a){switch(a){case"left":return"left";case"right":return"right";case"above":return"top";case"below":return"bottom";case"within":default:return"center"}}class Ei extends Ai{get id(){return this._id}get size(){return this._groups.size}get groups(){return Array.from(this._groups.values()).map(e=>e.value)}get width(){return this.gridview.width}get height(){return this.gridview.height}get minimumHeight(){return this.gridview.minimumHeight}get maximumHeight(){return this.gridview.maximumHeight}get minimumWidth(){return this.gridview.minimumWidth}get maximumWidth(){return this.gridview.maximumWidth}get activeGroup(){return this._activeGroup}get locked(){return this.gridview.locked}set locked(e){this.gridview.locked=e}constructor(e,t){var i;super(document.createElement("div"),t.disableAutoResizing),this._id=Si.next(),this._groups=new Map,this._onDidRemove=new v,this.onDidRemove=this._onDidRemove.event,this._onDidAdd=new v,this.onDidAdd=this._onDidAdd.event,this._onDidMaximizedChange=new v,this.onDidMaximizedChange=this._onDidMaximizedChange.event,this._onDidActiveChange=new v,this.onDidActiveChange=this._onDidActiveChange.event,this._bufferOnDidLayoutChange=new nt,this.onDidLayoutChange=this._bufferOnDidLayoutChange.onEvent,this._onDidViewVisibilityChangeMicroTaskQueue=new nt,this.onDidViewVisibilityChangeMicroTaskQueue=this._onDidViewVisibilityChangeMicroTaskQueue.onEvent,this.element.style.height="100%",this.element.style.width="100%",this._classNames=new Ct(this.element),this._classNames.setClassNames((i=t.className)!==null&&i!==void 0?i:""),e.appendChild(this.element),this.gridview=new xi(!!t.proportionalLayout,t.styles,t.orientation,t.locked,t.margin),this.gridview.locked=!!t.locked,this.element.appendChild(this.gridview.element),this.layout(0,0,!0),this.addDisposables(this.gridview.onDidMaximizedNodeChange(s=>{this._onDidMaximizedChange.fire({panel:s.view,isMaximized:s.isMaximized})}),this.gridview.onDidViewVisibilityChange(()=>this._onDidViewVisibilityChangeMicroTaskQueue.fire()),this.onDidViewVisibilityChangeMicroTaskQueue(()=>{this.layout(this.width,this.height,!0)}),F.from(()=>{var s;(s=this.element.parentElement)===null||s===void 0||s.removeChild(this.element)}),this.gridview.onDidChange(()=>{this._bufferOnDidLayoutChange.fire()}),de.any(this.onDidAdd,this.onDidRemove,this.onDidActiveChange)(()=>{this._bufferOnDidLayoutChange.fire()}),this._onDidMaximizedChange,this._onDidViewVisibilityChangeMicroTaskQueue,this._bufferOnDidLayoutChange)}setVisible(e,t){this.gridview.setViewVisible(B(e.element),t),this._bufferOnDidLayoutChange.fire()}isVisible(e){return this.gridview.isViewVisible(B(e.element))}updateOptions(e){var t,i,s,n;e.proportionalLayout,e.orientation&&(this.gridview.orientation=e.orientation),"disableResizing"in e&&(this.disableResizing=(t=e.disableAutoResizing)!==null&&t!==void 0?t:!1),"locked"in e&&(this.locked=(i=e.locked)!==null&&i!==void 0?i:!1),"margin"in e&&(this.gridview.margin=(s=e.margin)!==null&&s!==void 0?s:0),"className"in e&&this._classNames.setClassNames((n=e.className)!==null&&n!==void 0?n:"")}maximizeGroup(e){this.gridview.maximizeView(e),this.doSetGroupActive(e)}isMaximizedGroup(e){return this.gridview.maximizedView()===e}exitMaximizedGroup(){this.gridview.exitMaximizedView()}hasMaximizedGroup(){return this.gridview.hasMaximizedView()}doAddGroup(e,t=[0],i){this.gridview.addView(e,i??ne.Distribute,t),this._onDidAdd.fire(e)}doRemoveGroup(e,t){if(!this._groups.has(e.id))throw new Error("invalid operation");const i=this._groups.get(e.id),s=this.gridview.remove(e,ne.Distribute);if(i&&!(t!=null&&t.skipDispose)&&(i.disposable.dispose(),i.value.dispose(),this._groups.delete(e.id),this._onDidRemove.fire(e)),!(t!=null&&t.skipActive)&&this._activeGroup===e){const n=Array.from(this._groups.values());this.doSetGroupActive(n.length>0?n[0].value:void 0)}return s}getPanel(e){var t;return(t=this._groups.get(e))===null||t===void 0?void 0:t.value}doSetGroupActive(e){this._activeGroup!==e&&(this._activeGroup&&this._activeGroup.setActive(!1),e&&e.setActive(!0),this._activeGroup=e,this._onDidActiveChange.fire(e))}removeGroup(e){this.doRemoveGroup(e)}moveToNext(e){var t;if(e||(e={}),!e.group){if(!this.activeGroup)return;e.group=this.activeGroup}const i=B(e.group.element),s=(t=this.gridview.next(i))===null||t===void 0?void 0:t.view;this.doSetGroupActive(s)}moveToPrevious(e){var t;if(e||(e={}),!e.group){if(!this.activeGroup)return;e.group=this.activeGroup}const i=B(e.group.element),s=(t=this.gridview.previous(i))===null||t===void 0?void 0:t.view;this.doSetGroupActive(s)}layout(e,t,i){(i||e!==this.width||t!==this.height)&&(this.gridview.element.style.height=`${t}px`,this.gridview.element.style.width=`${e}px`,this.gridview.layout(e,t))}dispose(){this._onDidActiveChange.dispose(),this._onDidAdd.dispose(),this._onDidRemove.dispose();for(const e of this.groups)e.dispose();this.gridview.dispose(),super.dispose()}}class ze{get id(){return this.component.id}get width(){return this.component.width}get height(){return this.component.height}get minimumHeight(){return this.component.minimumHeight}get maximumHeight(){return this.component.maximumHeight}get minimumWidth(){return this.component.minimumWidth}get maximumWidth(){return this.component.maximumWidth}get size(){return this.component.size}get totalPanels(){return this.component.totalPanels}get onDidActiveGroupChange(){return this.component.onDidActiveGroupChange}get onDidAddGroup(){return this.component.onDidAddGroup}get onDidRemoveGroup(){return this.component.onDidRemoveGroup}get onDidActivePanelChange(){return this.component.onDidActivePanelChange}get onDidAddPanel(){return this.component.onDidAddPanel}get onDidRemovePanel(){return this.component.onDidRemovePanel}get onDidMovePanel(){return this.component.onDidMovePanel}get onDidLayoutFromJSON(){return this.component.onDidLayoutFromJSON}get onDidLayoutChange(){return this.component.onDidLayoutChange}get onDidDrop(){return this.component.onDidDrop}get onWillDrop(){return this.component.onWillDrop}get onWillShowOverlay(){return this.component.onWillShowOverlay}get onWillDragGroup(){return this.component.onWillDragGroup}get onWillDragPanel(){return this.component.onWillDragPanel}get onUnhandledDragOverEvent(){return this.component.onUnhandledDragOverEvent}get onDidPopoutGroupSizeChange(){return this.component.onDidPopoutGroupSizeChange}get onDidPopoutGroupPositionChange(){return this.component.onDidPopoutGroupPositionChange}get panels(){return this.component.panels}get groups(){return this.component.groups}get activePanel(){return this.component.activePanel}get activeGroup(){return this.component.activeGroup}constructor(e){this.component=e}focus(){this.component.focus()}getPanel(e){return this.component.getGroupPanel(e)}layout(e,t,i=!1){this.component.layout(e,t,i)}addPanel(e){return this.component.addPanel(e)}removePanel(e){this.component.removePanel(e)}addGroup(e){return this.component.addGroup(e)}closeAllGroups(){return this.component.closeAllGroups()}removeGroup(e){this.component.removeGroup(e)}getGroup(e){return this.component.getPanel(e)}addFloatingGroup(e,t){return this.component.addFloatingGroup(e,t)}fromJSON(e){this.component.fromJSON(e)}toJSON(){return this.component.toJSON()}clear(){this.component.clear()}moveToNext(e){this.component.moveToNext(e)}moveToPrevious(e){this.component.moveToPrevious(e)}maximizeGroup(e){this.component.maximizeGroup(e.group)}hasMaximizedGroup(){return this.component.hasMaximizedGroup()}exitMaximizedGroup(){this.component.exitMaximizedGroup()}get onDidMaximizedGroupChange(){return this.component.onDidMaximizedGroupChange}addPopoutGroup(e,t){return this.component.addPopoutGroup(e,t)}updateOptions(e){this.component.updateOptions(e)}dispose(){this.component.dispose()}}class St extends z{constructor(e){super(),this.el=e,this.dataDisposable=new J,this.pointerEventsDisposable=new J,this._onDragStart=new v,this.onDragStart=this._onDragStart.event,this.addDisposables(this._onDragStart,this.dataDisposable,this.pointerEventsDisposable),this.configure()}isCancelled(e){return!1}configure(){this.addDisposables(this._onDragStart,G(this.el,"dragstart",e=>{if(e.defaultPrevented||this.isCancelled(e)){e.preventDefault();return}const t=Pe();this.pointerEventsDisposable.value={dispose:()=>{t.release()}},this.el.classList.add("dv-dragged"),setTimeout(()=>this.el.classList.remove("dv-dragged"),0),this.dataDisposable.value=this.getData(e),this._onDragStart.fire(e),e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.items.length>0||e.dataTransfer.setData("text/plain",""))}),G(this.el,"dragend",()=>{this.pointerEventsDisposable.dispose(),setTimeout(()=>{this.dataDisposable.dispose()},0)}))}}class Et extends z{constructor(e,t){super(),this.element=e,this.callbacks=t,this.target=null,this.registerListeners()}onDragEnter(e){this.target=e.target,this.callbacks.onDragEnter(e)}onDragOver(e){e.preventDefault(),this.callbacks.onDragOver&&this.callbacks.onDragOver(e)}onDragLeave(e){this.target===e.target&&(this.target=null,this.callbacks.onDragLeave(e))}onDragEnd(e){this.target=null,this.callbacks.onDragEnd(e)}onDrop(e){this.callbacks.onDrop(e)}registerListeners(){this.addDisposables(G(this.element,"dragenter",e=>{this.onDragEnter(e)},!0)),this.addDisposables(G(this.element,"dragover",e=>{this.onDragOver(e)},!0)),this.addDisposables(G(this.element,"dragleave",e=>{this.onDragLeave(e)})),this.addDisposables(G(this.element,"dragend",e=>{this.onDragEnd(e)})),this.addDisposables(G(this.element,"drop",e=>{this.onDrop(e)}))}}class Pi extends Be{get nativeEvent(){return this.options.nativeEvent}get position(){return this.options.position}constructor(e){super(),this.options=e}}function lt(a){switch(a){case"above":return"top";case"below":return"bottom";case"left":return"left";case"right":return"right";case"within":return"center";default:throw new Error(`invalid direction '${a}'`)}}function zi(a){switch(a){case"top":return"above";case"bottom":return"below";case"left":return"left";case"right":return"right";case"center":return"within";default:throw new Error(`invalid position '${a}'`)}}const Ii={value:20,type:"percentage"},Gi={value:50,type:"percentage"},Oi=100,Li=100;class se extends z{get disabled(){return this._disabled}set disabled(e){this._disabled=e}get state(){return this._state}constructor(e,t){super(),this.element=e,this.options=t,this._onDrop=new v,this.onDrop=this._onDrop.event,this._onWillShowOverlay=new v,this.onWillShowOverlay=this._onWillShowOverlay.event,this._disabled=!1,this._acceptedTargetZonesSet=new Set(this.options.acceptedTargetZones),this.dnd=new Et(this.element,{onDragEnter:()=>{var i,s,n;(n=(s=(i=this.options).getOverrideTarget)===null||s===void 0?void 0:s.call(i))===null||n===void 0||n.getElements()},onDragOver:i=>{var s,n,o,l,r,d,h;se.ACTUAL_TARGET=this;const c=(n=(s=this.options).getOverrideTarget)===null||n===void 0?void 0:n.call(s);if(this._acceptedTargetZonesSet.size===0){if(c)return;this.removeDropTarget();return}const m=(r=(l=(o=this.options).getOverlayOutline)===null||l===void 0?void 0:l.call(o))!==null&&r!==void 0?r:this.element,p=m.offsetWidth,f=m.offsetHeight;if(p===0||f===0)return;const u=i.currentTarget.getBoundingClientRect(),_=((d=i.clientX)!==null&&d!==void 0?d:0)-u.left,A=((h=i.clientY)!==null&&h!==void 0?h:0)-u.top,y=this.calculateQuadrant(this._acceptedTargetZonesSet,_,A,p,f);if(this.isAlreadyUsed(i)||y===null){this.removeDropTarget();return}if(!this.options.canDisplayOverlay(i,y)){if(c)return;this.removeDropTarget();return}const C=new Pi({nativeEvent:i,position:y});if(this._onWillShowOverlay.fire(C),C.defaultPrevented){this.removeDropTarget();return}this.markAsUsed(i),c||this.targetElement||(this.targetElement=document.createElement("div"),this.targetElement.className="dv-drop-target-dropzone",this.overlayElement=document.createElement("div"),this.overlayElement.className="dv-drop-target-selection",this._state="center",this.targetElement.appendChild(this.overlayElement),m.classList.add("dv-drop-target"),m.append(this.targetElement)),this.toggleClasses(y,p,f),this._state=y},onDragLeave:()=>{var i,s;!((s=(i=this.options).getOverrideTarget)===null||s===void 0)&&s.call(i)||this.removeDropTarget()},onDragEnd:i=>{var s,n;const o=(n=(s=this.options).getOverrideTarget)===null||n===void 0?void 0:n.call(s);o&&se.ACTUAL_TARGET===this&&this._state&&(i.stopPropagation(),this._onDrop.fire({position:this._state,nativeEvent:i})),this.removeDropTarget(),o==null||o.clear()},onDrop:i=>{var s,n,o;i.preventDefault();const l=this._state;this.removeDropTarget(),(o=(n=(s=this.options).getOverrideTarget)===null||n===void 0?void 0:n.call(s))===null||o===void 0||o.clear(),l&&(i.stopPropagation(),this._onDrop.fire({position:l,nativeEvent:i}))}}),this.addDisposables(this._onDrop,this._onWillShowOverlay,this.dnd)}setTargetZones(e){this._acceptedTargetZonesSet=new Set(e)}setOverlayModel(e){this.options.overlayModel=e}dispose(){this.removeDropTarget(),super.dispose()}markAsUsed(e){e[se.USED_EVENT_ID]=!0}isAlreadyUsed(e){const t=e[se.USED_EVENT_ID];return typeof t=="boolean"&&t}toggleClasses(e,t,i){var s,n,o,l,r,d,h;const c=(n=(s=this.options).getOverrideTarget)===null||n===void 0?void 0:n.call(s);if(!c&&!this.overlayElement)return;const m=t<Oi,p=i<Li,f=e==="left",u=e==="right",_=e==="top",A=e==="bottom",y=!m&&u,C=!m&&f,x=!p&&_,I=!p&&A;let D=1;const H=(l=(o=this.options.overlayModel)===null||o===void 0?void 0:o.size)!==null&&l!==void 0?l:Gi;if(H.type==="percentage"?D=V(H.value,0,100)/100:((y||C)&&(D=V(0,H.value,t)/t),(x||I)&&(D=V(0,H.value,i)/i)),c){const L=(h=(d=(r=this.options).getOverlayOutline)===null||d===void 0?void 0:d.call(r))!==null&&h!==void 0?h:this.element,k=L.getBoundingClientRect(),K=c.getElements(void 0,L),ee=K.root,T=K.overlay,M=ee.getBoundingClientRect(),b=k.top-M.top,S=k.left-M.left,N={top:b,left:S,width:t,height:i};y?(N.left=S+t*(1-D),N.width=t*D):C?N.width=t*D:x?N.height=i*D:I&&(N.top=b+i*(1-D),N.height=i*D),m&&f&&(N.width=4),m&&u&&(N.left=S+t-4,N.width=4);const le=`${Math.round(N.top)}px`,Ke=`${Math.round(N.left)}px`,qe=`${Math.round(N.width)}px`,Qe=`${Math.round(N.height)}px`;if(T.style.top===le&&T.style.left===Ke&&T.style.width===qe&&T.style.height===Qe)return;T.style.top=le,T.style.left=Ke,T.style.width=qe,T.style.height=Qe,T.style.visibility="visible",T.className=`dv-drop-target-anchor${this.options.className?` ${this.options.className}`:""}`,E(T,"dv-drop-target-left",f),E(T,"dv-drop-target-right",u),E(T,"dv-drop-target-top",_),E(T,"dv-drop-target-bottom",A),E(T,"dv-drop-target-center",e==="center"),K.changed&&(E(T,"dv-drop-target-anchor-container-changed",!0),setTimeout(()=>{E(T,"dv-drop-target-anchor-container-changed",!1)},10));return}if(!this.overlayElement)return;const W={top:"0px",left:"0px",width:"100%",height:"100%"};y?(W.left=`${100*(1-D)}%`,W.width=`${100*D}%`):C?W.width=`${100*D}%`:x?W.height=`${100*D}%`:I&&(W.top=`${100*(1-D)}%`,W.height=`${100*D}%`),this.overlayElement.style.top=W.top,this.overlayElement.style.left=W.left,this.overlayElement.style.width=W.width,this.overlayElement.style.height=W.height,E(this.overlayElement,"dv-drop-target-small-vertical",p),E(this.overlayElement,"dv-drop-target-small-horizontal",m),E(this.overlayElement,"dv-drop-target-left",f),E(this.overlayElement,"dv-drop-target-right",u),E(this.overlayElement,"dv-drop-target-top",_),E(this.overlayElement,"dv-drop-target-bottom",A),E(this.overlayElement,"dv-drop-target-center",e==="center")}calculateQuadrant(e,t,i,s,n){var o,l;const r=(l=(o=this.options.overlayModel)===null||o===void 0?void 0:o.activationSize)!==null&&l!==void 0?l:Ii;return r.type==="percentage"?ki(e,t,i,s,n,r.value):Ti(e,t,i,s,n,r.value)}removeDropTarget(){var e;this.targetElement&&(this._state=void 0,(e=this.targetElement.parentElement)===null||e===void 0||e.classList.remove("dv-drop-target"),this.targetElement.remove(),this.targetElement=void 0,this.overlayElement=void 0)}}se.USED_EVENT_ID="__dockview_droptarget_event_is_used__";function ki(a,e,t,i,s,n){const o=100*e/i,l=100*t/s;return a.has("left")&&o<n?"left":a.has("right")&&o>100-n?"right":a.has("top")&&l<n?"top":a.has("bottom")&&l>100-n?"bottom":a.has("center")?"center":null}function Ti(a,e,t,i,s,n){return a.has("left")&&e<n?"left":a.has("right")&&e>i-n?"right":a.has("top")&&t<n?"top":a.has("bottom")&&t>s-n?"bottom":a.has("center")?"center":null}class Pt extends Be{constructor(){super()}}class Vi extends z{get isFocused(){return this._isFocused}get isActive(){return this._isActive}get isVisible(){return this._isVisible}get width(){return this._width}get height(){return this._height}constructor(e,t){super(),this.id=e,this.component=t,this._isFocused=!1,this._isActive=!1,this._isVisible=!0,this._width=0,this._height=0,this._parameters={},this.panelUpdatesDisposable=new J,this._onDidDimensionChange=new v,this.onDidDimensionsChange=this._onDidDimensionChange.event,this._onDidChangeFocus=new v,this.onDidFocusChange=this._onDidChangeFocus.event,this._onWillFocus=new v,this.onWillFocus=this._onWillFocus.event,this._onDidVisibilityChange=new v,this.onDidVisibilityChange=this._onDidVisibilityChange.event,this._onWillVisibilityChange=new v,this.onWillVisibilityChange=this._onWillVisibilityChange.event,this._onDidActiveChange=new v,this.onDidActiveChange=this._onDidActiveChange.event,this._onActiveChange=new v,this.onActiveChange=this._onActiveChange.event,this._onDidParametersChange=new v,this.onDidParametersChange=this._onDidParametersChange.event,this.addDisposables(this.onDidFocusChange(i=>{this._isFocused=i.isFocused}),this.onDidActiveChange(i=>{this._isActive=i.isActive}),this.onDidVisibilityChange(i=>{this._isVisible=i.isVisible}),this.onDidDimensionsChange(i=>{this._width=i.width,this._height=i.height}),this.panelUpdatesDisposable,this._onDidDimensionChange,this._onDidChangeFocus,this._onDidVisibilityChange,this._onDidActiveChange,this._onWillFocus,this._onActiveChange,this._onWillFocus,this._onWillVisibilityChange,this._onDidParametersChange)}getParameters(){return this._parameters}initialize(e){this.panelUpdatesDisposable.value=this._onDidParametersChange.event(t=>{this._parameters=t,e.update({params:t})})}setVisible(e){this._onWillVisibilityChange.fire({isVisible:e})}setActive(){this._onActiveChange.fire()}updateParameters(e){this._onDidParametersChange.fire(e)}}class Mi extends z{get element(){return this._element}get width(){return this._width}get height(){return this._height}get params(){var e;return(e=this._params)===null||e===void 0?void 0:e.params}constructor(e,t,i){super(),this.id=e,this.component=t,this.api=i,this._height=0,this._width=0,this._element=document.createElement("div"),this._element.tabIndex=-1,this._element.style.outline="none",this._element.style.height="100%",this._element.style.width="100%",this._element.style.overflow="hidden";const s=Dt(this._element);this.addDisposables(this.api,s.onDidFocus(()=>{this.api._onDidChangeFocus.fire({isFocused:!0})}),s.onDidBlur(()=>{this.api._onDidChangeFocus.fire({isFocused:!1})}),s)}focus(){const e=new Pt;this.api._onWillFocus.fire(e),!e.defaultPrevented&&this._element.focus()}layout(e,t){this._width=e,this._height=t,this.api._onDidDimensionChange.fire({width:e,height:t}),this.part&&this._params&&this.part.update(this._params.params)}init(e){this._params=e,this.part=this.getComponent()}update(e){var t,i;this._params=Object.assign(Object.assign({},this._params),{params:Object.assign(Object.assign({},(t=this._params)===null||t===void 0?void 0:t.params),e.params)});for(const s of Object.keys(e.params))e.params[s]===void 0&&delete this._params.params[s];(i=this.part)===null||i===void 0||i.update({params:this._params.params})}toJSON(){var e,t;const i=(t=(e=this._params)===null||e===void 0?void 0:e.params)!==null&&t!==void 0?t:{};return{id:this.id,component:this.component,params:Object.keys(i).length>0?i:void 0}}dispose(){var e;this.api.dispose(),(e=this.part)===null||e===void 0||e.dispose(),super.dispose()}}class Ni extends z{get element(){return this._element}constructor(e,t){super(),this.accessor=e,this.group=t,this.disposable=new J,this._onDidFocus=new v,this.onDidFocus=this._onDidFocus.event,this._onDidBlur=new v,this.onDidBlur=this._onDidBlur.event,this._element=document.createElement("div"),this._element.className="dv-content-container",this._element.tabIndex=-1,this.addDisposables(this._onDidFocus,this._onDidBlur);const i=t.dropTargetContainer;this.dropTarget=new se(this.element,{getOverlayOutline:()=>{var s;return((s=e.options.theme)===null||s===void 0?void 0:s.dndPanelOverlay)==="group"?this.element.parentElement:null},className:"dv-drop-target-content",acceptedTargetZones:["top","bottom","left","right","center"],canDisplayOverlay:(s,n)=>{if(this.group.locked==="no-drop-target"||this.group.locked&&n==="center")return!1;const o=X();return!o&&s.shiftKey&&this.group.location.type!=="floating"?!1:o&&o.viewId===this.accessor.id?!0:this.group.canDisplayOverlay(s,n,"content")},getOverrideTarget:i?()=>i.model:void 0}),this.addDisposables(this.dropTarget)}show(){this.element.style.display=""}hide(){this.element.style.display="none"}renderPanel(e,t={asActive:!0}){const i=t.asActive||this.panel&&this.group.isPanelActive(this.panel);this.panel&&this.panel.view.content.element.parentElement===this._element&&this._element.removeChild(this.panel.view.content.element),this.panel=e;let s;switch(e.api.renderer){case"onlyWhenVisible":this.group.renderContainer.detatch(e),this.panel&&i&&this._element.appendChild(this.panel.view.content.element),s=this._element;break;case"always":e.view.content.element.parentElement===this._element&&this._element.removeChild(e.view.content.element),s=this.group.renderContainer.attach({panel:e,referenceContainer:this});break;default:throw new Error(`dockview: invalid renderer type '${e.api.renderer}'`)}if(i){const n=Dt(s),o=new z;o.addDisposables(n,n.onDidFocus(()=>this._onDidFocus.fire()),n.onDidBlur(()=>this._onDidBlur.fire())),this.disposable.value=o}}openPanel(e){this.panel!==e&&this.renderPanel(e)}layout(e,t){}closePanel(){var e;this.panel&&this.panel.api.renderer==="onlyWhenVisible"&&((e=this.panel.view.content.element.parentElement)===null||e===void 0||e.removeChild(this.panel.view.content.element)),this.panel=void 0}dispose(){this.disposable.dispose(),super.dispose()}}function zt(a,e,t){var i,s;bt(e,"dv-dragged"),document.body.appendChild(e),a.setDragImage(e,(i=t==null?void 0:t.x)!==null&&i!==void 0?i:0,(s=t==null?void 0:t.y)!==null&&s!==void 0?s:0),setTimeout(()=>{Ne(e,"dv-dragged"),e.remove()},0)}class Wi extends St{constructor(e,t,i,s){super(e),this.accessor=t,this.group=i,this.panel=s,this.panelTransfer=ue.getInstance()}getData(e){return this.panelTransfer.setData([new ae(this.accessor.id,this.group.id,this.panel.id)],ae.prototype),{dispose:()=>{this.panelTransfer.clearData(ae.prototype)}}}}class Ri extends z{get element(){return this._element}constructor(e,t,i){super(),this.panel=e,this.accessor=t,this.group=i,this.content=void 0,this._onPointDown=new v,this.onPointerDown=this._onPointDown.event,this._onDropped=new v,this.onDrop=this._onDropped.event,this._onDragStart=new v,this.onDragStart=this._onDragStart.event,this._element=document.createElement("div"),this._element.className="dv-tab",this._element.tabIndex=0,this._element.draggable=!0,E(this.element,"dv-inactive-tab",!0);const s=new Wi(this._element,this.accessor,this.group,this.panel);this.dropTarget=new se(this._element,{acceptedTargetZones:["left","right"],overlayModel:{activationSize:{value:50,type:"percentage"}},canDisplayOverlay:(n,o)=>{if(this.group.locked)return!1;const l=X();return l&&this.accessor.id===l.viewId?!0:this.group.model.canDisplayOverlay(n,o,"tab")},getOverrideTarget:()=>{var n;return(n=i.model.dropTargetContainer)===null||n===void 0?void 0:n.model}}),this.onWillShowOverlay=this.dropTarget.onWillShowOverlay,this.addDisposables(this._onPointDown,this._onDropped,this._onDragStart,s.onDragStart(n=>{if(n.dataTransfer){const o=getComputedStyle(this.element),l=this.element.cloneNode(!0);Array.from(o).forEach(r=>l.style.setProperty(r,o.getPropertyValue(r),o.getPropertyPriority(r))),l.style.position="absolute",zt(n.dataTransfer,l,{y:-10,x:30})}this._onDragStart.fire(n)}),s,G(this._element,"pointerdown",n=>{this._onPointDown.fire(n)}),this.dropTarget.onDrop(n=>{this._onDropped.fire(n)}),this.dropTarget)}setActive(e){E(this.element,"dv-active-tab",e),E(this.element,"dv-inactive-tab",!e)}setContent(e){this.content&&this._element.removeChild(this.content.element),this.content=e,this._element.appendChild(this.content.element)}dispose(){super.dispose()}}class Hi extends St{constructor(e,t,i){super(e),this.accessor=t,this.group=i,this.panelTransfer=ue.getInstance(),this.addDisposables(G(e,"pointerdown",s=>{s.shiftKey&&li(s)},!0))}isCancelled(e){return this.group.api.location.type==="floating"&&!e.shiftKey}getData(e){const t=e.dataTransfer;this.panelTransfer.setData([new ae(this.accessor.id,this.group.id,null)],ae.prototype);const i=window.getComputedStyle(this.el),s=i.getPropertyValue("--dv-activegroup-visiblepanel-tab-background-color"),n=i.getPropertyValue("--dv-activegroup-visiblepanel-tab-color");if(t){const o=document.createElement("div");o.style.backgroundColor=s,o.style.color=n,o.style.padding="2px 8px",o.style.height="24px",o.style.fontSize="11px",o.style.lineHeight="20px",o.style.borderRadius="12px",o.style.position="absolute",o.style.pointerEvents="none",o.style.top="-9999px",o.textContent=`Multiple Panels (${this.group.size})`,zt(t,o,{y:-10,x:30})}return{dispose:()=>{this.panelTransfer.clearData(ae.prototype)}}}}class $i extends z{get element(){return this._element}constructor(e,t){super(),this.accessor=e,this.group=t,this._onDrop=new v,this.onDrop=this._onDrop.event,this._onDragStart=new v,this.onDragStart=this._onDragStart.event,this._element=document.createElement("div"),this._element.className="dv-void-container",this._element.draggable=!0,this.addDisposables(this._onDrop,this._onDragStart,G(this._element,"pointerdown",()=>{this.accessor.doSetGroupActive(this.group)}));const i=new Hi(this._element,e,t);this.dropTraget=new se(this._element,{acceptedTargetZones:["center"],canDisplayOverlay:(s,n)=>{const o=X();return o&&this.accessor.id===o.viewId?!0:t.model.canDisplayOverlay(s,n,"header_space")},getOverrideTarget:()=>{var s;return(s=t.model.dropTargetContainer)===null||s===void 0?void 0:s.model}}),this.onWillShowOverlay=this.dropTraget.onWillShowOverlay,this.addDisposables(i,i.onDragStart(s=>{this._onDragStart.fire(s)}),this.dropTraget.onDrop(s=>{this._onDrop.fire(s)}),this.dropTraget)}}class Oe extends z{get element(){return this._element}constructor(e){super(),this.scrollableElement=e,this._scrollLeft=0,this._element=document.createElement("div"),this._element.className="dv-scrollable",this._horizontalScrollbar=document.createElement("div"),this._horizontalScrollbar.className="dv-scrollbar-horizontal",this.element.appendChild(e),this.element.appendChild(this._horizontalScrollbar),this.addDisposables(G(this.element,"wheel",t=>{this._scrollLeft+=t.deltaY*Oe.MouseWheelSpeed,this.calculateScrollbarStyles()}),G(this._horizontalScrollbar,"pointerdown",t=>{t.preventDefault(),E(this.element,"dv-scrollable-scrolling",!0);const i=t.clientX,s=this._scrollLeft,n=l=>{const r=l.clientX-i,{clientWidth:d}=this.element,{scrollWidth:h}=this.scrollableElement,c=d/h;this._scrollLeft=s+r/c,this.calculateScrollbarStyles()},o=()=>{E(this.element,"dv-scrollable-scrolling",!1),document.removeEventListener("pointermove",n),document.removeEventListener("pointerup",o),document.removeEventListener("pointercancel",o)};document.addEventListener("pointermove",n),document.addEventListener("pointerup",o),document.addEventListener("pointercancel",o)}),G(this.element,"scroll",()=>{this.calculateScrollbarStyles()}),G(this.scrollableElement,"scroll",()=>{this._scrollLeft=this.scrollableElement.scrollLeft,this.calculateScrollbarStyles()}),Ge(this.element,()=>{E(this.element,"dv-scrollable-resizing",!0),this._animationTimer&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(()=>{clearTimeout(this._animationTimer),E(this.element,"dv-scrollable-resizing",!1)},500),this.calculateScrollbarStyles()}))}calculateScrollbarStyles(){const{clientWidth:e}=this.element,{scrollWidth:t}=this.scrollableElement;if(t>e){const s=e*(e/t);this._horizontalScrollbar.style.width=`${s}px`,this._scrollLeft=V(this._scrollLeft,0,this.scrollableElement.scrollWidth-e),this.scrollableElement.scrollLeft=this._scrollLeft;const n=this._scrollLeft/(t-e);this._horizontalScrollbar.style.left=`${(e-s)*n}px`}else this._horizontalScrollbar.style.width="0px",this._horizontalScrollbar.style.left="0px",this._scrollLeft=0}}Oe.MouseWheelSpeed=1;class Fi extends z{get showTabsOverflowControl(){return this._showTabsOverflowControl}set showTabsOverflowControl(e){if(this._showTabsOverflowControl!=e&&(this._showTabsOverflowControl=e,e)){const t=new ri(this._tabsList);this._observerDisposable.value=new z(t,t.onDidChange(i=>{const s=i.hasScrollX||i.hasScrollY;this.toggleDropdown({reset:!s})}),G(this._tabsList,"scroll",()=>{this.toggleDropdown({reset:!1})}))}}get element(){return this._element}get panels(){return this._tabs.map(e=>e.value.panel.id)}get size(){return this._tabs.length}get tabs(){return this._tabs.map(e=>e.value)}constructor(e,t,i){if(super(),this.group=e,this.accessor=t,this._observerDisposable=new J,this._tabs=[],this.selectedIndex=-1,this._showTabsOverflowControl=!1,this._onTabDragStart=new v,this.onTabDragStart=this._onTabDragStart.event,this._onDrop=new v,this.onDrop=this._onDrop.event,this._onWillShowOverlay=new v,this.onWillShowOverlay=this._onWillShowOverlay.event,this._onOverflowTabsChange=new v,this.onOverflowTabsChange=this._onOverflowTabsChange.event,this._tabsList=document.createElement("div"),this._tabsList.className="dv-tabs-container dv-horizontal",this.showTabsOverflowControl=i.showTabsOverflowControl,t.options.scrollbars==="native")this._element=this._tabsList;else{const s=new Oe(this._tabsList);this._element=s.element,this.addDisposables(s)}this.addDisposables(this._onOverflowTabsChange,this._observerDisposable,this._onWillShowOverlay,this._onDrop,this._onTabDragStart,G(this.element,"pointerdown",s=>{if(s.defaultPrevented)return;s.button===0&&this.accessor.doSetGroupActive(this.group)}),F.from(()=>{for(const{value:s,disposable:n}of this._tabs)n.dispose(),s.dispose();this._tabs=[]}))}indexOf(e){return this._tabs.findIndex(t=>t.value.panel.id===e)}isActive(e){return this.selectedIndex>-1&&this._tabs[this.selectedIndex].value===e}setActivePanel(e){let t=0;for(const i of this._tabs){const s=e.id===i.value.panel.id;if(i.value.setActive(s),s){const n=i.value.element,o=n.parentElement;(t<o.scrollLeft||t+n.clientWidth>o.scrollLeft+o.clientWidth)&&(o.scrollLeft=t)}t+=i.value.element.clientWidth}}openPanel(e,t=this._tabs.length){if(this._tabs.find(o=>o.value.panel.id===e.id))return;const i=new Ri(e,this.accessor,this.group);i.setContent(e.view.tab);const s=new z(i.onDragStart(o=>{this._onTabDragStart.fire({nativeEvent:o,panel:e})}),i.onPointerDown(o=>{if(o.defaultPrevented)return;const l=!this.accessor.options.disableFloatingGroups,r=this.group.api.location.type==="floating"&&this.size===1;if(l&&!r&&o.shiftKey){o.preventDefault();const d=this.accessor.getGroupPanel(i.panel.id),{top:h,left:c}=i.element.getBoundingClientRect(),{top:m,left:p}=this.accessor.element.getBoundingClientRect();this.accessor.addFloatingGroup(d,{x:c-p,y:h-m,inDragMode:!0});return}switch(o.button){case 0:this.group.activePanel!==e&&this.group.model.openPanel(e);break}}),i.onDrop(o=>{this._onDrop.fire({event:o.nativeEvent,index:this._tabs.findIndex(l=>l.value===i)})}),i.onWillShowOverlay(o=>{this._onWillShowOverlay.fire(new Le(o,{kind:"tab",panel:this.group.activePanel,api:this.accessor.api,group:this.group,getData:X}))})),n={value:i,disposable:s};this.addTab(n,t)}delete(e){const t=this.indexOf(e),i=this._tabs.splice(t,1)[0],{value:s,disposable:n}=i;n.dispose(),s.dispose(),s.element.remove()}addTab(e,t=this._tabs.length){if(t<0||t>this._tabs.length)throw new Error("invalid location");this._tabsList.insertBefore(e.value.element,this._tabsList.children[t]),this._tabs=[...this._tabs.slice(0,t),e,...this._tabs.slice(t)],this.selectedIndex<0&&(this.selectedIndex=t)}toggleDropdown(e){const t=e.reset?[]:this._tabs.filter(i=>!mi(i.value.element,this._tabsList)).map(i=>i.value.panel.id);this._onOverflowTabsChange.fire({tabs:t,reset:e.reset})}}const It=a=>{const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttributeNS(null,"height",a.height),e.setAttributeNS(null,"width",a.width),e.setAttributeNS(null,"viewBox",a.viewbox),e.setAttributeNS(null,"aria-hidden","false"),e.setAttributeNS(null,"focusable","false"),e.classList.add("dv-svg");const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttributeNS(null,"d",a.path),e.appendChild(t),e},Bi=()=>It({width:"11",height:"11",viewbox:"0 0 28 28",path:"M2.1 27.3L0 25.2L11.55 13.65L0 2.1L2.1 0L13.65 11.55L25.2 0L27.3 2.1L15.75 13.65L27.3 25.2L25.2 27.3L13.65 15.75L2.1 27.3Z"}),Ui=()=>It({width:"11",height:"11",viewbox:"0 0 15 25",path:"M2.15 24.1L0 21.95L9.9 12.05L0 2.15L2.15 0L14.2 12.05L2.15 24.1Z"});function ji(){const a=document.createElement("div");a.className="dv-tabs-overflow-dropdown-default";const e=document.createElement("span");e.textContent="";const t=Ui();return a.appendChild(t),a.appendChild(e),{element:a,update:i=>{e.textContent=`${i.tabs}`}}}class Xi extends z{get onTabDragStart(){return this.tabs.onTabDragStart}get panels(){return this.tabs.panels}get size(){return this.tabs.size}get hidden(){return this._hidden}set hidden(e){this._hidden=e,this.element.style.display=e?"none":""}get element(){return this._element}constructor(e,t){super(),this.accessor=e,this.group=t,this._hidden=!1,this.dropdownPart=null,this._overflowTabs=[],this._dropdownDisposable=new J,this._onDrop=new v,this.onDrop=this._onDrop.event,this._onGroupDragStart=new v,this.onGroupDragStart=this._onGroupDragStart.event,this._onWillShowOverlay=new v,this.onWillShowOverlay=this._onWillShowOverlay.event,this._element=document.createElement("div"),this._element.className="dv-tabs-and-actions-container",E(this._element,"dv-full-width-single-tab",this.accessor.options.singleTabMode==="fullwidth"),this.rightActionsContainer=document.createElement("div"),this.rightActionsContainer.className="dv-right-actions-container",this.leftActionsContainer=document.createElement("div"),this.leftActionsContainer.className="dv-left-actions-container",this.preActionsContainer=document.createElement("div"),this.preActionsContainer.className="dv-pre-actions-container",this.tabs=new Fi(t,e,{showTabsOverflowControl:!e.options.disableTabsOverflowList}),this.voidContainer=new $i(this.accessor,this.group),this._element.appendChild(this.preActionsContainer),this._element.appendChild(this.tabs.element),this._element.appendChild(this.leftActionsContainer),this._element.appendChild(this.voidContainer.element),this._element.appendChild(this.rightActionsContainer),this.addDisposables(this.tabs.onDrop(i=>this._onDrop.fire(i)),this.tabs.onWillShowOverlay(i=>this._onWillShowOverlay.fire(i)),e.onDidOptionsChange(()=>{this.tabs.showTabsOverflowControl=!e.options.disableTabsOverflowList}),this.tabs.onOverflowTabsChange(i=>{this.toggleDropdown(i)}),this.tabs,this._onWillShowOverlay,this._onDrop,this._onGroupDragStart,this.voidContainer,this.voidContainer.onDragStart(i=>{this._onGroupDragStart.fire({nativeEvent:i,group:this.group})}),this.voidContainer.onDrop(i=>{this._onDrop.fire({event:i.nativeEvent,index:this.tabs.size})}),this.voidContainer.onWillShowOverlay(i=>{this._onWillShowOverlay.fire(new Le(i,{kind:"header_space",panel:this.group.activePanel,api:this.accessor.api,group:this.group,getData:X}))}),G(this.voidContainer.element,"pointerdown",i=>{if(i.defaultPrevented)return;if(!this.accessor.options.disableFloatingGroups&&i.shiftKey&&this.group.api.location.type!=="floating"){i.preventDefault();const{top:n,left:o}=this.element.getBoundingClientRect(),{top:l,left:r}=this.accessor.element.getBoundingClientRect();this.accessor.addFloatingGroup(this.group,{x:o-r+20,y:n-l+20,inDragMode:!0})}}))}show(){this.hidden||(this.element.style.display="")}hide(){this._element.style.display="none"}setRightActionsElement(e){this.rightActions!==e&&(this.rightActions&&(this.rightActions.remove(),this.rightActions=void 0),e&&(this.rightActionsContainer.appendChild(e),this.rightActions=e))}setLeftActionsElement(e){this.leftActions!==e&&(this.leftActions&&(this.leftActions.remove(),this.leftActions=void 0),e&&(this.leftActionsContainer.appendChild(e),this.leftActions=e))}setPrefixActionsElement(e){this.preActions!==e&&(this.preActions&&(this.preActions.remove(),this.preActions=void 0),e&&(this.preActionsContainer.appendChild(e),this.preActions=e))}isActive(e){return this.tabs.isActive(e)}indexOf(e){return this.tabs.indexOf(e)}setActive(e){}delete(e){this.tabs.delete(e),this.updateClassnames()}setActivePanel(e){this.tabs.setActivePanel(e)}openPanel(e,t=this.tabs.size){this.tabs.openPanel(e,t),this.updateClassnames()}closePanel(e){this.delete(e.id)}updateClassnames(){E(this._element,"dv-single-tab",this.size===1)}toggleDropdown(e){const t=e.reset?[]:e.tabs;if(this._overflowTabs=t,this._overflowTabs.length>0&&this.dropdownPart){this.dropdownPart.update({tabs:t.length});return}if(this._overflowTabs.length===0){this._dropdownDisposable.dispose();return}const i=document.createElement("div");i.className="dv-tabs-overflow-dropdown-root";const s=ji();s.update({tabs:t.length}),this.dropdownPart=s,i.appendChild(s.element),this.rightActionsContainer.prepend(i),this._dropdownDisposable.value=new z(F.from(()=>{var n,o;i.remove(),(o=(n=this.dropdownPart)===null||n===void 0?void 0:n.dispose)===null||o===void 0||o.call(n),this.dropdownPart=null}),G(i,"pointerdown",n=>{n.preventDefault()},{capture:!0}),G(i,"click",n=>{const o=document.createElement("div");o.style.overflow="auto",o.className="dv-tabs-overflow-container";for(const l of this.tabs.tabs.filter(r=>this._overflowTabs.includes(r.panel.id))){const r=this.group.panels.find(m=>m===l.panel),h=r.view.createTabRenderer("headerOverflow").element,c=document.createElement("div");E(c,"dv-tab",!0),E(c,"dv-active-tab",r.api.isActive),E(c,"dv-inactive-tab",!r.api.isActive),c.addEventListener("mousedown",()=>{this.accessor.popupService.close(),l.element.scrollIntoView(),l.panel.api.setActive()}),c.appendChild(h),o.appendChild(c)}this.accessor.popupService.openPopover(o,{x:n.clientX,y:n.clientY})}))}}class Gt extends si{constructor(e,t,i,s,n){super(),this.nativeEvent=e,this.target=t,this.position=i,this.getData=s,this.group=n}}function Yi(a){return!!a.referencePanel}function Zi(a){return!!a.referenceGroup}function Ji(a){return!!a.referencePanel}function Ki(a){return!!a.referenceGroup}class Ue extends Be{get nativeEvent(){return this.options.nativeEvent}get position(){return this.options.position}get panel(){return this.options.panel}get group(){return this.options.group}get api(){return this.options.api}constructor(e){super(),this.options=e}getData(){return this.options.getData()}}class Ot extends Ue{get kind(){return this._kind}constructor(e){super(e),this._kind=e.kind}}class Le{get kind(){return this.options.kind}get nativeEvent(){return this.event.nativeEvent}get position(){return this.event.position}get defaultPrevented(){return this.event.defaultPrevented}get panel(){return this.options.panel}get api(){return this.options.api}get group(){return this.options.group}preventDefault(){this.event.preventDefault()}getData(){return this.options.getData()}constructor(e,t){this.event=e,this.options=t}}class qi extends z{get element(){throw new Error("dockview: not supported")}get activePanel(){return this._activePanel}get locked(){return this._locked}set locked(e){this._locked=e,E(this.container,"dv-locked-groupview",e==="no-drop-target"||e)}get isActive(){return this._isGroupActive}get panels(){return this._panels}get size(){return this._panels.length}get isEmpty(){return this._panels.length===0}get hasWatermark(){return!!(this.watermark&&this.container.contains(this.watermark.element))}get header(){return this.tabsContainer}get isContentFocused(){return document.activeElement?We(document.activeElement,this.contentContainer.element):!1}get location(){return this._location}set location(e){switch(this._location=e,E(this.container,"dv-groupview-floating",!1),E(this.container,"dv-groupview-popout",!1),e.type){case"grid":this.contentContainer.dropTarget.setTargetZones(["top","bottom","left","right","center"]);break;case"floating":this.contentContainer.dropTarget.setTargetZones(["center"]),this.contentContainer.dropTarget.setTargetZones(e?["center"]:["top","bottom","left","right","center"]),E(this.container,"dv-groupview-floating",!0);break;case"popout":this.contentContainer.dropTarget.setTargetZones(["center"]),E(this.container,"dv-groupview-popout",!0);break}this.groupPanel.api._onDidLocationChange.fire({location:this.location})}constructor(e,t,i,s,n){var o;super(),this.container=e,this.accessor=t,this.id=i,this.options=s,this.groupPanel=n,this._isGroupActive=!1,this._locked=!1,this._location={type:"grid"},this.mostRecentlyUsed=[],this._overwriteRenderContainer=null,this._overwriteDropTargetContainer=null,this._onDidChange=new v,this.onDidChange=this._onDidChange.event,this._width=0,this._height=0,this._panels=[],this._panelDisposables=new Map,this._onMove=new v,this.onMove=this._onMove.event,this._onDidDrop=new v,this.onDidDrop=this._onDidDrop.event,this._onWillDrop=new v,this.onWillDrop=this._onWillDrop.event,this._onWillShowOverlay=new v,this.onWillShowOverlay=this._onWillShowOverlay.event,this._onTabDragStart=new v,this.onTabDragStart=this._onTabDragStart.event,this._onGroupDragStart=new v,this.onGroupDragStart=this._onGroupDragStart.event,this._onDidAddPanel=new v,this.onDidAddPanel=this._onDidAddPanel.event,this._onDidPanelTitleChange=new v,this.onDidPanelTitleChange=this._onDidPanelTitleChange.event,this._onDidPanelParametersChange=new v,this.onDidPanelParametersChange=this._onDidPanelParametersChange.event,this._onDidRemovePanel=new v,this.onDidRemovePanel=this._onDidRemovePanel.event,this._onDidActivePanelChange=new v,this.onDidActivePanelChange=this._onDidActivePanelChange.event,this._onUnhandledDragOverEvent=new v,this.onUnhandledDragOverEvent=this._onUnhandledDragOverEvent.event,E(this.container,"dv-groupview",!0),this._api=new ze(this.accessor),this.tabsContainer=new Xi(this.accessor,this.groupPanel),this.contentContainer=new Ni(this.accessor,this),e.append(this.tabsContainer.element,this.contentContainer.element),this.header.hidden=!!s.hideHeader,this.locked=(o=s.locked)!==null&&o!==void 0?o:!1,this.addDisposables(this._onTabDragStart,this._onGroupDragStart,this._onWillShowOverlay,this.tabsContainer.onTabDragStart(l=>{this._onTabDragStart.fire(l)}),this.tabsContainer.onGroupDragStart(l=>{this._onGroupDragStart.fire(l)}),this.tabsContainer.onDrop(l=>{this.handleDropEvent("header",l.event,"center",l.index)}),this.contentContainer.onDidFocus(()=>{this.accessor.doSetGroupActive(this.groupPanel)}),this.contentContainer.onDidBlur(()=>{}),this.contentContainer.dropTarget.onDrop(l=>{this.handleDropEvent("content",l.nativeEvent,l.position)}),this.tabsContainer.onWillShowOverlay(l=>{this._onWillShowOverlay.fire(l)}),this.contentContainer.dropTarget.onWillShowOverlay(l=>{this._onWillShowOverlay.fire(new Le(l,{kind:"content",panel:this.activePanel,api:this._api,group:this.groupPanel,getData:X}))}),this._onMove,this._onDidChange,this._onDidDrop,this._onWillDrop,this._onDidAddPanel,this._onDidRemovePanel,this._onDidActivePanelChange,this._onUnhandledDragOverEvent,this._onDidPanelTitleChange,this._onDidPanelParametersChange)}focusContent(){this.contentContainer.element.focus()}set renderContainer(e){this.panels.forEach(t=>{this.renderContainer.detatch(t)}),this._overwriteRenderContainer=e,this.panels.forEach(t=>{this.rerender(t)})}get renderContainer(){var e;return(e=this._overwriteRenderContainer)!==null&&e!==void 0?e:this.accessor.overlayRenderContainer}set dropTargetContainer(e){this._overwriteDropTargetContainer=e}get dropTargetContainer(){var e;return(e=this._overwriteDropTargetContainer)!==null&&e!==void 0?e:this.accessor.rootDropTargetContainer}initialize(){this.options.panels&&this.options.panels.forEach(e=>{this.doAddPanel(e)}),this.options.activePanel&&this.openPanel(this.options.activePanel),this.setActive(this.isActive,!0),this.updateContainer(),this.accessor.options.createRightHeaderActionComponent&&(this._rightHeaderActions=this.accessor.options.createRightHeaderActionComponent(this.groupPanel),this.addDisposables(this._rightHeaderActions),this._rightHeaderActions.init({containerApi:this._api,api:this.groupPanel.api,group:this.groupPanel}),this.tabsContainer.setRightActionsElement(this._rightHeaderActions.element)),this.accessor.options.createLeftHeaderActionComponent&&(this._leftHeaderActions=this.accessor.options.createLeftHeaderActionComponent(this.groupPanel),this.addDisposables(this._leftHeaderActions),this._leftHeaderActions.init({containerApi:this._api,api:this.groupPanel.api,group:this.groupPanel}),this.tabsContainer.setLeftActionsElement(this._leftHeaderActions.element)),this.accessor.options.createPrefixHeaderActionComponent&&(this._prefixHeaderActions=this.accessor.options.createPrefixHeaderActionComponent(this.groupPanel),this.addDisposables(this._prefixHeaderActions),this._prefixHeaderActions.init({containerApi:this._api,api:this.groupPanel.api,group:this.groupPanel}),this.tabsContainer.setPrefixActionsElement(this._prefixHeaderActions.element))}rerender(e){this.contentContainer.renderPanel(e,{asActive:!1})}indexOf(e){return this.tabsContainer.indexOf(e.id)}toJSON(){var e;const t={views:this.tabsContainer.panels,activeView:(e=this._activePanel)===null||e===void 0?void 0:e.id,id:this.id};return this.locked!==!1&&(t.locked=this.locked),this.header.hidden&&(t.hideHeader=!0),t}moveToNext(e){e||(e={}),e.panel||(e.panel=this.activePanel);const t=e.panel?this.panels.indexOf(e.panel):-1;let i;if(t<this.panels.length-1)i=t+1;else if(!e.suppressRoll)i=0;else return;this.openPanel(this.panels[i])}moveToPrevious(e){if(e||(e={}),e.panel||(e.panel=this.activePanel),!e.panel)return;const t=this.panels.indexOf(e.panel);let i;if(t>0)i=t-1;else if(!e.suppressRoll)i=this.panels.length-1;else return;this.openPanel(this.panels[i])}containsPanel(e){return this.panels.includes(e)}init(e){}update(e){}focus(){var e;(e=this._activePanel)===null||e===void 0||e.focus()}openPanel(e,t={}){(typeof t.index!="number"||t.index>this.panels.length)&&(t.index=this.panels.length);const i=!!t.skipSetActive;if(e.updateParentGroup(this.groupPanel,{skipSetActive:t.skipSetActive}),this.doAddPanel(e,t.index,{skipSetActive:i}),this._activePanel===e){this.contentContainer.renderPanel(e,{asActive:!0});return}i||this.doSetActivePanel(e),t.skipSetGroupActive||this.accessor.doSetGroupActive(this.groupPanel),t.skipSetActive||this.updateContainer()}removePanel(e,t={skipSetActive:!1}){const i=typeof e=="string"?e:e.id,s=this._panels.find(n=>n.id===i);if(!s)throw new Error("invalid operation");return this._removePanel(s,t)}closeAllPanels(){if(this.panels.length>0){const e=[...this.panels];for(const t of e)this.doClose(t)}else this.accessor.removeGroup(this.groupPanel)}closePanel(e){this.doClose(e)}doClose(e){const t=this.panels.length===1&&this.accessor.groups.length===1;this.accessor.removePanel(e,t&&this.accessor.options.noPanelsOverlay==="emptyGroup"?{removeEmptyGroup:!1}:void 0)}isPanelActive(e){return this._activePanel===e}updateActions(e){this.tabsContainer.setRightActionsElement(e)}setActive(e,t=!1){!t&&this.isActive===e||(this._isGroupActive=e,E(this.container,"dv-active-group",e),E(this.container,"dv-inactive-group",!e),this.tabsContainer.setActive(this.isActive),!this._activePanel&&this.panels.length>0&&this.doSetActivePanel(this.panels[0]),this.updateContainer())}layout(e,t){var i;this._width=e,this._height=t,this.contentContainer.layout(this._width,this._height),!((i=this._activePanel)===null||i===void 0)&&i.layout&&this._activePanel.layout(this._width,this._height)}_removePanel(e,t){const i=this._activePanel===e;if(this.doRemovePanel(e),i&&this.panels.length>0){const s=this.mostRecentlyUsed[0];this.openPanel(s,{skipSetActive:t.skipSetActive,skipSetGroupActive:t.skipSetActiveGroup})}return this._activePanel&&this.panels.length===0&&this.doSetActivePanel(void 0),t.skipSetActive||this.updateContainer(),e}doRemovePanel(e){const t=this.panels.indexOf(e);if(this._activePanel===e&&this.contentContainer.closePanel(),this.tabsContainer.delete(e.id),this._panels.splice(t,1),this.mostRecentlyUsed.includes(e)){const s=this.mostRecentlyUsed.indexOf(e);this.mostRecentlyUsed.splice(s,1)}const i=this._panelDisposables.get(e.id);i&&(i.dispose(),this._panelDisposables.delete(e.id)),this._onDidRemovePanel.fire({panel:e})}doAddPanel(e,t=this.panels.length,i={skipSetActive:!1}){const n=this._panels.indexOf(e)>-1;this.tabsContainer.show(),this.contentContainer.show(),this.tabsContainer.openPanel(e,t),i.skipSetActive||this.contentContainer.openPanel(e),!n&&(this.updateMru(e),this.panels.splice(t,0,e),this._panelDisposables.set(e.id,new z(e.api.onDidTitleChange(o=>this._onDidPanelTitleChange.fire(o)),e.api.onDidParametersChange(o=>this._onDidPanelParametersChange.fire(o)))),this._onDidAddPanel.fire({panel:e}))}doSetActivePanel(e){this._activePanel!==e&&(this._activePanel=e,e&&(this.tabsContainer.setActivePanel(e),e.layout(this._width,this._height),this.updateMru(e),this._onDidActivePanelChange.fire({panel:e})))}updateMru(e){this.mostRecentlyUsed.includes(e)&&this.mostRecentlyUsed.splice(this.mostRecentlyUsed.indexOf(e),1),this.mostRecentlyUsed=[e,...this.mostRecentlyUsed]}updateContainer(){var e,t;if(this.panels.forEach(i=>i.runEvents()),this.isEmpty&&!this.watermark){const i=this.accessor.createWatermarkComponent();i.init({containerApi:this._api,group:this.groupPanel}),this.watermark=i,G(this.watermark.element,"pointerdown",()=>{this.isActive||this.accessor.doSetGroupActive(this.groupPanel)}),this.contentContainer.element.appendChild(this.watermark.element)}!this.isEmpty&&this.watermark&&(this.watermark.element.remove(),(t=(e=this.watermark).dispose)===null||t===void 0||t.call(e),this.watermark=void 0)}canDisplayOverlay(e,t,i){const s=new Gt(e,i,t,X,this.accessor.getPanel(this.id));return this._onUnhandledDragOverEvent.fire(s),s.isAccepted}handleDropEvent(e,t,i,s){if(this.locked==="no-drop-target")return;function n(){switch(e){case"header":return typeof s=="number"?"tab":"header_space";case"content":return"content"}}const o=typeof s=="number"?this.panels[s]:void 0,l=new Ot({nativeEvent:t,position:i,panel:o,getData:()=>X(),kind:n(),group:this.groupPanel,api:this._api});if(this._onWillDrop.fire(l),l.defaultPrevented)return;const r=X();if(r&&r.viewId===this.accessor.id){if(e==="content"&&r.groupId===this.id&&(i==="center"||r.panelId===null)||e==="header"&&r.groupId===this.id&&r.panelId===null)return;if(r.panelId===null){const{groupId:p}=r;this._onMove.fire({target:i,groupId:p,index:s});return}if(this.tabsContainer.indexOf(r.panelId)!==-1&&this.tabsContainer.size===1)return;const{groupId:h,panelId:c}=r;if(this.id===h&&!i&&this.tabsContainer.indexOf(c)===s)return;this._onMove.fire({target:i,groupId:r.groupId,itemId:r.panelId,index:s})}else this._onDidDrop.fire(new Ue({nativeEvent:t,position:i,panel:o,getData:()=>X(),group:this.groupPanel,api:this._api}))}dispose(){var e,t,i;super.dispose(),(e=this.watermark)===null||e===void 0||e.element.remove(),(i=(t=this.watermark)===null||t===void 0?void 0:t.dispose)===null||i===void 0||i.call(t),this.watermark=void 0;for(const s of this.panels)s.dispose();this.tabsContainer.dispose(),this.contentContainer.dispose()}}class je extends Vi{constructor(e,t,i){super(e,t),this._onDidConstraintsChangeInternal=new v,this.onDidConstraintsChangeInternal=this._onDidConstraintsChangeInternal.event,this._onDidConstraintsChange=new v,this.onDidConstraintsChange=this._onDidConstraintsChange.event,this._onDidSizeChange=new v,this.onDidSizeChange=this._onDidSizeChange.event,this.addDisposables(this._onDidConstraintsChangeInternal,this._onDidConstraintsChange,this._onDidSizeChange),i&&this.initialize(i)}setConstraints(e){this._onDidConstraintsChangeInternal.fire(e)}setSize(e){this._onDidSizeChange.fire(e)}}class Qi extends Mi{get priority(){return this._priority}get snap(){return this._snap}get minimumWidth(){return this.__minimumWidth()}get minimumHeight(){return this.__minimumHeight()}get maximumHeight(){return this.__maximumHeight()}get maximumWidth(){return this.__maximumWidth()}__minimumWidth(){const e=typeof this._minimumWidth=="function"?this._minimumWidth():this._minimumWidth;return e!==this._evaluatedMinimumWidth&&(this._evaluatedMinimumWidth=e,this.updateConstraints()),e}__maximumWidth(){const e=typeof this._maximumWidth=="function"?this._maximumWidth():this._maximumWidth;return e!==this._evaluatedMaximumWidth&&(this._evaluatedMaximumWidth=e,this.updateConstraints()),e}__minimumHeight(){const e=typeof this._minimumHeight=="function"?this._minimumHeight():this._minimumHeight;return e!==this._evaluatedMinimumHeight&&(this._evaluatedMinimumHeight=e,this.updateConstraints()),e}__maximumHeight(){const e=typeof this._maximumHeight=="function"?this._maximumHeight():this._maximumHeight;return e!==this._evaluatedMaximumHeight&&(this._evaluatedMaximumHeight=e,this.updateConstraints()),e}get isActive(){return this.api.isActive}get isVisible(){return this.api.isVisible}constructor(e,t,i,s){super(e,t,s??new je(e,t)),this._evaluatedMinimumWidth=0,this._evaluatedMaximumWidth=Number.MAX_SAFE_INTEGER,this._evaluatedMinimumHeight=0,this._evaluatedMaximumHeight=Number.MAX_SAFE_INTEGER,this._minimumWidth=0,this._minimumHeight=0,this._maximumWidth=Number.MAX_SAFE_INTEGER,this._maximumHeight=Number.MAX_SAFE_INTEGER,this._snap=!1,this._onDidChange=new v,this.onDidChange=this._onDidChange.event,typeof(i==null?void 0:i.minimumWidth)=="number"&&(this._minimumWidth=i.minimumWidth),typeof(i==null?void 0:i.maximumWidth)=="number"&&(this._maximumWidth=i.maximumWidth),typeof(i==null?void 0:i.minimumHeight)=="number"&&(this._minimumHeight=i.minimumHeight),typeof(i==null?void 0:i.maximumHeight)=="number"&&(this._maximumHeight=i.maximumHeight),this.api.initialize(this),this.addDisposables(this.api.onWillVisibilityChange(n=>{const{isVisible:o}=n,{accessor:l}=this._params;l.setVisible(this,o)}),this.api.onActiveChange(()=>{const{accessor:n}=this._params;n.doSetGroupActive(this)}),this.api.onDidConstraintsChangeInternal(n=>{(typeof n.minimumWidth=="number"||typeof n.minimumWidth=="function")&&(this._minimumWidth=n.minimumWidth),(typeof n.minimumHeight=="number"||typeof n.minimumHeight=="function")&&(this._minimumHeight=n.minimumHeight),(typeof n.maximumWidth=="number"||typeof n.maximumWidth=="function")&&(this._maximumWidth=n.maximumWidth),(typeof n.maximumHeight=="number"||typeof n.maximumHeight=="function")&&(this._maximumHeight=n.maximumHeight)}),this.api.onDidSizeChange(n=>{this._onDidChange.fire({height:n.height,width:n.width})}),this._onDidChange)}setVisible(e){this.api._onDidVisibilityChange.fire({isVisible:e})}setActive(e){this.api._onDidActiveChange.fire({isActive:e})}init(e){e.maximumHeight&&(this._maximumHeight=e.maximumHeight),e.minimumHeight&&(this._minimumHeight=e.minimumHeight),e.maximumWidth&&(this._maximumWidth=e.maximumWidth),e.minimumWidth&&(this._minimumWidth=e.minimumWidth),this._priority=e.priority,this._snap=!!e.snap,super.init(e),typeof e.isVisible=="boolean"&&this.setVisible(e.isVisible)}updateConstraints(){this.api._onDidConstraintsChange.fire({minimumWidth:this._evaluatedMinimumWidth,maximumWidth:this._evaluatedMaximumWidth,minimumHeight:this._evaluatedMinimumHeight,maximumHeight:this._evaluatedMaximumHeight})}toJSON(){const e=super.toJSON(),t=s=>s===Number.MAX_SAFE_INTEGER?void 0:s,i=s=>s<=0?void 0:s;return Object.assign(Object.assign({},e),{minimumHeight:i(this.minimumHeight),maximumHeight:t(this.maximumHeight),minimumWidth:i(this.minimumWidth),maximumWidth:t(this.maximumWidth),snap:this.snap,priority:this.priority})}}const fe="dockview: DockviewGroupPanelApiImpl not initialized";class es extends je{get location(){if(!this._group)throw new Error(fe);return this._group.model.location}constructor(e,t){super(e,"__dockviewgroup__"),this.accessor=t,this._onDidLocationChange=new v,this.onDidLocationChange=this._onDidLocationChange.event,this._onDidActivePanelChange=new v,this.onDidActivePanelChange=this._onDidActivePanelChange.event,this.addDisposables(this._onDidLocationChange,this._onDidActivePanelChange)}close(){if(this._group)return this.accessor.removeGroup(this._group)}getWindow(){return this.location.type==="popout"?this.location.getWindow():window}moveTo(e){var t,i,s;if(!this._group)throw new Error(fe);const n=(t=e.group)!==null&&t!==void 0?t:this.accessor.addGroup({direction:zi((i=e.position)!==null&&i!==void 0?i:"right"),skipSetActive:!0});this.accessor.moveGroupOrPanel({from:{groupId:this._group.id},to:{group:n,position:e.group&&(s=e.position)!==null&&s!==void 0?s:"center",index:e.index}})}maximize(){if(!this._group)throw new Error(fe);this.location.type==="grid"&&this.accessor.maximizeGroup(this._group)}isMaximized(){if(!this._group)throw new Error(fe);return this.accessor.isMaximizedGroup(this._group)}exitMaximized(){if(!this._group)throw new Error(fe);this.isMaximized()&&this.accessor.exitMaximizedGroup()}initialize(e){this._group=e}}const ts=100,is=100;class ht extends Qi{get minimumWidth(){var e;const t=(e=this.activePanel)===null||e===void 0?void 0:e.minimumWidth;return typeof t=="number"?t:super.__minimumWidth()}get minimumHeight(){var e;const t=(e=this.activePanel)===null||e===void 0?void 0:e.minimumHeight;return typeof t=="number"?t:super.__minimumHeight()}get maximumWidth(){var e;const t=(e=this.activePanel)===null||e===void 0?void 0:e.maximumWidth;return typeof t=="number"?t:super.__maximumWidth()}get maximumHeight(){var e;const t=(e=this.activePanel)===null||e===void 0?void 0:e.maximumHeight;return typeof t=="number"?t:super.__maximumHeight()}get panels(){return this._model.panels}get activePanel(){return this._model.activePanel}get size(){return this._model.size}get model(){return this._model}get locked(){return this._model.locked}set locked(e){this._model.locked=e}get header(){return this._model.header}constructor(e,t,i){var s,n,o,l,r,d;super(t,"groupview_default",{minimumHeight:(n=(s=i.constraints)===null||s===void 0?void 0:s.minimumHeight)!==null&&n!==void 0?n:is,minimumWidth:(l=(o=i.constraints)===null||o===void 0?void 0:o.maximumHeight)!==null&&l!==void 0?l:ts,maximumHeight:(r=i.constraints)===null||r===void 0?void 0:r.maximumHeight,maximumWidth:(d=i.constraints)===null||d===void 0?void 0:d.maximumWidth},new es(t,e)),this.api.initialize(this),this._model=new qi(this.element,e,t,i,this),this.addDisposables(this.model.onDidActivePanelChange(h=>{this.api._onDidActivePanelChange.fire(h)}))}focus(){this.api.isActive||this.api.setActive(),super.focus()}initialize(){this._model.initialize()}setActive(e){super.setActive(e),this.model.setActive(e)}layout(e,t){super.layout(e,t),this.model.layout(e,t)}getComponent(){return this._model}toJSON(){return this.model.toJSON()}}const Lt={name:"abyss",className:"dockview-theme-abyss"};class ss extends je{get location(){return this.group.api.location}get title(){return this.panel.title}get isGroupActive(){return this.group.isActive}get renderer(){return this.panel.renderer}set group(e){const t=this._group;this._group!==e&&(this._group=e,this._onDidGroupChange.fire({}),this.setupGroupEventListeners(t),this._onDidLocationChange.fire({location:this.group.api.location}))}get group(){return this._group}get tabComponent(){return this._tabComponent}constructor(e,t,i,s,n){super(e.id,s),this.panel=e,this.accessor=i,this._onDidTitleChange=new v,this.onDidTitleChange=this._onDidTitleChange.event,this._onDidActiveGroupChange=new v,this.onDidActiveGroupChange=this._onDidActiveGroupChange.event,this._onDidGroupChange=new v,this.onDidGroupChange=this._onDidGroupChange.event,this._onDidRendererChange=new v,this.onDidRendererChange=this._onDidRendererChange.event,this._onDidLocationChange=new v,this.onDidLocationChange=this._onDidLocationChange.event,this.groupEventsDisposable=new J,this._tabComponent=n,this.initialize(e),this._group=t,this.setupGroupEventListeners(),this.addDisposables(this.groupEventsDisposable,this._onDidRendererChange,this._onDidTitleChange,this._onDidGroupChange,this._onDidActiveGroupChange,this._onDidLocationChange)}getWindow(){return this.group.api.getWindow()}moveTo(e){var t,i;this.accessor.moveGroupOrPanel({from:{groupId:this._group.id,panelId:this.panel.id},to:{group:(t=e.group)!==null&&t!==void 0?t:this._group,position:e.group&&(i=e.position)!==null&&i!==void 0?i:"center",index:e.index}})}setTitle(e){this.panel.setTitle(e)}setRenderer(e){this.panel.setRenderer(e)}close(){this.group.model.closePanel(this.panel)}maximize(){this.group.api.maximize()}isMaximized(){return this.group.api.isMaximized()}exitMaximized(){this.group.api.exitMaximized()}setupGroupEventListeners(e){var t;let i=(t=e==null?void 0:e.isActive)!==null&&t!==void 0?t:!1;this.groupEventsDisposable.value=new z(this.group.api.onDidVisibilityChange(s=>{const n=!s.isVisible&&this.isVisible,o=s.isVisible&&!this.isVisible,l=this.group.model.isPanelActive(this.panel);(n||o&&l)&&this._onDidVisibilityChange.fire(s)}),this.group.api.onDidLocationChange(s=>{this.group===this.panel.group&&this._onDidLocationChange.fire(s)}),this.group.api.onDidActiveChange(()=>{this.group===this.panel.group&&i!==this.isGroupActive&&(i=this.isGroupActive,this._onDidActiveGroupChange.fire({isActive:this.isGroupActive}))}))}}class ve extends z{get params(){return this._params}get title(){return this._title}get group(){return this._group}get renderer(){var e;return(e=this._renderer)!==null&&e!==void 0?e:this.accessor.renderer}get minimumWidth(){return this._minimumWidth}get minimumHeight(){return this._minimumHeight}get maximumWidth(){return this._maximumWidth}get maximumHeight(){return this._maximumHeight}constructor(e,t,i,s,n,o,l,r){super(),this.id=e,this.accessor=s,this.containerApi=n,this.view=l,this._renderer=r.renderer,this._group=o,this._minimumWidth=r.minimumWidth,this._minimumHeight=r.minimumHeight,this._maximumWidth=r.maximumWidth,this._maximumHeight=r.maximumHeight,this.api=new ss(this,this._group,s,t,i),this.addDisposables(this.api.onActiveChange(()=>{s.setActivePanel(this)}),this.api.onDidSizeChange(d=>{this.group.api.setSize(d)}),this.api.onDidRendererChange(()=>{this.group.model.rerender(this)}))}init(e){this._params=e.params,this.view.init(Object.assign(Object.assign({},e),{api:this.api,containerApi:this.containerApi})),this.setTitle(e.title)}focus(){const e=new Pt;this.api._onWillFocus.fire(e),!e.defaultPrevented&&(this.api.isActive||this.api.setActive())}toJSON(){return{id:this.id,contentComponent:this.view.contentComponent,tabComponent:this.view.tabComponent,params:Object.keys(this._params||{}).length>0?this._params:void 0,title:this.title,renderer:this._renderer,minimumHeight:this._minimumHeight,maximumHeight:this._maximumHeight,minimumWidth:this._minimumWidth,maximumWidth:this._maximumWidth}}setTitle(e){e!==this.title&&(this._title=e,this.api._onDidTitleChange.fire({title:e}))}setRenderer(e){e!==this.renderer&&(this._renderer=e,this.api._onDidRendererChange.fire({renderer:e}))}update(e){var t;this._params=Object.assign(Object.assign({},(t=this._params)!==null&&t!==void 0?t:{}),e.params);for(const i of Object.keys(e.params))e.params[i]===void 0&&delete this._params[i];this.view.update({params:this._params})}updateParentGroup(e,t){this._group=e,this.api.group=this._group;const i=this._group.model.isPanelActive(this),s=this.group.api.isActive&&i;t!=null&&t.skipSetActive||this.api.isActive!==s&&this.api._onDidActiveChange.fire({isActive:this.group.api.isActive&&i}),this.api.isVisible!==i&&this.api._onDidVisibilityChange.fire({isVisible:i})}runEvents(){const e=this._group.model.isPanelActive(this),t=this.group.api.isActive&&e;this.api.isActive!==t&&this.api._onDidActiveChange.fire({isActive:this.group.api.isActive&&e}),this.api.isVisible!==e&&this.api._onDidVisibilityChange.fire({isVisible:e})}layout(e,t){this.api._onDidDimensionChange.fire({width:e,height:t}),this.view.layout(e,t)}dispose(){this.api.dispose(),this.view.dispose()}}class dt extends z{get element(){return this._element}constructor(){super(),this._element=document.createElement("div"),this._element.className="dv-default-tab",this._content=document.createElement("div"),this._content.className="dv-default-tab-content",this.action=document.createElement("div"),this.action.className="dv-default-tab-action",this.action.appendChild(Bi()),this._element.appendChild(this._content),this._element.appendChild(this.action),this.render()}init(e){this._title=e.title,this.addDisposables(e.api.onDidTitleChange(t=>{this._title=t.title,this.render()}),G(this.action,"pointerdown",t=>{t.preventDefault()}),G(this.action,"click",t=>{t.defaultPrevented||(t.preventDefault(),e.api.close())})),this.render()}render(){var e;this._content.textContent!==this._title&&(this._content.textContent=(e=this._title)!==null&&e!==void 0?e:"")}}class kt{get content(){return this._content}get tab(){return this._tab}constructor(e,t,i,s){this.accessor=e,this.id=t,this.contentComponent=i,this.tabComponent=s,this._content=this.createContentComponent(this.id,i),this._tab=this.createTabComponent(this.id,s)}createTabRenderer(e){var t;const i=this.createTabComponent(this.id,this.tabComponent);return this._params&&i.init(Object.assign(Object.assign({},this._params),{tabLocation:e})),this._updateEvent&&((t=i.update)===null||t===void 0||t.call(i,this._updateEvent)),i}init(e){this._params=e,this.content.init(e),this.tab.init(Object.assign(Object.assign({},e),{tabLocation:"header"}))}layout(e,t){var i,s;(s=(i=this.content).layout)===null||s===void 0||s.call(i,e,t)}update(e){var t,i,s,n;this._updateEvent=e,(i=(t=this.content).update)===null||i===void 0||i.call(t,e),(n=(s=this.tab).update)===null||n===void 0||n.call(s,e)}dispose(){var e,t,i,s;(t=(e=this.content).dispose)===null||t===void 0||t.call(e),(s=(i=this.tab).dispose)===null||s===void 0||s.call(i)}createContentComponent(e,t){return this.accessor.options.createComponent({id:e,name:t})}createTabComponent(e,t){const i=t??this.accessor.options.defaultTabComponent;if(i){if(this.accessor.options.createTabComponent){const s=this.accessor.options.createTabComponent({id:e,name:i});return s||new dt}console.warn(`dockview: tabComponent '${t}' was not found. falling back to the default tab.`)}return new dt}}class ns{constructor(e){this.accessor=e}fromJSON(e,t){var i,s;const n=e.id,o=e.params,l=e.title,r=e.view,d=r?r.content.id:(i=e.contentComponent)!==null&&i!==void 0?i:"unknown",h=r?(s=r.tab)===null||s===void 0?void 0:s.id:e.tabComponent,c=new kt(this.accessor,n,d,h),m=new ve(n,d,h,this.accessor,new ze(this.accessor),t,c,{renderer:e.renderer,minimumWidth:e.minimumWidth,minimumHeight:e.minimumHeight,maximumWidth:e.maximumWidth,maximumHeight:e.maximumHeight});return m.init({title:l??n,params:o??{}}),m}}class os extends z{get element(){return this._element}constructor(){super(),this._element=document.createElement("div"),this._element.className="dv-watermark"}init(e){}}class rs{constructor(){this._orderedList=[]}push(e){this._orderedList=[...this._orderedList.filter(t=>t!==e),e],this.update()}destroy(e){this._orderedList=this._orderedList.filter(t=>t!==e),this.update()}update(){for(let e=0;e<this._orderedList.length;e++)this._orderedList[e].setAttribute("aria-level",`${e}`),this._orderedList[e].style.zIndex=`calc(var(--dv-overlay-z-index, 999) + ${e*2})`}}const Ce=new rs;class re extends z{set minimumInViewportWidth(e){this.options.minimumInViewportWidth=e}set minimumInViewportHeight(e){this.options.minimumInViewportHeight=e}get element(){return this._element}get isVisible(){return this._isVisible}constructor(e){super(),this.options=e,this._element=document.createElement("div"),this._onDidChange=new v,this.onDidChange=this._onDidChange.event,this._onDidChangeEnd=new v,this.onDidChangeEnd=this._onDidChangeEnd.event,this.addDisposables(this._onDidChange,this._onDidChangeEnd),this._element.className="dv-resize-container",this._isVisible=!0,this.setupResize("top"),this.setupResize("bottom"),this.setupResize("left"),this.setupResize("right"),this.setupResize("topleft"),this.setupResize("topright"),this.setupResize("bottomleft"),this.setupResize("bottomright"),this._element.appendChild(this.options.content),this.options.container.appendChild(this._element),this.setBounds(Object.assign(Object.assign(Object.assign(Object.assign({height:this.options.height,width:this.options.width},"top"in this.options&&{top:this.options.top}),"bottom"in this.options&&{bottom:this.options.bottom}),"left"in this.options&&{left:this.options.left}),"right"in this.options&&{right:this.options.right})),Ce.push(this._element)}setVisible(e){e!==this.isVisible&&(this._isVisible=e,E(this.element,"dv-hidden",!this.isVisible))}bringToFront(){Ce.push(this._element)}setBounds(e={}){typeof e.height=="number"&&(this._element.style.height=`${e.height}px`),typeof e.width=="number"&&(this._element.style.width=`${e.width}px`),"top"in e&&typeof e.top=="number"&&(this._element.style.top=`${e.top}px`,this._element.style.bottom="auto",this.verticalAlignment="top"),"bottom"in e&&typeof e.bottom=="number"&&(this._element.style.bottom=`${e.bottom}px`,this._element.style.top="auto",this.verticalAlignment="bottom"),"left"in e&&typeof e.left=="number"&&(this._element.style.left=`${e.left}px`,this._element.style.right="auto",this.horiziontalAlignment="left"),"right"in e&&typeof e.right=="number"&&(this._element.style.right=`${e.right}px`,this._element.style.left="auto",this.horiziontalAlignment="right");const t=this.options.container.getBoundingClientRect(),i=this._element.getBoundingClientRect(),s=Math.max(0,this.getMinimumWidth(i.width)),n=Math.max(0,this.getMinimumHeight(i.height));if(this.verticalAlignment==="top"){const o=V(i.top-t.top,-n,Math.max(0,t.height-i.height+n));this._element.style.top=`${o}px`,this._element.style.bottom="auto"}if(this.verticalAlignment==="bottom"){const o=V(t.bottom-i.bottom,-n,Math.max(0,t.height-i.height+n));this._element.style.bottom=`${o}px`,this._element.style.top="auto"}if(this.horiziontalAlignment==="left"){const o=V(i.left-t.left,-s,Math.max(0,t.width-i.width+s));this._element.style.left=`${o}px`,this._element.style.right="auto"}if(this.horiziontalAlignment==="right"){const o=V(t.right-i.right,-s,Math.max(0,t.width-i.width+s));this._element.style.right=`${o}px`,this._element.style.left="auto"}this._onDidChange.fire()}toJSON(){const e=this.options.container.getBoundingClientRect(),t=this._element.getBoundingClientRect(),i={};return this.verticalAlignment==="top"?i.top=parseFloat(this._element.style.top):this.verticalAlignment==="bottom"?i.bottom=parseFloat(this._element.style.bottom):i.top=t.top-e.top,this.horiziontalAlignment==="left"?i.left=parseFloat(this._element.style.left):this.horiziontalAlignment==="right"?i.right=parseFloat(this._element.style.right):i.left=t.left-e.left,i.width=t.width,i.height=t.height,i}setupDrag(e,t={inDragMode:!1}){const i=new J,s=()=>{let n=null;const o=Pe();i.value=new z({dispose:()=>{o.release()}},G(window,"pointermove",l=>{const r=this.options.container.getBoundingClientRect(),d=l.clientX-r.left,h=l.clientY-r.top;E(this._element,"dv-resize-container-dragging",!0);const c=this._element.getBoundingClientRect();n===null&&(n={x:l.clientX-c.left,y:l.clientY-c.top});const m=Math.max(0,this.getMinimumWidth(c.width)),p=Math.max(0,this.getMinimumHeight(c.height)),f=V(h-n.y,-p,Math.max(0,r.height-c.height+p)),u=V(n.y-h+r.height-c.height,-p,Math.max(0,r.height-c.height+p)),_=V(d-n.x,-m,Math.max(0,r.width-c.width+m)),A=V(n.x-d+r.width-c.width,-m,Math.max(0,r.width-c.width+m)),y={};f<=u?y.top=f:y.bottom=u,_<=A?y.left=_:y.right=A,this.setBounds(y)}),G(window,"pointerup",()=>{E(this._element,"dv-resize-container-dragging",!1),i.dispose(),this._onDidChangeEnd.fire()}))};this.addDisposables(i,G(e,"pointerdown",n=>{if(n.defaultPrevented){n.preventDefault();return}ot(n)||s()}),G(this.options.content,"pointerdown",n=>{n.defaultPrevented||ot(n)||n.shiftKey&&s()}),G(this.options.content,"pointerdown",()=>{Ce.push(this._element)},!0)),t.inDragMode&&s()}setupResize(e){const t=document.createElement("div");t.className=`dv-resize-handle-${e}`,this._element.appendChild(t);const i=new J;this.addDisposables(i,G(t,"pointerdown",s=>{s.preventDefault();let n=null;const o=Pe();i.value=new z(G(window,"pointermove",l=>{const r=this.options.container.getBoundingClientRect(),d=this._element.getBoundingClientRect(),h=l.clientY-r.top,c=l.clientX-r.left;n===null&&(n={originalY:h,originalHeight:d.height,originalX:c,originalWidth:d.width});let m,p,f,u,_,A;const y=()=>{m=V(h,-Number.MAX_VALUE,n.originalY+n.originalHeight>r.height?this.getMinimumHeight(r.height):Math.max(0,n.originalY+n.originalHeight-re.MINIMUM_HEIGHT)),f=n.originalY+n.originalHeight-m,p=r.height-m-f},C=()=>{m=n.originalY-n.originalHeight,f=V(h-m,m<0&&typeof this.options.minimumInViewportHeight=="number"?-m+this.options.minimumInViewportHeight:re.MINIMUM_HEIGHT,Number.MAX_VALUE),p=r.height-m-f},x=()=>{u=V(c,-Number.MAX_VALUE,n.originalX+n.originalWidth>r.width?this.getMinimumWidth(r.width):Math.max(0,n.originalX+n.originalWidth-re.MINIMUM_WIDTH)),A=n.originalX+n.originalWidth-u,_=r.width-u-A},I=()=>{u=n.originalX-n.originalWidth,A=V(c-u,u<0&&typeof this.options.minimumInViewportWidth=="number"?-u+this.options.minimumInViewportWidth:re.MINIMUM_WIDTH,Number.MAX_VALUE),_=r.width-u-A};switch(e){case"top":y();break;case"bottom":C();break;case"left":x();break;case"right":I();break;case"topleft":y(),x();break;case"topright":y(),I();break;case"bottomleft":C(),x();break;case"bottomright":C(),I();break}const D={};m<=p?D.top=m:D.bottom=p,u<=_?D.left=u:D.right=_,D.height=f,D.width=A,this.setBounds(D)}),{dispose:()=>{o.release()}},G(window,"pointerup",()=>{i.dispose(),this._onDidChangeEnd.fire()}))}))}getMinimumWidth(e){return typeof this.options.minimumInViewportWidth=="number"?e-this.options.minimumInViewportWidth:0}getMinimumHeight(e){return typeof this.options.minimumInViewportHeight=="number"?e-this.options.minimumInViewportHeight:0}dispose(){Ce.destroy(this._element),this._element.remove(),super.dispose()}}re.MINIMUM_HEIGHT=20;re.MINIMUM_WIDTH=20;class as extends z{constructor(e,t){super(),this.group=e,this.overlay=t,this.addDisposables(t)}position(e){this.overlay.setBounds(e)}}const xe=100,oe={left:100,top:100,width:300,height:300};function ls(){const a=document.createElement("div");return a.tabIndex=-1,a}class ct extends z{constructor(e,t){super(),this.element=e,this.accessor=t,this.map={},this._disposed=!1,this.addDisposables(F.from(()=>{for(const i of Object.values(this.map))i.disposable.dispose(),i.destroy.dispose();this._disposed=!0}))}detatch(e){if(this.map[e.api.id]){const{disposable:t,destroy:i}=this.map[e.api.id];return t.dispose(),i.dispose(),delete this.map[e.api.id],!0}return!1}attach(e){const{panel:t,referenceContainer:i}=e;if(!this.map[t.api.id]){const h=ls();h.className="dv-render-overlay",this.map[t.api.id]={panel:t,disposable:F.NONE,destroy:F.NONE,element:h}}const s=this.map[t.api.id].element;t.view.content.element.parentElement!==s&&s.appendChild(t.view.content.element),s.parentElement!==this.element&&this.element.appendChild(s);const n=()=>{const h=Ee(i.element),c=Ee(this.element);s.style.left=`${h.left-c.left}px`,s.style.top=`${h.top-c.top}px`,s.style.width=`${h.width}px`,s.style.height=`${h.height}px`,E(s,"dv-render-overlay-float",t.group.api.location.type==="floating")},o=()=>{t.api.isVisible&&n(),s.style.display=t.api.isVisible?"":"none"},l=new J,r=()=>{t.api.location.type==="floating"?queueMicrotask(()=>{const h=this.accessor.floatingGroups.find(f=>f.group===t.api.group);if(!h)return;const c=h.overlay.element,m=()=>{const f=Number(c.getAttribute("aria-level"));s.style.zIndex=`calc(var(--dv-overlay-z-index, 999) + ${f*2+1})`},p=new MutationObserver(()=>{m()});l.value=F.from(()=>p.disconnect()),p.observe(c,{attributeFilter:["aria-level"],attributes:!0}),m()}):s.style.zIndex=""},d=new z(l,new Et(s,{onDragEnd:h=>{i.dropTarget.dnd.onDragEnd(h)},onDragEnter:h=>{i.dropTarget.dnd.onDragEnter(h)},onDragLeave:h=>{i.dropTarget.dnd.onDragLeave(h)},onDrop:h=>{i.dropTarget.dnd.onDrop(h)},onDragOver:h=>{i.dropTarget.dnd.onDragOver(h)}}),t.api.onDidVisibilityChange(()=>{o()}),t.api.onDidDimensionsChange(()=>{t.api.isVisible&&n()}),t.api.onDidLocationChange(()=>{r()}));return this.map[t.api.id].destroy=F.from(()=>{var h;t.view.content.element.parentElement===s&&s.removeChild(t.view.content.element),(h=s.parentElement)===null||h===void 0||h.removeChild(s)}),r(),queueMicrotask(()=>{this.isDisposed||o()}),this.map[t.api.id].disposable.dispose(),this.map[t.api.id].disposable=d,s}}var hs=function(a,e,t,i){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function l(h){try{d(i.next(h))}catch(c){o(c)}}function r(h){try{d(i.throw(h))}catch(c){o(c)}}function d(h){h.done?n(h.value):s(h.value).then(l,r)}d((i=i.apply(a,e||[])).next())})};class ds extends z{get window(){var e,t;return(t=(e=this._window)===null||e===void 0?void 0:e.value)!==null&&t!==void 0?t:null}constructor(e,t,i){super(),this.target=e,this.className=t,this.options=i,this._onWillClose=new v,this.onWillClose=this._onWillClose.event,this._onDidClose=new v,this.onDidClose=this._onDidClose.event,this._window=null,this.addDisposables(this._onWillClose,this._onDidClose,{dispose:()=>{this.close()}})}dimensions(){if(!this._window)return null;const e=this._window.value.screenX,t=this._window.value.screenY,i=this._window.value.innerWidth,s=this._window.value.innerHeight;return{top:t,left:e,width:i,height:s}}close(){var e,t;this._window&&(this._onWillClose.fire(),(t=(e=this.options).onWillClose)===null||t===void 0||t.call(e,{id:this.target,window:this._window.value}),this._window.disposable.dispose(),this._window=null,this._onDidClose.fire())}open(){var e,t;return hs(this,void 0,void 0,function*(){if(this._window)throw new Error("instance of popout window is already open");const i=`${this.options.url}`,s=Object.entries({top:this.options.top,left:this.options.left,width:this.options.width,height:this.options.height}).map(([r,d])=>`${r}=${d}`).join(","),n=window.open(i,this.target,s);if(!n)return null;const o=new z;this._window={value:n,disposable:o},o.addDisposables(F.from(()=>{n.close()}),G(window,"beforeunload",()=>{this.close()}));const l=this.createPopoutWindowContainer();return this.className&&l.classList.add(this.className),(t=(e=this.options).onDidOpen)===null||t===void 0||t.call(e,{id:this.target,window:n}),new Promise((r,d)=>{n.addEventListener("unload",h=>{}),n.addEventListener("load",()=>{try{const h=n.document;h.title=document.title,h.body.appendChild(l),hi(h,window.document.styleSheets),G(n,"beforeunload",()=>{this.close()}),r(l)}catch(h){d(h)}})})})}createPopoutWindowContainer(){const e=document.createElement("div");return e.classList.add("dv-popout-window"),e.id="dv-popout-window",e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.style.top="0px",e.style.left="0px",e}}class cs extends z{constructor(e){super(),this.accessor=e,this.init()}init(){const e=new Set,t=new Set;this.addDisposables(this.accessor.onDidAddPanel(i=>{if(e.has(i.api.id))throw new Error(`dockview: Invalid event sequence. [onDidAddPanel] called for panel ${i.api.id} but panel already exists`);e.add(i.api.id)}),this.accessor.onDidRemovePanel(i=>{if(e.has(i.api.id))e.delete(i.api.id);else throw new Error(`dockview: Invalid event sequence. [onDidRemovePanel] called for panel ${i.api.id} but panel does not exists`)}),this.accessor.onDidAddGroup(i=>{if(t.has(i.api.id))throw new Error(`dockview: Invalid event sequence. [onDidAddGroup] called for group ${i.api.id} but group already exists`);t.add(i.api.id)}),this.accessor.onDidRemoveGroup(i=>{if(t.has(i.api.id))t.delete(i.api.id);else throw new Error(`dockview: Invalid event sequence. [onDidRemoveGroup] called for group ${i.api.id} but group does not exists`)}))}}class us extends z{constructor(e){super(),this.root=e,this._active=null,this._activeDisposable=new J,this._element=document.createElement("div"),this._element.className="dv-popover-anchor",this._element.style.position="relative",this.root.prepend(this._element),this.addDisposables(F.from(()=>{this.close()}),this._activeDisposable)}openPopover(e,t){this.close();const i=document.createElement("div");i.style.position="absolute",i.style.zIndex="99",i.appendChild(e);const s=this._element.getBoundingClientRect(),n=s.left,o=s.top;i.style.top=`${t.y-o}px`,i.style.left=`${t.x-n}px`,this._element.appendChild(i),this._active=i,this._activeDisposable.value=new z(G(window,"pointerdown",l=>{var r;const d=l.target;if(!(d instanceof HTMLElement))return;let h=d;for(;h&&h!==i;)h=(r=h==null?void 0:h.parentElement)!==null&&r!==void 0?r:null;h||this.close()}))}close(){this._active&&(this._active.remove(),this._activeDisposable.dispose(),this._active=null)}}class ut extends z{get disabled(){return this._disabled}set disabled(e){var t;this.disabled!==e&&(this._disabled=e,e&&((t=this.model)===null||t===void 0||t.clear()))}get model(){if(!this.disabled)return{clear:()=>{var e;this._model&&((e=this._model.root.parentElement)===null||e===void 0||e.removeChild(this._model.root)),this._model=void 0},exists:()=>!!this._model,getElements:(e,t)=>{const i=this._outline!==t;if(this._outline=t,this._model)return this._model.changed=i,this._model;const s=this.createContainer(),n=this.createAnchor();if(this._model={root:s,overlay:n,changed:i},s.appendChild(n),this.element.appendChild(s),(e==null?void 0:e.target)instanceof HTMLElement){const o=e.target.getBoundingClientRect(),l=this.element.getBoundingClientRect();n.style.left=`${o.left-l.left}px`,n.style.top=`${o.top-l.top}px`}return this._model}}}constructor(e,t){super(),this.element=e,this._disabled=!1,this._disabled=t.disabled,this.addDisposables(F.from(()=>{var i;(i=this.model)===null||i===void 0||i.clear()}))}createContainer(){const e=document.createElement("div");return e.className="dv-drop-target-container",e}createAnchor(){const e=document.createElement("div");return e.className="dv-drop-target-anchor",e.style.visibility="hidden",e}}const pt={activationSize:{type:"pixels",value:10},size:{type:"pixels",value:20}};function Me(a){const e=a.from.activePanel;[...a.from.panels].map(i=>{const s=a.from.model.removePanel(i);return a.from.model.renderContainer.detatch(i),s}).forEach(i=>{a.to.model.openPanel(i,{skipSetActive:e!==i,skipSetGroupActive:!0})})}class ps extends Ei{get orientation(){return this.gridview.orientation}get totalPanels(){return this.panels.length}get panels(){return this.groups.flatMap(e=>e.panels)}get options(){return this._options}get activePanel(){const e=this.activeGroup;if(e)return e.activePanel}get renderer(){var e;return(e=this.options.defaultRenderer)!==null&&e!==void 0?e:"onlyWhenVisible"}get api(){return this._api}get floatingGroups(){return this._floatingGroups}constructor(e,t){var i,s,n;super(e,{proportionalLayout:!0,orientation:P.HORIZONTAL,styles:t.hideBorders?{separatorBorder:"transparent"}:void 0,disableAutoResizing:t.disableAutoResizing,locked:t.locked,margin:(s=(i=t.theme)===null||i===void 0?void 0:i.gap)!==null&&s!==void 0?s:0,className:t.className}),this.nextGroupId=At(),this._deserializer=new ns(this),this._watermark=null,this._onWillDragPanel=new v,this.onWillDragPanel=this._onWillDragPanel.event,this._onWillDragGroup=new v,this.onWillDragGroup=this._onWillDragGroup.event,this._onDidDrop=new v,this.onDidDrop=this._onDidDrop.event,this._onWillDrop=new v,this.onWillDrop=this._onWillDrop.event,this._onWillShowOverlay=new v,this.onWillShowOverlay=this._onWillShowOverlay.event,this._onUnhandledDragOverEvent=new v,this.onUnhandledDragOverEvent=this._onUnhandledDragOverEvent.event,this._onDidRemovePanel=new v,this.onDidRemovePanel=this._onDidRemovePanel.event,this._onDidAddPanel=new v,this.onDidAddPanel=this._onDidAddPanel.event,this._onDidPopoutGroupSizeChange=new v,this.onDidPopoutGroupSizeChange=this._onDidPopoutGroupSizeChange.event,this._onDidPopoutGroupPositionChange=new v,this.onDidPopoutGroupPositionChange=this._onDidPopoutGroupPositionChange.event,this._onDidLayoutFromJSON=new v,this.onDidLayoutFromJSON=this._onDidLayoutFromJSON.event,this._onDidActivePanelChange=new v,this.onDidActivePanelChange=this._onDidActivePanelChange.event,this._onDidMovePanel=new v,this.onDidMovePanel=this._onDidMovePanel.event,this._onDidMaximizedGroupChange=new v,this.onDidMaximizedGroupChange=this._onDidMaximizedGroupChange.event,this._floatingGroups=[],this._popoutGroups=[],this._onDidRemoveGroup=new v,this.onDidRemoveGroup=this._onDidRemoveGroup.event,this._onDidAddGroup=new v,this.onDidAddGroup=this._onDidAddGroup.event,this._onDidOptionsChange=new v,this.onDidOptionsChange=this._onDidOptionsChange.event,this._onDidActiveGroupChange=new v,this.onDidActiveGroupChange=this._onDidActiveGroupChange.event,this._moving=!1,this._options=t,this.popupService=new us(this.element),this._themeClassnames=new Ct(this.element),this._api=new ze(this),this.rootDropTargetContainer=new ut(this.element,{disabled:!0}),this.overlayRenderContainer=new ct(this.gridview.element,this),this._rootDropTarget=new se(this.element,{className:"dv-drop-target-edge",canDisplayOverlay:(o,l)=>{const r=X();if(r)return r.viewId!==this.id?!1:l==="center"?this.gridview.length===0:!0;if(l==="center"&&this.gridview.length!==0)return!1;const d=new Gt(o,"edge",l,X);return this._onUnhandledDragOverEvent.fire(d),d.isAccepted},acceptedTargetZones:["top","bottom","left","right","center"],overlayModel:(n=t.rootOverlayModel)!==null&&n!==void 0?n:pt,getOverrideTarget:()=>{var o;return(o=this.rootDropTargetContainer)===null||o===void 0?void 0:o.model}}),this.updateDropTargetModel(t),E(this.gridview.element,"dv-dockview",!0),E(this.element,"dv-debug",!!t.debug),this.updateTheme(),this.updateWatermark(),t.debug&&this.addDisposables(new cs(this)),this.addDisposables(this.rootDropTargetContainer,this.overlayRenderContainer,this._onWillDragPanel,this._onWillDragGroup,this._onWillShowOverlay,this._onDidActivePanelChange,this._onDidAddPanel,this._onDidRemovePanel,this._onDidLayoutFromJSON,this._onDidDrop,this._onWillDrop,this._onDidMovePanel,this._onDidAddGroup,this._onDidRemoveGroup,this._onDidActiveGroupChange,this._onUnhandledDragOverEvent,this._onDidMaximizedGroupChange,this._onDidOptionsChange,this._onDidPopoutGroupSizeChange,this._onDidPopoutGroupPositionChange,this.onDidViewVisibilityChangeMicroTaskQueue(()=>{this.updateWatermark()}),this.onDidAdd(o=>{this._moving||this._onDidAddGroup.fire(o)}),this.onDidRemove(o=>{this._moving||this._onDidRemoveGroup.fire(o)}),this.onDidActiveChange(o=>{this._moving||this._onDidActiveGroupChange.fire(o)}),this.onDidMaximizedChange(o=>{this._onDidMaximizedGroupChange.fire({group:o.panel,isMaximized:o.isMaximized})}),de.any(this.onDidAdd,this.onDidRemove)(()=>{this.updateWatermark()}),de.any(this.onDidAddPanel,this.onDidRemovePanel,this.onDidAddGroup,this.onDidRemove,this.onDidMovePanel,this.onDidActivePanelChange,this.onDidPopoutGroupPositionChange,this.onDidPopoutGroupSizeChange)(()=>{this._bufferOnDidLayoutChange.fire()}),F.from(()=>{for(const o of[...this._floatingGroups])o.dispose();for(const o of[...this._popoutGroups])o.disposable.dispose()}),this._rootDropTarget,this._rootDropTarget.onWillShowOverlay(o=>{this.gridview.length>0&&o.position==="center"||this._onWillShowOverlay.fire(new Le(o,{kind:"edge",panel:void 0,api:this._api,group:void 0,getData:X}))}),this._rootDropTarget.onDrop(o=>{var l;const r=new Ot({nativeEvent:o.nativeEvent,position:o.position,panel:void 0,api:this._api,group:void 0,getData:X,kind:"edge"});if(this._onWillDrop.fire(r),r.defaultPrevented)return;const d=X();d?this.moveGroupOrPanel({from:{groupId:d.groupId,panelId:(l=d.panelId)!==null&&l!==void 0?l:void 0},to:{group:this.orthogonalize(o.position),position:"center"}}):this._onDidDrop.fire(new Ue({nativeEvent:o.nativeEvent,position:o.position,panel:void 0,api:this._api,group:void 0,getData:X}))}),this._rootDropTarget)}setVisible(e,t){switch(e.api.location.type){case"grid":super.setVisible(e,t);break;case"floating":{const i=this.floatingGroups.find(s=>s.group===e);i&&(i.overlay.setVisible(t),e.api._onDidVisibilityChange.fire({isVisible:t}));break}case"popout":console.warn("dockview: You cannot hide a group that is in a popout window");break}}addPopoutGroup(e,t){var i,s,n,o,l;if(e instanceof ve&&e.group.size===1)return this.addPopoutGroup(e.group,t);const r=pi(this.gridview.element),d=this.element;function h(){return t!=null&&t.position?t.position:e instanceof ht?e.element.getBoundingClientRect():e.group?e.group.element.getBoundingClientRect():d.getBoundingClientRect()}const c=h(),m=(s=(i=t==null?void 0:t.overridePopoutGroup)===null||i===void 0?void 0:i.id)!==null&&s!==void 0?s:this.getNextGroupId(),p=new ds(`${this.id}-${m}`,r??"",{url:(l=(n=t==null?void 0:t.popoutUrl)!==null&&n!==void 0?n:(o=this.options)===null||o===void 0?void 0:o.popoutUrl)!==null&&l!==void 0?l:"/popout.html",left:window.screenX+c.left,top:window.screenY+c.top,width:c.width,height:c.height,onDidOpen:t==null?void 0:t.onDidOpen,onWillClose:t==null?void 0:t.onWillClose}),f=new z(p,p.onDidClose(()=>{f.dispose()}));return p.open().then(u=>{var _;if(p.isDisposed)return!1;if(u===null)return f.dispose(),!1;const A=document.createElement("div");A.className="dv-overlay-render-container";const y=new ct(A,this),C=e instanceof ve?e.group:e,x=e.api.location.type,I=C.element.parentElement!==null;let D;I?t!=null&&t.overridePopoutGroup?D=t.overridePopoutGroup:(D=this.createGroup({id:m}),this._onDidAddGroup.fire(D)):D=C,D.model.renderContainer=y,D.layout(p.window.innerWidth,p.window.innerHeight);let H;if(!(t!=null&&t.overridePopoutGroup)&&I)if(e instanceof ve)this.movingLock(()=>{const M=C.model.removePanel(e);D.model.openPanel(M)});else switch(this.movingLock(()=>Me({from:C,to:D})),x){case"grid":C.api.setVisible(!1);break;case"floating":case"popout":H=(_=this._floatingGroups.find(M=>M.group.api.id===e.api.id))===null||_===void 0?void 0:_.overlay.toJSON(),this.removeGroup(C);break}u.classList.add("dv-dockview"),u.style.overflow="hidden",u.appendChild(A),u.appendChild(D.element);const W=document.createElement("div"),L=new ut(W,{disabled:this.rootDropTargetContainer.disabled});u.appendChild(W),D.model.dropTargetContainer=L,D.model.location={type:"popout",getWindow:()=>p.window,popoutUrl:t==null?void 0:t.popoutUrl},I&&e.api.location.type==="grid"&&e.api.setVisible(!1),this.doSetGroupAndPanelActive(D),f.addDisposables(D.api.onDidActiveChange(M=>{var b;M.isActive&&((b=p.window)===null||b===void 0||b.focus())}),D.api.onWillFocus(()=>{var M;(M=p.window)===null||M===void 0||M.focus()}));let k;const K=I&&C&&this.getPanel(C.id),ee={window:p,popoutGroup:D,referenceGroup:K?C.id:void 0,disposable:{dispose:()=>(f.dispose(),k)}},T=vi(p.window);return f.addDisposables(T,gi(p.window,()=>{this._onDidPopoutGroupSizeChange.fire({width:p.window.innerWidth,height:p.window.innerHeight,group:D})}),T.event(()=>{this._onDidPopoutGroupPositionChange.fire({screenX:p.window.screenX,screenY:p.window.screenX,group:D})}),G(p.window,"resize",()=>{D.layout(p.window.innerWidth,p.window.innerHeight)}),y,F.from(()=>{if(!this.isDisposed){if(I&&this.getPanel(C.id))this.movingLock(()=>Me({from:D,to:C})),C.api.isVisible||C.api.setVisible(!0),this.getPanel(D.id)&&this.doRemoveGroup(D,{skipPopoutAssociated:!0});else if(this.getPanel(D.id)){if(D.model.renderContainer=this.overlayRenderContainer,D.model.dropTargetContainer=this.rootDropTargetContainer,k=D,!this._popoutGroups.find(b=>b.popoutGroup===D))return;H?this.addFloatingGroup(D,{height:H.height,width:H.width,position:H}):(this.doRemoveGroup(D,{skipDispose:!0,skipActive:!0,skipPopoutReturn:!0}),D.model.location={type:"grid"},this.movingLock(()=>{this.doAddGroup(D,[0])})),this.doSetGroupAndPanelActive(D)}}})),this._popoutGroups.push(ee),this.updateWatermark(),!0}).catch(u=>(console.error("dockview: failed to create popout window",u),!1))}addFloatingGroup(e,t){var i,s,n,o,l;let r;if(e instanceof ve)r=this.createGroup(),this._onDidAddGroup.fire(r),this.movingLock(()=>this.removePanel(e,{removeEmptyGroup:!0,skipDispose:!0,skipSetActiveGroup:!0})),this.movingLock(()=>r.model.openPanel(e,{skipSetGroupActive:!0}));else{r=e;const u=(i=this._popoutGroups.find(y=>y.popoutGroup===r))===null||i===void 0?void 0:i.referenceGroup,_=u?this.getPanel(u):void 0;typeof(t==null?void 0:t.skipRemoveGroup)=="boolean"&&t.skipRemoveGroup||(_?(this.movingLock(()=>Me({from:e,to:_})),this.doRemoveGroup(e,{skipPopoutReturn:!0,skipPopoutAssociated:!0}),this.doRemoveGroup(_,{skipDispose:!0}),r=_):this.doRemoveGroup(e,{skipDispose:!0,skipPopoutReturn:!0,skipPopoutAssociated:!1}))}function d(){if(t!=null&&t.position){const u={};return"left"in t.position?u.left=Math.max(t.position.left,0):"right"in t.position?u.right=Math.max(t.position.right,0):u.left=oe.left,"top"in t.position?u.top=Math.max(t.position.top,0):"bottom"in t.position?u.bottom=Math.max(t.position.bottom,0):u.top=oe.top,typeof t.width=="number"?u.width=Math.max(t.width,0):u.width=oe.width,typeof t.height=="number"?u.height=Math.max(t.height,0):u.height=oe.height,u}return{left:typeof(t==null?void 0:t.x)=="number"?Math.max(t.x,0):oe.left,top:typeof(t==null?void 0:t.y)=="number"?Math.max(t.y,0):oe.top,width:typeof(t==null?void 0:t.width)=="number"?Math.max(t.width,0):oe.width,height:typeof(t==null?void 0:t.height)=="number"?Math.max(t.height,0):oe.height}}const h=d(),c=new re(Object.assign(Object.assign({container:this.gridview.element,content:r.element},h),{minimumInViewportWidth:this.options.floatingGroupBounds==="boundedWithinViewport"?void 0:(n=(s=this.options.floatingGroupBounds)===null||s===void 0?void 0:s.minimumWidthWithinViewport)!==null&&n!==void 0?n:xe,minimumInViewportHeight:this.options.floatingGroupBounds==="boundedWithinViewport"?void 0:(l=(o=this.options.floatingGroupBounds)===null||o===void 0?void 0:o.minimumHeightWithinViewport)!==null&&l!==void 0?l:xe})),m=r.element.querySelector(".dv-void-container");if(!m)throw new Error("failed to find drag handle");c.setupDrag(m,{inDragMode:typeof(t==null?void 0:t.inDragMode)=="boolean"?t.inDragMode:!1});const p=new as(r,c),f=new z(r.api.onDidActiveChange(u=>{u.isActive&&c.bringToFront()}),Ge(r.element,u=>{const{width:_,height:A}=u.contentRect;r.layout(_,A)}));p.addDisposables(c.onDidChange(()=>{r.layout(r.width,r.height)}),c.onDidChangeEnd(()=>{this._bufferOnDidLayoutChange.fire()}),r.onDidChange(u=>{c.setBounds({height:u==null?void 0:u.height,width:u==null?void 0:u.width})}),{dispose:()=>{f.dispose(),Ve(this._floatingGroups,p),r.model.location={type:"grid"},this.updateWatermark()}}),this._floatingGroups.push(p),r.model.location={type:"floating"},t!=null&&t.skipActiveGroup||this.doSetGroupAndPanelActive(r),this.updateWatermark()}orthogonalize(e,t){switch(e){case"top":case"bottom":this.gridview.orientation===P.HORIZONTAL&&this.gridview.insertOrthogonalSplitviewAtRoot();break;case"left":case"right":this.gridview.orientation===P.VERTICAL&&this.gridview.insertOrthogonalSplitviewAtRoot();break}switch(e){case"top":case"left":case"center":return this.createGroupAtLocation([0],void 0,t);case"bottom":case"right":return this.createGroupAtLocation([this.gridview.length],void 0,t);default:throw new Error(`unsupported position ${e}`)}}updateOptions(e){var t,i;if(super.updateOptions(e),"floatingGroupBounds"in e)for(const s of this._floatingGroups){switch(e.floatingGroupBounds){case"boundedWithinViewport":s.overlay.minimumInViewportHeight=void 0,s.overlay.minimumInViewportWidth=void 0;break;case void 0:s.overlay.minimumInViewportHeight=xe,s.overlay.minimumInViewportWidth=xe;break;default:s.overlay.minimumInViewportHeight=(t=e.floatingGroupBounds)===null||t===void 0?void 0:t.minimumHeightWithinViewport,s.overlay.minimumInViewportWidth=(i=e.floatingGroupBounds)===null||i===void 0?void 0:i.minimumWidthWithinViewport}s.overlay.setBounds()}this.updateDropTargetModel(e),this._options=Object.assign(Object.assign({},this.options),e),"theme"in e&&this.updateTheme(),this.layout(this.gridview.width,this.gridview.height,!0)}layout(e,t,i){if(super.layout(e,t,i),this._floatingGroups)for(const s of this._floatingGroups)s.overlay.setBounds()}focus(){var e;(e=this.activeGroup)===null||e===void 0||e.focus()}getGroupPanel(e){return this.panels.find(t=>t.id===e)}setActivePanel(e){e.group.model.openPanel(e),this.doSetGroupAndPanelActive(e.group)}moveToNext(e={}){var t;if(!e.group){if(!this.activeGroup)return;e.group=this.activeGroup}if(e.includePanel&&e.group&&e.group.activePanel!==e.group.panels[e.group.panels.length-1]){e.group.model.moveToNext({suppressRoll:!0});return}const i=B(e.group.element),s=(t=this.gridview.next(i))===null||t===void 0?void 0:t.view;this.doSetGroupAndPanelActive(s)}moveToPrevious(e={}){var t;if(!e.group){if(!this.activeGroup)return;e.group=this.activeGroup}if(e.includePanel&&e.group&&e.group.activePanel!==e.group.panels[0]){e.group.model.moveToPrevious({suppressRoll:!0});return}const i=B(e.group.element),s=(t=this.gridview.previous(i))===null||t===void 0?void 0:t.view;s&&this.doSetGroupAndPanelActive(s)}toJSON(){var e;const t=this.gridview.serialize(),i=this.panels.reduce((l,r)=>(l[r.id]=r.toJSON(),l),{}),s=this._floatingGroups.map(l=>({data:l.group.toJSON(),position:l.overlay.toJSON()})),n=this._popoutGroups.map(l=>({data:l.popoutGroup.toJSON(),gridReferenceGroup:l.referenceGroup,position:l.window.dimensions(),url:l.popoutGroup.api.location.type==="popout"?l.popoutGroup.api.location.popoutUrl:void 0})),o={grid:t,panels:i,activeGroup:(e=this.activeGroup)===null||e===void 0?void 0:e.id};return s.length>0&&(o.floatingGroups=s),n.length>0&&(o.popoutGroups=n),o}fromJSON(e){var t,i,s;if(this.clear(),typeof e!="object"||e===null)throw new Error("serialized layout must be a non-null object");const{grid:n,panels:o,activeGroup:l}=e;if(n.root.type!=="branch"||!Array.isArray(n.root.data))throw new Error("root must be of type branch");try{const r=this.width,d=this.height,h=p=>{const{id:f,locked:u,hideHeader:_,views:A,activeView:y}=p;if(typeof f!="string")throw new Error("group id must be of type string");const C=this.createGroup({id:f,locked:!!u,hideHeader:!!_});this._onDidAddGroup.fire(C);const x=[];for(const I of A){const D=this._deserializer.fromJSON(o[I],C);x.push(D)}for(let I=0;I<A.length;I++){const D=x[I],H=typeof y=="string"&&y===D.id;C.model.openPanel(D,{skipSetActive:!H,skipSetGroupActive:!0})}return!C.activePanel&&C.panels.length>0&&C.model.openPanel(C.panels[C.panels.length-1],{skipSetGroupActive:!0}),C};this.gridview.deserialize(n,{fromJSON:p=>h(p.data)}),this.layout(r,d,!0);const c=(t=e.floatingGroups)!==null&&t!==void 0?t:[];for(const p of c){const{data:f,position:u}=p,_=h(f);this.addFloatingGroup(_,{position:u,width:u.width,height:u.height,skipRemoveGroup:!0,inDragMode:!1})}const m=(i=e.popoutGroups)!==null&&i!==void 0?i:[];for(const p of m){const{data:f,position:u,gridReferenceGroup:_,url:A}=p,y=h(f);this.addPopoutGroup((s=_?this.getPanel(_):void 0)!==null&&s!==void 0?s:y,{position:u??void 0,overridePopoutGroup:_?y:void 0,popoutUrl:A})}for(const p of this._floatingGroups)p.overlay.setBounds();if(typeof l=="string"){const p=this.getPanel(l);p&&this.doSetGroupAndPanelActive(p)}}catch(r){console.error("dockview: failed to deserialize layout. Reverting changes",r);for(const d of this.groups)for(const h of d.panels)this.removePanel(h,{removeEmptyGroup:!1,skipDispose:!1});for(const d of this.groups)d.dispose(),this._groups.delete(d.id),this._onDidRemoveGroup.fire(d);for(const d of[...this._floatingGroups])d.dispose();throw this.clear(),r}this.updateWatermark(),this._onDidLayoutFromJSON.fire()}clear(){const e=Array.from(this._groups.values()).map(i=>i.value),t=!!this.activeGroup;for(const i of e)this.removeGroup(i,{skipActive:!0});t&&this.doSetGroupAndPanelActive(void 0),this.gridview.clear()}closeAllGroups(){for(const e of this._groups.entries()){const[t,i]=e;i.value.model.closeAllPanels()}}addPanel(e){var t,i;if(this.panels.find(r=>r.id===e.id))throw new Error(`panel with id ${e.id} already exists`);let s;if(e.position&&e.floating)throw new Error("you can only provide one of: position, floating as arguments to .addPanel(...)");const n={width:e.initialWidth,height:e.initialHeight};let o;if(e.position)if(Yi(e.position)){const r=typeof e.position.referencePanel=="string"?this.getGroupPanel(e.position.referencePanel):e.position.referencePanel;if(o=e.position.index,!r)throw new Error(`referencePanel '${e.position.referencePanel}' does not exist`);s=this.findGroup(r)}else if(Zi(e.position)){if(s=typeof e.position.referenceGroup=="string"?(t=this._groups.get(e.position.referenceGroup))===null||t===void 0?void 0:t.value:e.position.referenceGroup,o=e.position.index,!s)throw new Error(`referenceGroup '${e.position.referenceGroup}' does not exist`)}else{const r=this.orthogonalize(lt(e.position.direction)),d=this.createPanel(e,r);return r.model.openPanel(d,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:o}),e.inactive||this.doSetGroupAndPanelActive(r),r.api.setSize({height:n==null?void 0:n.height,width:n==null?void 0:n.width}),d}else s=this.activeGroup;let l;if(s){const r=at(((i=e.position)===null||i===void 0?void 0:i.direction)||"within");if(e.floating){const d=this.createGroup();this._onDidAddGroup.fire(d);const h=typeof e.floating=="object"&&e.floating!==null?e.floating:{};this.addFloatingGroup(d,Object.assign(Object.assign({},h),{inDragMode:!1,skipRemoveGroup:!0,skipActiveGroup:!0})),l=this.createPanel(e,d),d.model.openPanel(l,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:o})}else if(s.api.location.type==="floating"||r==="center")l=this.createPanel(e,s),s.model.openPanel(l,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:o}),s.api.setSize({width:n==null?void 0:n.width,height:n==null?void 0:n.height}),e.inactive||this.doSetGroupAndPanelActive(s);else{const d=B(s.element),h=me(this.gridview.orientation,d,r),c=this.createGroupAtLocation(h,this.orientationAtLocation(h)===P.VERTICAL?n==null?void 0:n.height:n==null?void 0:n.width);l=this.createPanel(e,c),c.model.openPanel(l,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:o}),e.inactive||this.doSetGroupAndPanelActive(c)}}else if(e.floating){const r=this.createGroup();this._onDidAddGroup.fire(r);const d=typeof e.floating=="object"&&e.floating!==null?e.floating:{};this.addFloatingGroup(r,Object.assign(Object.assign({},d),{inDragMode:!1,skipRemoveGroup:!0,skipActiveGroup:!0})),l=this.createPanel(e,r),r.model.openPanel(l,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:o})}else{const r=this.createGroupAtLocation([0],this.gridview.orientation===P.VERTICAL?n==null?void 0:n.height:n==null?void 0:n.width);l=this.createPanel(e,r),r.model.openPanel(l,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:o}),e.inactive||this.doSetGroupAndPanelActive(r)}return l}removePanel(e,t={removeEmptyGroup:!0}){const i=e.group;if(!i)throw new Error(`cannot remove panel ${e.id}. it's missing a group.`);i.model.removePanel(e,{skipSetActiveGroup:t.skipSetActiveGroup}),t.skipDispose||(e.group.model.renderContainer.detatch(e),e.dispose()),i.size===0&&t.removeEmptyGroup&&this.removeGroup(i,{skipActive:t.skipSetActiveGroup})}createWatermarkComponent(){return this.options.createWatermarkComponent?this.options.createWatermarkComponent():new os}updateWatermark(){var e,t;if(this.groups.filter(i=>i.api.location.type==="grid"&&i.api.isVisible).length===0){if(!this._watermark){this._watermark=this.createWatermarkComponent(),this._watermark.init({containerApi:new ze(this)});const i=document.createElement("div");i.className="dv-watermark-container",ci(i,"watermark-component"),i.appendChild(this._watermark.element),this.gridview.element.appendChild(i)}}else this._watermark&&(this._watermark.element.parentElement.remove(),(t=(e=this._watermark).dispose)===null||t===void 0||t.call(e),this._watermark=null)}addGroup(e){var t;if(e){let i;if(Ji(e)){const d=typeof e.referencePanel=="string"?this.panels.find(h=>h.id===e.referencePanel):e.referencePanel;if(!d)throw new Error(`reference panel ${e.referencePanel} does not exist`);if(i=this.findGroup(d),!i)throw new Error(`reference group for reference panel ${e.referencePanel} does not exist`)}else if(Ki(e)){if(i=typeof e.referenceGroup=="string"?(t=this._groups.get(e.referenceGroup))===null||t===void 0?void 0:t.value:e.referenceGroup,!i)throw new Error(`reference group ${e.referenceGroup} does not exist`)}else{const d=this.orthogonalize(lt(e.direction),e);return e.skipSetActive||this.doSetGroupAndPanelActive(d),d}const s=at(e.direction||"within"),n=B(i.element),o=me(this.gridview.orientation,n,s),l=this.createGroup(e),r=this.getLocationOrientation(o)===P.VERTICAL?e.initialHeight:e.initialWidth;return this.doAddGroup(l,o,r),e.skipSetActive||this.doSetGroupAndPanelActive(l),l}else{const i=this.createGroup(e);return this.doAddGroup(i),this.doSetGroupAndPanelActive(i),i}}getLocationOrientation(e){return e.length%2==0&&this.gridview.orientation===P.HORIZONTAL?P.HORIZONTAL:P.VERTICAL}removeGroup(e,t){this.doRemoveGroup(e,t)}doRemoveGroup(e,t){var i;const s=[...e.panels];if(!(t!=null&&t.skipDispose))for(const l of s)this.removePanel(l,{removeEmptyGroup:!1,skipDispose:(i=t==null?void 0:t.skipDispose)!==null&&i!==void 0?i:!1});const n=this.activePanel;if(e.api.location.type==="floating"){const l=this._floatingGroups.find(r=>r.group===e);if(l){if(t!=null&&t.skipDispose||(l.group.dispose(),this._groups.delete(e.id),this._onDidRemoveGroup.fire(e)),Ve(this._floatingGroups,l),l.dispose(),!(t!=null&&t.skipActive)&&this._activeGroup===e){const r=Array.from(this._groups.values());this.doSetGroupAndPanelActive(r.length>0?r[0].value:void 0)}return l.group}throw new Error("failed to find floating group")}if(e.api.location.type==="popout"){const l=this._popoutGroups.find(r=>r.popoutGroup===e);if(l){if(!(t!=null&&t.skipDispose)){if(!(t!=null&&t.skipPopoutAssociated)){const d=l.referenceGroup?this.getPanel(l.referenceGroup):void 0;d&&d.panels.length===0&&this.removeGroup(d)}l.popoutGroup.dispose(),this._groups.delete(e.id),this._onDidRemoveGroup.fire(e)}Ve(this._popoutGroups,l);const r=l.disposable.dispose();if(!(t!=null&&t.skipPopoutReturn)&&r&&(this.doAddGroup(r,[0]),this.doSetGroupAndPanelActive(r)),!(t!=null&&t.skipActive)&&this._activeGroup===e){const d=Array.from(this._groups.values());this.doSetGroupAndPanelActive(d.length>0?d[0].value:void 0)}return this.updateWatermark(),l.popoutGroup}throw new Error("failed to find popout group")}const o=super.doRemoveGroup(e,t);return t!=null&&t.skipActive||this.activePanel!==n&&this._onDidActivePanelChange.fire(this.activePanel),o}movingLock(e){const t=this._moving;try{return this._moving=!0,e()}finally{this._moving=t}}moveGroupOrPanel(e){var t;const i=e.to.group,s=e.from.groupId,n=e.from.panelId,o=e.to.position,l=e.to.index,r=s?(t=this._groups.get(s))===null||t===void 0?void 0:t.value:void 0;if(!r)throw new Error(`Failed to find group id ${s}`);if(n===void 0){this.moveGroup({from:{group:r},to:{group:i,position:o}});return}if(!o||o==="center"){const d=this.movingLock(()=>r.model.removePanel(n,{skipSetActive:!1,skipSetActiveGroup:!0}));if(!d)throw new Error(`No panel with id ${n}`);r.model.size===0&&this.doRemoveGroup(r,{skipActive:!0}),this.movingLock(()=>i.model.openPanel(d,{index:l,skipSetGroupActive:!0})),this.doSetGroupAndPanelActive(i),this._onDidMovePanel.fire({panel:d,from:r})}else{const d=B(i.element),h=me(this.gridview.orientation,d,o);if(r.size<2){const[c,m]=he(h);if(r.api.location.type==="grid"){const _=B(r.element),[A,y]=he(_);if(fi(A,c)){this.gridview.moveView(A,y,m),this._onDidMovePanel.fire({panel:this.getGroupPanel(n),from:r});return}}if(r.api.location.type==="popout"){const _=this._popoutGroups.find(C=>C.popoutGroup===r),A=this.movingLock(()=>_.popoutGroup.model.removePanel(_.popoutGroup.panels[0],{skipSetActive:!0,skipSetActiveGroup:!0}));this.doRemoveGroup(r,{skipActive:!0});const y=this.createGroupAtLocation(h);this.movingLock(()=>y.model.openPanel(A)),this.doSetGroupAndPanelActive(y),this._onDidMovePanel.fire({panel:this.getGroupPanel(n),from:r});return}const p=this.movingLock(()=>this.doRemoveGroup(r,{skipActive:!0,skipDispose:!0})),f=B(i.element),u=me(this.gridview.orientation,f,o);this.movingLock(()=>this.doAddGroup(p,u)),this.doSetGroupAndPanelActive(p),this._onDidMovePanel.fire({panel:this.getGroupPanel(n),from:r})}else{const c=this.movingLock(()=>r.model.removePanel(n,{skipSetActive:!1,skipSetActiveGroup:!0}));if(!c)throw new Error(`No panel with id ${n}`);const m=me(this.gridview.orientation,d,o),p=this.createGroupAtLocation(m);this.movingLock(()=>p.model.openPanel(c,{skipSetGroupActive:!0})),this.doSetGroupAndPanelActive(p),this._onDidMovePanel.fire({panel:c,from:r})}}}moveGroup(e){const t=e.from.group,i=e.to.group,s=e.to.position;if(s==="center"){const n=t.activePanel,o=this.movingLock(()=>[...t.panels].map(l=>t.model.removePanel(l.id,{skipSetActive:!0})));(t==null?void 0:t.model.size)===0&&this.doRemoveGroup(t,{skipActive:!0}),this.movingLock(()=>{for(const l of o)i.model.openPanel(l,{skipSetActive:l!==n,skipSetGroupActive:!0})}),this.doSetGroupAndPanelActive(i)}else{switch(t.api.location.type){case"grid":this.gridview.removeView(B(t.element));break;case"floating":{const r=this._floatingGroups.find(d=>d.group===t);if(!r)throw new Error("failed to find floating group");r.dispose();break}case"popout":{const r=this._popoutGroups.find(d=>d.popoutGroup===t);if(!r)throw new Error("failed to find popout group");r.disposable.dispose()}}const n=B(i.element),o=me(this.gridview.orientation,n,s);let l;switch(this.gridview.orientation){case P.VERTICAL:l=n.length%2==0?t.api.width:t.api.height;break;case P.HORIZONTAL:l=n.length%2==0?t.api.height:t.api.width;break}this.gridview.addView(t,l,o)}t.panels.forEach(n=>{this._onDidMovePanel.fire({panel:n,from:t})})}doSetGroupActive(e){super.doSetGroupActive(e);const t=this.activePanel;!this._moving&&t!==this._onDidActivePanelChange.value&&this._onDidActivePanelChange.fire(t)}doSetGroupAndPanelActive(e){super.doSetGroupActive(e);const t=this.activePanel;e&&this.hasMaximizedGroup()&&!this.isMaximizedGroup(e)&&this.exitMaximizedGroup(),!this._moving&&t!==this._onDidActivePanelChange.value&&this._onDidActivePanelChange.fire(t)}getNextGroupId(){let e=this.nextGroupId.next();for(;this._groups.has(e);)e=this.nextGroupId.next();return e}createGroup(e){e||(e={});let t=e==null?void 0:e.id;if(t&&this._groups.has(e.id)&&(console.warn(`dockview: Duplicate group id ${e==null?void 0:e.id}. reassigning group id to avoid errors`),t=void 0),!t)for(t=this.nextGroupId.next();this._groups.has(t);)t=this.nextGroupId.next();const i=new ht(this,t,e);if(i.init({params:{},accessor:this}),!this._groups.has(i.id)){const s=new z(i.model.onTabDragStart(n=>{this._onWillDragPanel.fire(n)}),i.model.onGroupDragStart(n=>{this._onWillDragGroup.fire(n)}),i.model.onMove(n=>{const{groupId:o,itemId:l,target:r,index:d}=n;this.moveGroupOrPanel({from:{groupId:o,panelId:l},to:{group:i,position:r,index:d}})}),i.model.onDidDrop(n=>{this._onDidDrop.fire(n)}),i.model.onWillDrop(n=>{this._onWillDrop.fire(n)}),i.model.onWillShowOverlay(n=>{if(this.options.disableDnd){n.preventDefault();return}this._onWillShowOverlay.fire(n)}),i.model.onUnhandledDragOverEvent(n=>{this._onUnhandledDragOverEvent.fire(n)}),i.model.onDidAddPanel(n=>{this._moving||this._onDidAddPanel.fire(n.panel)}),i.model.onDidRemovePanel(n=>{this._moving||this._onDidRemovePanel.fire(n.panel)}),i.model.onDidActivePanelChange(n=>{this._moving||n.panel===this.activePanel&&this._onDidActivePanelChange.value!==n.panel&&this._onDidActivePanelChange.fire(n.panel)}),de.any(i.model.onDidPanelTitleChange,i.model.onDidPanelParametersChange)(()=>{this._bufferOnDidLayoutChange.fire()}));this._groups.set(i.id,{value:i,disposable:s})}return i.initialize(),i}createPanel(e,t){var i,s,n;const o=e.component,l=(i=e.tabComponent)!==null&&i!==void 0?i:this.options.defaultTabComponent,r=new kt(this,e.id,o,l),d=new ve(e.id,o,l,this,this._api,t,r,{renderer:e.renderer,minimumWidth:e.minimumWidth,minimumHeight:e.minimumHeight,maximumWidth:e.maximumWidth,maximumHeight:e.maximumHeight});return d.init({title:(s=e.title)!==null&&s!==void 0?s:e.id,params:(n=e==null?void 0:e.params)!==null&&n!==void 0?n:{}}),d}createGroupAtLocation(e,t,i){const s=this.createGroup(i);return this.doAddGroup(s,e,t),s}findGroup(e){var t;return(t=Array.from(this._groups.values()).find(i=>i.value.model.containsPanel(e)))===null||t===void 0?void 0:t.value}orientationAtLocation(e){const t=this.gridview.orientation;return e.length%2==1?t:ie(t)}updateDropTargetModel(e){"dndEdges"in e&&(this._rootDropTarget.disabled=typeof e.dndEdges=="boolean"&&e.dndEdges===!1,typeof e.dndEdges=="object"&&e.dndEdges!==null?this._rootDropTarget.setOverlayModel(e.dndEdges):this._rootDropTarget.setOverlayModel(pt)),"rootOverlayModel"in e&&this.updateDropTargetModel({dndEdges:e.dndEdges})}updateTheme(){var e,t;const i=(e=this._options.theme)!==null&&e!==void 0?e:Lt;switch(this._themeClassnames.setClassNames(i.className),this.gridview.margin=(t=i.gap)!==null&&t!==void 0?t:0,i.dndOverlayMounting){case"absolute":this.rootDropTargetContainer.disabled=!1;break;case"relative":default:this.rootDropTargetContainer.disabled=!0;break}}}function ms(a,e){return new ps(a,e).api}class vs{constructor(){g(this,"element");g(this,"state",new U("none"));g(this,"text",new U(""));const e=this.element=w.a`<div class="indicator">Attente</div>`;this.state.observable.add(({to:t})=>{e.classList.remove("_valid","_invalid","_waiting"),t=="valid"&&e.classList.add("_valid"),t=="invalid"&&e.classList.add("_invalid"),t=="wait"&&e.classList.add("_waiting")}),this.text.observable.add(({to:t})=>this.element.textContent=t)}set(e,t){this.state.value=e,this.text.value=t}}class gs{constructor(e,t){g(this,"url",new U(""));g(this,"wam",new U(null));g(this,"gui",new U(null));g(this,"parameters_info",{});g(this,"element",w.a`<div class="menu _vertical"></div>`);g(this,"indicator",new vs);this.host=e,this.audioContext=t;const i=w.a`<label>WAM URL</label>`,s=w.a`<input type="text" />`;s.onchange=()=>this.url.value=s.value;const n=w.a`<div class="container"></div>`;this.element.replaceChildren(i,s,n,this.indicator.element),this.url.observable.register(async({to:o})=>{var l;s.value=o,this.indicator.set("wait","Loading the WAM");try{let d=await((l=await import(o))==null?void 0:l.default).createInstance(this.host,this.audioContext);this.parameters_info=await d.audioNode.getParameterInfo(),this.indicator.set("valid","WAM loaded"),this.wam.value=d}catch(r){this.indicator.set("invalid","Error loading the WAM"),console.error(r)}}),this.wam.observable.register(async({from:o,to:l})=>{console.log("new gui"),this.indicator.set("wait","Loading the GUI"),o&&(o.destroyGui(this.gui.value),o.audioNode.destroy());try{if(l){const r=await l.createGui();n.replaceChildren(r),this.gui.value=r}else n.replaceChildren();this.indicator.set("valid","GUI loaded")}catch(r){this.indicator.set("invalid","Error loading the GUI"),console.error(r)}})}init(e){}}class fs{constructor(){g(this,"element",w.a`<div class="center_pane _contain"></div>`);g(this,"container");g(this,"engine");g(this,"scene");let e=w.a`<canvas width=500 height=500></canvas>`;this.element.appendChild(e),e.classList.add("container"),e.style.cssText=`
            display: flex;
            aspect-ratio: 1/1;
            width: 100%;
        `;let t=e.getContext("webgl2");this.engine=new Ut(t),this.scene=new jt(this.engine),this.scene.createDefaultLight(),this.scene.clearColor=new Xt(0,0,0,0);const i=new Yt("camera",-Math.PI/2,0,1.7,new it(0,0,0),this.scene);i.wheelPrecision=100,i.attachControl(),i.setTarget(it.Zero()),this.container=new Zt("node_container",this.scene)}init(e){this.engine.runRenderLoop(()=>this.scene.render())}dispose(){document.removeEventListener("keypress",this.key_handler),this.engine.stopRenderLoop()}}function Y(a){return Math.round(a*1e4)/100+"%"}class _s{constructor(){g(this,"_x");g(this,"_y");g(this,"_width");g(this,"_height");g(this,"element");g(this,"isPrecise",!1);g(this,"onmove",()=>{});g(this,"dragged",null);this.element=w.a`
            <div class="transformer">
                <div class="corner _1"></div>
                <div class="corner _2"></div>
                <div class="corner _3"></div>
                <div class="corner _4"></div>
                <div class="corner _5"></div>

                <div class="line _x _hidden"></div>
                <div class="line _y _hidden"></div>
            </div>
        `,this._width=1,this._height=1,this._x=0,this._y=0,this.element.style.width=Y(this.width),this.element.style.height=Y(this.height),this.element.style.left=Y(this.x),this.element.style.top=Y(this.y);const e=i=>{if(this.element.parentElement==null){window.removeEventListener("keydown",e),window.removeEventListener("keyup",t);return}i.key=="Control"&&(this.isPrecise=!0)},t=i=>{i.key=="Control"&&(this.isPrecise=!1)};window.addEventListener("keydown",e),window.addEventListener("keyup",t)}set x(e){e+this._width>1&&(e=1-this._width),e<0&&(e=0),this.element.style.left=Y(e),this._x=e,this.onmove(this.x,this.y,this.width,this.height)}get x(){return this._x}set y(e){e+this._height>1&&(e=1-this._height),e<0&&(e=0),this.element.style.top=Y(e),this._y=e,this.onmove(this.x,this.y,this.width,this.height)}get y(){return this._y}set width(e){this._x+e>1&&(e=1-this._x),e<.05&&(e=.05),this.element.style.width=Y(e),this._width=e,this.onmove(this.x,this.y,this.width,this.height)}get width(){return this._width}set height(e){this._y+e>1&&(e=1-this._y),e<.05&&(e=.05),this.element.style.height=Y(e),this._height=e,this.onmove(this.x,this.y,this.width,this.height)}get height(){return this._height}get center(){return[this.x+this.width/2,this.y+this.height/2]}setSizeAround(e,t,i,s){console.assert(e>=0&&e<=1&&t>=0&&t<=1),i<.05&&(i=.05),s<.05&&(s=.05);const n=this.x+this.width*e,o=this.y+this.height*t;i=Math.min(i,n/(e+1e-6),(1-n)/(1.00000001-e),1),s=Math.min(s,o/(t+1e-6),(1-o)/(1.00000001-t),1);const l=n-i*e,r=o-s*t;this._width=i,this._height=s,this._x=l,this._y=r,this.element.style.width=Y(this._width)+"%",this.element.style.height=Y(this._height)+"%",this.element.style.left=Y(this._x)+"%",this.element.style.top=Y(this._y)+"%",this.onmove(this.x,this.y,this.width,this.height)}set right(e){this.width=e-this.x}get right(){return this.x+this.width}set bottom(e){this.height=e-this.y}get bottom(){return this.y+this.height}set left(e){const t=e-this.x;this.right-=t,this.x+=t}get left(){return this.x}set top(e){const t=e-this.y;this.bottom-=t,this.y+=t}get top(){return this.y}startResizing(e,t,i,s){const[n,o,l,r]=(()=>{if(e==0)return[!0,!1,!0,!1];if(e==2)return[!1,!0,!1,!0];if(e==1)return[!1,!0,!0,!1];if(e==3)return[!0,!1,!1,!0];throw new Error("Invalid border id")})();this.dragged=this.element.children[e],this.dragged.classList.add("_dragged");const d=this.width,h=this.height,c=this.left,m=this.right,p=this.top,f=this.bottom,u=this.element.getBoundingClientRect();let _=y=>{if(this.dragged!=this.element.children[e]){window.removeEventListener("mousemove",_),this.element.children[e].classList.remove("_dragged");return}let C=(y.pageX-t)/u.width*d,x=(y.pageY-i)/u.height*h;const I=this.element.children[5],D=this.element.children[6];I.classList.add("_hidden"),D.classList.add("_hidden");const{horizontal:H,vertical:W}=s();if(n){let L=c+C;for(const k of H)if(!this.isPrecise&&Math.abs(L-k)<.01){L=k,I.classList.remove("_hidden"),I.style.left="0%";break}this.left=L}if(o){let L=m+C;for(const k of H)if(!this.isPrecise&&Math.abs(L-k)<.01){L=k,I.classList.remove("_hidden"),I.style.left="100%";break}this.right=L}if(l){let L=p+x;for(const k of W)if(!this.isPrecise&&Math.abs(L-k)<.01){L=k,D.classList.remove("_hidden"),D.style.top="0%";break}this.top=L}if(r){let L=f+x;for(const k of W)if(!this.isPrecise&&Math.abs(L-k)<.01){L=k,D.classList.remove("_hidden"),D.style.top="100%";break}this.bottom=L}},A=()=>{this.element.children[5].classList.add("_hidden"),this.element.children[6].classList.add("_hidden"),window.removeEventListener("mouseup",A)};window.addEventListener("mouseup",A),window.addEventListener("mousemove",_)}startMoving(e,t,i){this.dragged&&this.dragged.classList.remove("_dragged"),this.dragged=this.element.children[4],this.dragged.classList.add("_dragged");const s=this.element.getBoundingClientRect(),n=this.x,o=this.y;let l=d=>{if(this.dragged!=this.element.children[4]){window.removeEventListener("mousemove",l),this.element.children[4].classList.remove("_dragged");return}const h=this.element.children[5],c=this.element.children[6];h.classList.add("_hidden"),c.classList.add("_hidden");let m=n+(d.pageX-e)/s.width*this.width,p=o+(d.pageY-t)/s.height*this.height;const{horizontal:f,vertical:u}=i();for(const _ of f)if(!this.isPrecise&&Math.abs(m-_)<.01){m=_,h.classList.remove("_hidden"),h.style.left="0%";break}for(const _ of f)if(!this.isPrecise&&Math.abs(m+this.width-_)<.01){m=_-this.width,h.classList.remove("_hidden"),h.style.left="100%";break}for(const _ of u)if(!this.isPrecise&&Math.abs(p-_)<.01){p=_,c.classList.remove("_hidden"),c.style.top="0%";break}for(const _ of u)if(!this.isPrecise&&Math.abs(p+this.height-_)<.01){p=_-this.height,c.classList.remove("_hidden"),c.style.top="100%";break}this.x=m,this.y=p};window.addEventListener("mousemove",l);let r=()=>{this.element.children[5].classList.add("_hidden"),this.element.children[6].classList.add("_hidden"),window.removeEventListener("mouseup",r)};window.addEventListener("mouseup",r),window.addEventListener("mousemove",l)}registerEvents(e=()=>({horizontal:[],vertical:[]})){let t=()=>this.dragged=null;window.addEventListener("mouseup",t),window.addEventListener("blur",t);const i=s=>n=>{n.preventDefault(),this.startResizing(s,n.pageX,n.pageY,e)};this.element.children[0].addEventListener("mousedown",i(0)),this.element.children[2].addEventListener("mousedown",i(2)),this.element.children[1].addEventListener("mousedown",i(1)),this.element.children[3].addEventListener("mousedown",i(3)),this.element.children[4].addEventListener("mousedown",s=>{s.preventDefault(),this.startMoving(s.pageX,s.pageY,e)})}}var De,Fe;class ws{constructor(e,t,i=()=>({horizontal:[],vertical:[]})){tt(this,De);g(this,"on_select",()=>{});g(this,"on_unselect",()=>{});g(this,"on_move",()=>{});g(this,"_selecteds",new Set);g(this,"transformer",null);this.get_position=e,this.container=t,this.lines=i}set selecteds(e){for(const t of[...this._selecteds])this.unselect(t);for(const t of e)this.select(t)}get selecteds(){return this._selecteds}unselect_all(){for(const e of[...this._selecteds])this.unselect(e)}select(e){this._selecteds.has(e)||(this._selecteds.add(e),this.on_select(e),ke(this,De,Fe).call(this))}unselect(e){this._selecteds.has(e)&&(this._selecteds.delete(e),this.on_unselect(e),this.transformer&&(this.transformer.element.remove(),this.transformer=null),ke(this,De,Fe).call(this))}}De=new WeakSet,Fe=function(){if(this._selecteds.size>0){let e=Number.MAX_SAFE_INTEGER,t=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;for(const o of this.selecteds){const{x:l,y:r,width:d,height:h}=this.get_position(o);l<e&&(e=l),r<t&&(t=r),l+d>i&&(i=l+d),r+h>s&&(s=r+h)}this.transformer?(this.transformer.onmove=()=>{},this.transformer.left=0,this.transformer.top=0,this.transformer.width=1,this.transformer.height=1):(this.transformer=new _s,this.transformer.registerEvents(()=>this.lines([...this.selecteds.values()])),this.container.appendChild(this.transformer.element)),this.transformer.left=e,this.transformer.top=t,this.transformer.right=i,this.transformer.bottom=s;let n=[];for(const o of this.selecteds){const{x:l,y:r,width:d,height:h}=this.get_position(o);n.push({x:(l-e)/(i-e),y:(r-t)/(s-t),width:d/(i-e),height:h/(s-t)})}this.transformer.onmove=(o,l,r,d)=>{const h=[...this.selecteds];for(let c=0;c<h.length;c++){const m=h[c],p=n[c];this.on_move(m,p.x*r+o,p.y*d+l,p.width*r,p.height*d)}}}else this.transformer&&this.transformer.element.remove(),this.transformer=null};class bs{constructor(e,t){g(this,"container",w.a`<div class=container></div>`);g(this,"element",w.a`<div class="editor_pane center_pane _contain">${this.container}</div>`);g(this,"gui_generator");g(this,"selector");g(this,"on_select",new st);g(this,"on_unselect",new st);this.container.style.cssText=`
            display: flex;
            aspect-ratio: 1/1;
            width: 100%;
            overflow: hidden;
        `;const i={root:this.container,...we},s=t?{root:t,...we}:void 0;this.gui_generator=new U(ge.create({wam:e.value??void 0,html:i,babylonjs:s})),e.observable.register(({})=>{console.trace(),this.gui_generator.value.dispose(),this.gui_generator.value=ge.create({wam:e.value??void 0,html:i,babylonjs:s})}),this.selector=new ws(n=>n.infos,this.container,this.getTransformerLines.bind(this)),this.selector.on_move=(n,o,l,r,d)=>{const h=this.gui_generator.value.controls;if(!h)return;const c=h.values.indexOf(n.infos);h.move(c,o,l),h.resize(c,r,d)},this.selector.on_select=n=>this.on_select.notify(n),this.selector.on_unselect=n=>this.on_unselect.notify(n),this.gui_generator.link(({to:n})=>{n.controls.on_add.register(o=>{const{container:l}=o;l&&(l.onmousedown=r=>{var d;r.stopPropagation(),r.shiftKey?this.selector.select({element:l,infos:o}):this.selector.selecteds=[{element:l,infos:o}],(d=this.selector.transformer)==null||d.startMoving(r.pageX,r.pageY,()=>this.getTransformerLines([...this.selector.selecteds.values()]))})}),n.controls.on_remove.add(o=>{for(const l of this.selector.selecteds)l.infos==o&&this.selector.unselect(l)})}),this.container.addEventListener("mousedown",n=>{(n.target==this.container||n.target==this.gui_generator.value.pad_element)&&this.selector.unselect_all()})}getTransformerLines(e){const t=[],i=[];for(const s of this.gui_generator.value.controls.values)e.some(n=>n.infos==s)||(t.push(s.x),i.push(s.y),t.push(s.x+s.width),i.push(s.y+s.height),t.push(1-s.x),i.push(1-s.y),t.push(1-s.x-s.width),i.push(1-s.y-s.height));return{horizontal:t,vertical:i}}init(e){}}class Ds{constructor(e,t){g(this,"element",w.a`<div class=center_top_pane></div>`);g(this,"selected",new U(null));this.controls=e,this.generator=t}init(e){this.dispose_observable=this.generator.link(async()=>{var r;const t=this.generator.value,i=(r=this.selected.value)==null?void 0:r.key;let s=null;this.selected.value=null;const n=w.a`<ul class="item_selector _grid"></ul>`;this.element.replaceChildren(n);const o=this;async function l(d){let h=n.querySelectorAll(":scope > *");if(o.controls[d]){const c=o.controls[d],m=await t.getFactory(c);o.selected.value={key:d,factory:m,type:c},h.forEach(p=>p.classList.remove("_selected")),n.querySelector(`li[value="${d}"]`).classList.add("_selected")}}for(let[d,h]of Object.entries(this.controls)){let c=await t.getFactory(h),m=await c.create(),p=m.createElement(),f=n.appendChild(w.a`
                    <li value="${d}" title="${c.description}">
                        <div class="-icon">${p}</div>
                        <span class="-label">${c.label}</span>
                    </li>
                `);d==i&&(s=f),m.setDefaultValues(),f.onclick=()=>l(d)}s==null||s.click()})}dispose(){this.dispose_observable(),this.element.replaceChildren()}}class mt{constructor(e,t){g(this,"element");this.element=w.a`<input type="${e}" value="${t}">`}get(e){return this.element.value}set(e,t){this.element.value=(t==null?void 0:t.toString())??""}addOnChange(e){this.element.oninput=()=>e("",this.element.value)}}class ys{constructor(){g(this,"element");this.element=w.a`<input type="checkbox"/>`}get(e){return this.element.checked}set(e,t){this.element.checked=!!t}addOnChange(e){this.element.oninput=()=>e("",this.element.checked)}}class vt{constructor(e,t,i){g(this,"element");this.element=w.a`<input type="range" min="${e}" step="${i}" max="${t}" value="${e}">`}get(e){return this.element.valueAsNumber}set(e,t){this.element.value=(t==null?void 0:t.toString())??"0"}addOnChange(e){this.element.onchange=()=>e("",this.element.valueAsNumber)}}class Cs{constructor(e,t=e){g(this,"element");const i=e.map((s,n)=>w.a`<option value="${t[n]}">${s}</option>`);this.element=w.a`<select>${i}</select>`,this.element.options[0].selected=!0}get(e){return this.element.value}set(e,t){this.element.value=(t==null?void 0:t.toString())??""}addOnChange(e){this.element.onchange=()=>e("",this.element.value)}}class xs{constructor(e){g(this,"sub");g(this,"element");this.element=w.a`<input type="checkbox"/>`,this.sub=new Tt(e),this.element=w.a`<div class="menu _inner _vertical">${this.sub.element}</div>`}get(e){return this.sub.getValue(e)}set(e,t){return this.sub.setValue(e,t)}addOnChange(e){this.sub.on_value_change=(t,i)=>e(`/${t}`,i)}}class As{constructor(){g(this,"element",w.a`<span style="color:red;">Unsupported Setting</span>`)}get(e){return""}set(e,t){}addOnChange(e){}}class Tt{constructor(e){g(this,"on_value_change",()=>{});g(this,"parameters",{});let t=[];for(let[i,s]of Object.entries(e))t.push(this.addParameter(i,s));this.element=w`${t}`}addParameter(e,t){let i=null;return t=="color"?i=new mt("color","#ffffff"):t=="text"?i=new mt("text",""):t=="boolean"?i=new ys:Array.isArray(t)?i=new vt(t[0],t[1],(t[1]-t[0])/100):typeof t=="object"&&"min"in t?i=new vt(t.min,t.max,t.step):typeof t=="object"&&"choice"in t?i=new Cs(t.choice):t=="font"?i=new Jt:typeof t=="object"&&"sub"in t?i=new xs(t.sub):i=new As,i?(this.parameters[e]=i,i.addOnChange((s,n)=>{this.on_value_change(`${e}${s}`,n)}),w`<label>${e}</label>${i.element}`):w``}setValue(e,t){var n;const[i,s]=e.split("/",2);(n=this.parameters[i])==null||n.set(s??"",t)}getValue(e){var s;const[t,i]=e.split("/",2);return(s=this.parameters[t])==null?void 0:s.get(i??"")}setValues(e){for(let[t,i]of Object.entries(e))this.setValue(t,i)}getValues(){const e={};for(let t of Object.keys(this.parameters))e[t]=this.getValue(t);return e}}function Vt(a,e,t){for(let[i,s]of Object.entries(a))typeof s=="object"&&"sub"in s?Vt(s.sub,e,`${t}${i}/`):e[`${t}${i}`]=s}function Ss(a){const e={};return Vt(a,e,""),e}class Es{constructor(e){g(this,"settings",new U(null));g(this,"values",{});g(this,"title",w.a`<h3></h3>`);g(this,"description",w.a`<p></p>`);g(this,"settings_container",w.a`<div class="menu _vertical _scrollable _inner form_container"></div>`);g(this,"element",w.a`<div class="menu _vertical">${this.title}${this.description}${this.settings_container}</div>`);this.parameters_infos=e}init(e){this.settings.link(({to:t})=>{if(t){const{title:i,settings:s,getValue:n,setValue:o}=t;this.title.textContent=i,this.description.textContent=t.description;let l=new Tt(s);for(let[r,d]of Object.entries(Ss(s))){const h=n(r);h!=null&&l.setValue(r,h)}l.on_value_change=(r,d)=>o(r,d),this.settings_container.replaceChildren(l.element)}else{this.title.textContent="",this.settings_container.replaceChildren();return}})}}class Ps{constructor(...e){g(this,"element",w.a`<ul class="toolbar"></ul>`);g(this,"button_elements",{});g(this,"buttons",{});g(this,"on_input",e=>{if(document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement||document.activeElement instanceof HTMLSelectElement)return;const t=this.buttons[e.key];if(!t)return;const{action:i,id:s,alt:n,ctrl:o,shift:l}=t;this.button_elements[s].classList.contains("_disabled")||o&&!e.ctrlKey||l&&!e.shiftKey||n&&!e.altKey||(i(s),e.preventDefault())});for(const t of e)if(t=="separator")this.element.appendChild(w.a`<li><hr/></li>`);else{const{id:i,icon:s,label:n,action:o,disabled:l,shortcut:r,description:d}=t,h=(r??[]).map(p=>{let f="";return p.ctrl&&(f+="Ctrl "),p.shift&&(f+="Shift "),p.alt&&(f+="Alt "),f+=p.key.length==1?p.key.toUpperCase():p.key,f}).join(" or "),c=w.a`
                    <button class=tooltip_holder>
                        ${s}
                        <div class="-tooltip">
                            ${n}
                            <span class="-shortcut">${h}</span>
                            <span class="-description">${d??""}</span>
                        </div>
                    </button>
                `,m=w.a`<li>${c}</li>`;m.classList.toggle("_disabled",!!l),c.addEventListener("click",()=>o(i)),this.button_elements[i]=m,this.element.appendChild(m)}this.buttons={};for(const{action:t,shortcut:i,id:s}of e.filter(n=>typeof n=="object"&&"action"in n))for(let{key:n,alt:o,ctrl:l,shift:r}of i??[])this.buttons[n]={ctrl:l,alt:o,shift:r,action:t,id:s}}setDisabled(e,t){this.button_elements[e].classList.toggle("_disabled",t)}init(e){document.addEventListener("keydown",this.on_input)}dispose(){document.removeEventListener("keydown",this.on_input)}}class zs{constructor(e,t,i){g(this,"shape",w.a`
        <select>
            ${Object.keys(Kt).map(e=>w.a`<option value=${e}>${e[0].toUpperCase()+e.substring(1)}</option>`)}
        </select>
    `);g(this,"aspect_ratio",w.a`<input type="number" min="0.1" max="10" step="0.1" value="1"/>`);g(this,"size",w.a`<input type="number" min="0.1" max="1" step="0.1" value=".8"/>`);g(this,"top_color",w.a`<input type="color" value="#555555"/>`);g(this,"bottom_color",w.a`<input type="color" value="#222222"/>`);g(this,"face_color",w.a`<input type="color" value="#ffffff"/>`);g(this,"front_face",w.a`<input type="text" value=""/>`);g(this,"auto_front_face",w.a`<button>frontface from thumbnail</button>`);g(this,"outline_width",w.a`<input type="range" min="0" max="0.5" step="0.01" value="0"/>`);g(this,"outline_color",w.a`<input type="color" value="#000000"/>`);g(this,"modifier",w.a`<select>${Object.keys(qt).map(e=>w.a`<option value="${e}">${e}</option>`)}<select/>`);g(this,"modifier_strength",w.a`<input type="range" min="0" max="1" step="0.01" value="0"/>`);g(this,"element",w.a`
        <div class="menu _vertical _scrollable form_container">
            <label>Shape</label> ${this.shape}
            <label>Modifier</label> ${this.modifier} ${this.modifier_strength}
            <label>Pad Aspect Ratio</label> ${this.aspect_ratio}
            <label>Pad Size</label> ${this.size}
            <label>Pad Gradient</label> ${this.top_color} ${this.bottom_color}
            <label>Outline</label> ${this.outline_color} ${this.outline_width}
            <label>Front face image</label> ${this.front_face} ${this.face_color}
            <label>
            ${this.auto_front_face}
        </div>
    `);const s=this;e.link(({to:n})=>{n.pad_shape.link(({to:o})=>s.shape.value=o),n.aspect_ratio.link(({to:o})=>s.aspect_ratio.value=o.toString()),n.size.link(({to:o})=>s.size.value=o.toString()),n.top_color.link(({to:o})=>s.top_color.value=o),n.bottom_color.link(({to:o})=>s.bottom_color.value=o),n.front_face.link(({to:o})=>s.front_face.value=o??""),n.pad_outline_color.link(({to:o})=>s.outline_color.value=o),n.pad_outline_width.link(({to:o})=>s.outline_width.value=o.toString()),n.front_face_color.link(({to:o})=>s.face_color.value=o),n.modifier.link(({to:o})=>s.modifier.value=o),n.modifier_strength.link(({to:o})=>s.modifier_strength.value=o.toString())}),this.shape.oninput=()=>e.value.pad_shape.value=this.shape.value,this.top_color.oninput=()=>e.value.top_color.value=this.top_color.value,this.bottom_color.oninput=()=>e.value.bottom_color.value=this.bottom_color.value,this.face_color.oninput=()=>e.value.front_face_color.value=this.face_color.value,this.front_face.oninput=()=>e.value.front_face.value=this.front_face.value==""?null:this.front_face.value,this.auto_front_face.onclick=async()=>{var r,d;const n=i.value;if(n.length==0)return;const o=(d=(r=t.value)==null?void 0:r.descriptor)==null?void 0:d.thumbnail;if(o==null)return;const l=new URL(o,n).href;e.value.front_face.value=l},this.aspect_ratio.oninput=()=>e.value.aspect_ratio.value=parseFloat(this.aspect_ratio.value),this.size.oninput=()=>e.value.size.value=parseFloat(this.size.value),this.outline_color.oninput=()=>e.value.pad_outline_color.value=this.outline_color.value,this.outline_width.oninput=()=>e.value.pad_outline_width.value=parseFloat(this.outline_width.value),this.modifier.oninput=()=>e.value.modifier.value=this.modifier.value,this.modifier_strength.oninput=()=>e.value.modifier_strength.value=parseFloat(this.modifier_strength.value)}init(e){}}class Is{constructor(e,t,i){g(this,"textarea",w.a`<textarea></textarea>`);g(this,"presets",w.a`
        <select>
            <option>---Select and Example---</option>
        </select>
    `);g(this,"element",w.a`
        <div class="menu _vertical _center _fill form_container">
            ${this.textarea}
            ${this.presets}
        </div>
    `);this.gui=e,this.url=t,this.library=i;for(const[s,n]of Object.entries(wt)){const o=w.a`<option value=${s}>${s}</option>`;o.onclick=()=>{this.textarea.value=JSON.stringify(n,null,2),this.load(n)},this.presets.appendChild(o)}this.textarea.onchange=()=>this.load(JSON.parse(this.textarea.value)),this.textarea.onfocus=()=>{const s=this.gui.value.save(i);t.value.length>0&&(s.wam_url=t.value),this.textarea.value=JSON.stringify(s)}}load(e){const t=this;if("wam_url"in e){let i=function(){t.gui.observable.unregister(i),t.gui.value.load(e,t.library)};t.gui.observable.register(i),this.url.value=e.wam_url}else this.gui.value.load(e,this.library)}init(e){}}class Gs{constructor(e){g(this,"element",w.a`<div class=center_top_pane></div>`);this.images=e}init(e){const t=w.a`<ul class="item_selector _grid"></ul>`;this.element.replaceChildren(t);for(let[i,s]of Object.entries(this.images)){let n=t.appendChild(w.a`
                <li value="${i}">
                    <img class="-icon" src="${s}"/>
                    <span class="-label">${i}</span>
                </li>
            `);t.appendChild(n)}}}class Os{constructor(e,t,i,s){g(this,"element",w.a`<div class=center_top_pane></div>`);this.examples=e,this.gui=t,this.url=i,this.library=s}load(e){const t=this;if("wam_url"in e){let i=function(){t.gui.observable.unregister(i),t.gui.value.load(e,t.library)};t.gui.observable.register(i),this.url.value=e.wam_url}else this.gui.value.load(e,this.library)}init(e){const t=w.a`<ul class="item_selector _grid"></ul>`;this.element.replaceChildren(t);for(let[i,s]of Object.entries(this.examples))(async()=>{const n=w.a`<div class="-icon"></div>`;n.style.contain="strict",await(await ge.create({html:{root:n,...we}})).load(s,ce);let l=t.appendChild(w.a`
                    <li value="${i}">
                        ${n}
                        <span class="-label">${i}</span>
                    </li>
                `);l.onclick=()=>this.load(s),t.appendChild(l)})()}dispose(){this.element.replaceChildren()}}function _e(a,e,t,i){const s=()=>e.value=t(a.value),n=()=>a.value=i(e.value);return a.addEventListener("input",s),e.observable.register(n),n(),()=>{a.removeEventListener("input",s),e.observable.unregister(n)}}class Ls{constructor(e,t,i,s){g(this,"element",w.a`<div class="menu _center _fill _vertical _scrollable"></div>`);g(this,"parameter");g(this,"input");g(this,"output");g(this,"event_input");g(this,"event_output");g(this,"spacing",new U(.05));g(this,"handle",new U(.2));this.wam=e,this.url=t,this.library=i,this.controls=s,this.parameter=new U(Object.values(this.controls.parameter)[0]),this.input=new U(Object.values(this.controls.input)[0]),this.output=new U(Object.values(this.controls.output)[0]),this.event_input=new U(Object.values(this.controls.event_input)[0]),this.event_output=new U(Object.values(this.controls.event_output)[0])}replace_value(e,t){for(const[i,s]of Object.entries(e))if(typeof s=="string"&&s.startsWith("[")&&s.endsWith("]")){const n=t[s.slice(1,-1)];e[i]=n}}calculate_color(e,t,i,s,n){const o=e.getImageData(t,s,i-t,n-s);let l=0,r=0,d=0,h=0;for(let c=0;c<o.data.length;c+=4)r+=o.data[c],d+=o.data[c+1],h+=o.data[c+2],l++;return r/=l,d/=l,h/=l,Qt.FromInts(r,d,h).toHexString()}async autoLayout(){const e=this.wam.value,t=(()=>{var I;const x=(I=e==null?void 0:e.descriptor)==null?void 0:I.thumbnail;return x?new URL(x,this.url.value).href:null})();let i=null;if(t){i=new Image,i.crossOrigin="anonymous";const x=new Promise(I=>i.onload=I);i.src=t??"",await x}let s=1,n=1,o=1,l=1,r=this.spacing.value,d=this.handle.value;i&&(s=i.naturalWidth/i.naturalHeight,s<1?(n=s,o=1):(n=1,o=1/s)),s>.6&&(l=.6/s);let h="#ffffff",c="#ffffff";if(i){const x=document.createElement("canvas");x.width=i.naturalWidth,x.height=i.naturalHeight;const I=x.getContext("2d");I.drawImage(i,0,0),h=this.calculate_color(I,0,x.width,0,Math.floor(x.height/2)),c=this.calculate_color(I,0,x.width,Math.floor(x.height/2),x.height)}n*=l,o*=l;const m=(1-n)/2,p=(1-o)/2;o*=1-d;let f=Object.values(await(e==null?void 0:e.audioNode.getParameterInfo())??{}).filter(x=>(console.log(x),!0)).filter(x=>x.maxValue<Number.MAX_SAFE_INTEGER&&x.minValue>Number.MIN_SAFE_INTEGER),u=1;for(let x=2;x<f.length&&!(f.length/u<=u*o/n);x++)u=x;let _=Math.ceil(f.length/u);const A=[],y=n/u,C=o/_;for(let x=0;x<f.length;x++){const I=x%u,D=Math.floor(x/u);A.push({x:m+I*y+r/2,y:p+D*C+r/2,width:y-r,height:C-r,id:f[x]})}return{ratio:s,size:l,top_color:h,bottom_color:c,thumbnail:t,parameters:A}}init(e){const t=w.a`<div class="display"></div>`;t.style.width="10rem",t.style.height="10rem",t.style.aspectRatio="1/1";const i=w.a`<input type="range" min="0.0" max="0.1" step="0.01" />`,s=w.a`<input type="range" min="0.0" max="0.5" step="0.05" />`,n=w.a`<select></select>`;for(const h of this.controls.parameter)n.appendChild(w.a`<option ${h.control}>${h.control}</option>`);const o=w.a`<select></select>`;for(const h of this.controls.input)o.appendChild(w.a`<option ${h.control}>${h.control}</option>`);const l=w.a`<select></select>`;for(const h of this.controls.output)l.appendChild(w.a`<option ${h.control}>${h.control}</option>`);this.element.replaceChildren(t,w.a`
                <div class="form_containe menu _vertical _inner">
                    <label>Spacing</label> ${i}
                    <label>Handle</label> ${s}
                    <label>Parameter</label> ${n}
                    <label>Input</label> ${o}
                    <label>Output</label> ${l}
                </div>
            `);const r=async()=>{this.builder&&this.builder.dispose();try{this.builder=ge.create({html:{root:t,...we}});const h=await this.autoLayout();if(!h)return;this.builder.size.value=h.size,this.builder.aspect_ratio.value=h.ratio,this.builder.front_face.value=h.thumbnail,this.builder.top_color.value=h.top_color,this.builder.bottom_color.value=h.bottom_color;const c=Object.values(this.library)[0];for(const{x:m,y:p,width:f,height:u}of h.parameters){const _=this.library[this.parameter.value.control],A=await this.builder.getFactory(_),y=structuredClone(this.parameter.value.values);this.replace_value(y,{color:h.top_color});const C={...structuredClone(A.getDefaultValues()),...y};this.replace_value(C,{color:h.top_color}),this.builder.addControl({control:c,x:m,y:p,width:f,height:u,values:C})}}catch(h){console.error(h)}},d=[_e(i,this.spacing,parseFloat,h=>h.toString()),_e(s,this.handle,parseFloat,h=>h.toString()),_e(n,this.parameter,h=>this.controls.parameter.find(c=>c.control==h),h=>h.control),_e(o,this.input,h=>this.controls.input.find(c=>c.control==h),h=>h.control),_e(l,this.output,h=>this.controls.output.find(c=>c.control==h),h=>h.control),this.wam.observable.add(r),this.handle.observable.register(r),this.spacing.observable.register(r),this.parameter.observable.register(r),this.input.observable.register(r),this.output.observable.register(r)];r(),this.dispose=()=>{d.forEach(h=>h()),this.element.replaceChildren(),this.builder.dispose()}}}class ks{constructor(e){g(this,"element",w.a`<div class="menu _center _fill _vertical _scrollable form_container"></div>`);g(this,"example",new U(ge.create({})));this.generator=e}init(e){const t=w.a`<button>Refresh</button>`,i=w.a`<p>...</p>`,s=w.a`<div class="display"></div>`;this.element.replaceChildren(t,i,s);const n=()=>{this.example.value.dispose();function l(r,d){for(const h of r.target)h.addEventListener("mouseenter",()=>{i.innerText=d,r.setConnected(!0)}),h.addEventListener("mouseleave",()=>{i.innerText="...",r.setConnected(!1)})}this.example.value=ge.create({wam:this.generator.value.host.wam,html:{root:s,...we,defineAnEventInput(r){l(r,"MIDI Input")},defineAnEventOutput(r){l(r,"MIDI Output")},defineAnInput(r){l(r,"Audio Input")},defineAnOutput(r){l(r,"Audio Output")},defineField(r){for(const d of r.target)d.style.cursor="pointer",d.addEventListener("mouseenter",()=>{i.innerText=`${r.getName()}: ${r.stringify(r.getValue())}`}),d.addEventListener("mouseleave",()=>{i.innerText="..."}),d.addEventListener("mousedown",h=>{const c=r.getValue(),m=1/(r.getStepCount()||1e6),p=3/(r.getStepCount()||10),f=h.clientY,u=_=>{_.preventDefault();const A=(f-_.clientY)*p;let y=c+A/100;y=Math.round(y/m)*m,y=Math.max(0,Math.min(1,y)),r.setValue(y),i.innerText=`${r.getName()}: ${r.stringify(y)}`};document.addEventListener("mousemove",u),document.addEventListener("mouseup",()=>{document.removeEventListener("mousemove",u)},{once:!0})})}}}),this.example.value.load(this.generator.value.save(ce),ce)};t.onclick=()=>n(),n();const o=[this.generator.observable.register(n)];this.dispose=()=>{o.forEach(l=>l()),this.example.value.dispose()}}}class Ts{constructor(e){g(this,"element");this.element=this.createMenu(e),this.element.classList.add("menubar")}createMenu(e){const t=document.createElement("ul");for(const i in e){const s=e[i],n=w.a`<li><span>${i}</span></li>`;typeof s=="function"?n.onclick=o=>{o.stopPropagation(),s()}:n.appendChild(this.createMenu(s)),t.appendChild(n)}return t}}function Vs(a,e,t,i){const s={},n={},o={},l={Save:n,Load:o};for(const d of t){let h=d;h=h.replaceAll("_"," "),h=h.charAt(0).toUpperCase()+h.slice(1),h=h.replace(/ [a-z]/g,c=>c.toUpperCase()),s[h]=()=>{e.addPanel({id:d,title:h,component:d})}}const r="       ".split(" ");for(const d of r)n[`Save as ${d}`]=()=>{localStorage.setItem(`3dwambuilder-layout-${d}`,JSON.stringify(e.toJSON()))};o["Load Default"]=()=>{e.fromJSON(i)};for(const d of r)o[`Load ${d}`]=()=>{const h=JSON.parse(localStorage.getItem(`3dwambuilder-layout-${d}`)??"{}");h?e.fromJSON(h):e.fromJSON(i)};a.View=s,a.Layout=l}class Ms{constructor(e,t,i,s){g(this,"element",w.a`<div class=center_top_pane></div>`);g(this,"chain",Promise.resolve());g(this,"gui");g(this,"wam");g(this,"disposeof");this.audioContext=e,this.groupId=t,this.url=i,this.target_wam=s}init(e){this.chain=this.chain.then(async()=>{this.wam&&this.gui&&(this.wam.destroyGui(this.gui),this.wam.audioNode.destroy(),this.wam=void 0,this.gui=void 0,this.element.replaceChildren());const i=await(await import(this.url)).default.createInstance(this.groupId,this.audioContext),s=await i.createGui();this.element.replaceChildren(s),this.wam=i,this.gui=s,this.disposeof=this.target_wam.link(()=>{this.target_wam.value!=null&&(this.wam.audioNode.connect(this.target_wam.value.audioNode),this.wam.audioNode.connectEvents(this.target_wam.value.instanceId))})})}dispose(){this.chain=this.chain.then(async()=>{var e;(e=this.disposeof)==null||e.call(this),this.wam&&this.gui&&(this.wam.destroyGui(this.gui),this.wam.audioNode.destroy(),this.wam=void 0,this.gui=void 0,this.element.replaceChildren())})}}class Ns{constructor(e){g(this,"element",w.a`<div class=center_top_pane></div>`);this.gui_generator=e}init(e){const t=this;this.dispose=this.gui_generator.link(async()=>{const i=w.a`<button>Debug</button>`;function s(){t.element.replaceChildren(w`
                    <span>Average Control Size: ${t.gui_generator.value.calculateAverageControlSize()}</span>
                    ${i}
                `)}i.onclick=s,s()})}}let be,Xe;try{be=new AudioContext,[Xe]=await Bt(be)}catch(a){console.error(a)}const Q=new gs(Xe,be),Mt=new fs,O=new bs(Q.wam,Mt.container),pe=new Ds(ce,O.gui_generator),Ws=new zs(O.gui_generator,Q.wam,Q.url),Rs=new Is(O.gui_generator,Q.url,ce),Hs=new Gs(ti),$s=new Os(wt,O.gui_generator,Q.url,ce),Fs=new Ls(Q.wam,Q.url,ce,ei),Bs=new ks(O.gui_generator),Us=new Ms(be,Xe,"https://mainline.i3s.unice.fr/wam2/packages/VirtualMidiKeyboardNoSound/src/index.js",Q.wam),js=new Ns(O.gui_generator),Ye=new Es(()=>Q.parameters_info);let Ae={};Q.wam.link(({to:a})=>{a==null||a.audioNode.connect(be.destination)});pe.selected.link(({to:a})=>{var t;const e=(t=pe.selected.value)==null?void 0:t.factory;e&&(Ae=e.getDefaultValues(),Ye.settings.value={title:e.label,description:e.description,settings:e.getSettings(),getValue(i){return Ae[i]},setValue(i,s){Ae[i]=s}})});O.on_select.register(({infos:a})=>{const{control:e,values:t}=a;Ye.settings.value={title:e.factory.label,settings:e.factory.getSettings(),description:e.factory.description,getValue(i){return t[i]},setValue(i,s){const n=[...O.selector.selecteds].map(o=>O.gui_generator.value.controls.values.indexOf(o.infos));for(const o of n)O.gui_generator.value.controls.setValue(o,i,s)}}});function gt(){const a=O.gui_generator.value;for(const e of O.selector.selecteds){const t=a.controls.values.indexOf(e.infos);O.gui_generator.value.controls.splice(t,1)}}async function Xs(){var i;const a=(i=pe.selected.value)==null?void 0:i.type;if(a==null)return;const e=O.gui_generator.value,t=[...O.selector.selecteds];for(const s of t)O.selector.unselect(s),e.controls.splice(e.controls.values.indexOf(s.infos),1);for(const s of t){const{infos:{x:n,y:o,width:l,height:r,values:d}}=s;await e.addControl({x:n,y:o,width:l,height:r,values:d,control:a});const h=e.controls.get(e.controls.length-1);O.selector.select({element:h.container,infos:h})}}function ft(a,e,t,i){const s=O.gui_generator.value,n=[...O.selector.selecteds].sort((m,p)=>m.infos[a]-p.infos[a]),o=Math.min(...n.map(m=>m.infos[a])),l=Math.max(...n.map(m=>m.infos[a]+m.infos[t])),r=n.map(m=>m.infos[e]+m.infos[i]/2).reduce((m,p)=>m+p,0)/n.length,d=n.map(m=>m.infos[t]).reduce((m,p)=>m+p,0),h=(l-o-d)/(n.length-1);let c=o;for(const m of n){const p=s.controls.values.indexOf(m.infos),f=r-m.infos[i]/2,u={x:0,y:0};u[a]=c,u[e]=f,s.controls.move(p,u.x,u.y),c+=h+m.infos[t]}}let Ie=new U([]);function _t(){Ie.value=[...O.selector.selecteds.values()].map(({infos:{x:a,y:e,width:t,height:i,values:s,control:n}})=>({x:a+.02,y:e+.02,width:t,height:i,values:structuredClone(s),control:O.gui_generator.value.getType(n.factory)}))}function Ys(){const a=O.gui_generator.value.controls;let e=a.length,t=Ie.value.length;O.selector.selecteds=[];for(const{x:i,y:s,width:n,height:o,values:l,control:r}of Ie.value)O.gui_generator.value.addControl({x:i,y:s,width:n,height:o,control:r,values:structuredClone(l)});O.selector.selecteds=[...a.values].slice(e,e+t).map(i=>({element:i.container,infos:i}))}const te=new Ps({id:"add",icon:"+",label:"Add Control",description:"from the palette",shortcut:[{key:"a",ctrl:!0}],action:a=>{var i;const e=O.gui_generator.value,t=(i=pe.selected.value)==null?void 0:i.type;t&&e.addControl({control:t,values:Ae,x:0,y:0,width:.1,height:.1})}},{id:"remove",icon:"",label:"Remove Controls",description:"selecteds",shortcut:[{key:"Delete"},{key:"Backspace"},{key:"x",ctrl:!0}],action:gt},{id:"replace",icon:"R",label:"Replace Controls",description:"selecteds by ones from the palette",shortcut:[{key:"r",ctrl:!0}],action:Xs},{id:"copy",icon:"",label:"Copy Controls",description:"selecteds to the clipboard",shortcut:[{key:"c",ctrl:!0}],action(){_t()}},{id:"cut",icon:"",label:"Cut Controls",description:"selecteds to the clipboard",shortcut:[{key:"x",ctrl:!0}],action(){_t(),gt()}},{id:"paste",icon:"",label:"Paste Controls",description:"from the clipboard",shortcut:[{key:"v",ctrl:!0}],action(){Ys()}},"separator",{id:"rearrange_x",icon:"",label:"Realign horizontally",description:"selecteds",action(){ft("x","y","width","height")}},{id:"rearrange_y",icon:"",label:"Realign vertically",description:"selecteds",action(){ft("y","x","height","width")}});pe.selected.link(({to:a})=>{te.setDisabled("add",a==null),te.setDisabled("replace",a==null||O.selector.selecteds.size==0)});function Ze(){const a=O.selector.selecteds.size==0;te.setDisabled("remove",a),te.setDisabled("cut",a),te.setDisabled("copy",a),te.setDisabled("replace",pe.selected.value==null||O.selector.selecteds.size==0);const e=O.selector.selecteds.size<2;te.setDisabled("rearrange_x",e),te.setDisabled("rearrange_y",e)}O.on_select.register(Ze);O.on_unselect.register(Ze);Ze();Ie.link(({to:a})=>{te.setDisabled("paste",a.length==0)});const Nt={wam_loader:Q,editor:O,view_3d:Mt,selector:pe,settings:Ye,editor_toolbar:te,wampad:Ws,load_save:Rs,images:Hs,examples:$s,autolayout:Fs,test2d:Bs,keyboard:Us,debug:js},Zs=document.getElementById("container"),Js={theme:Lt,createComponent(a){const e=Nt[a.name];if(!e)throw new Error(`Unknown component ${a.id}`);return e}},Je=ms(Zs,Js),Wt={grid:{root:{type:"branch",data:[{type:"branch",data:[{type:"leaf",data:{views:["selector"],activeView:"selector",id:"left"},size:386},{type:"leaf",data:{views:["settings","images","examples"],activeView:"settings",id:"1"},size:385.20001220703125}],size:384},{type:"branch",data:[{type:"leaf",data:{views:["editor_toolbar"],activeView:"editor_toolbar",id:"center"},size:100},{type:"leaf",data:{views:["editor"],activeView:"editor",id:"2"},size:671.2000122070312}],size:689},{type:"branch",data:[{type:"branch",data:[{type:"leaf",data:{views:["wam"],activeView:"wam",id:"right"},size:254},{type:"leaf",data:{views:["wampad","load_save"],activeView:"wampad",id:"4"},size:209}],size:386},{type:"leaf",data:{views:["3d","autolayout"],activeView:"3d",id:"3"},size:385.20001220703125}],size:463}],size:771.2000122070312},width:1536,height:771.2000122070312,orientation:"HORIZONTAL"},panels:{selector:{id:"selector",contentComponent:"selector",title:"Controls"},editor_toolbar:{id:"editor_toolbar",contentComponent:"editor_toolbar",title:"Editor Toolbar",maximumHeight:50},wam:{id:"wam",contentComponent:"wam_loader",title:"Web Audio Module"},settings:{id:"settings",contentComponent:"settings",title:"Settings"},images:{id:"images",contentComponent:"images",title:"Images"},examples:{id:"examples",contentComponent:"examples",title:"Examples"},editor:{id:"editor",contentComponent:"editor",title:"Editor"},"3d":{id:"3d",contentComponent:"view_3d",title:"3D View"},autolayout:{id:"autolayout",contentComponent:"autolayout",title:"Auto Layout"},wampad:{id:"wampad",contentComponent:"wampad",title:"Pad"},load_save:{id:"load_save",contentComponent:"load_save",title:"Load/Save"}},activeGroup:"center"};Je.fromJSON(Wt);const Rt={};Vs(Rt,Je,Object.keys(Nt),Wt);document.getElementById("menubar").replaceWith(new Ts(Rt).element);document.addEventListener("keypress",a=>{a.key=="e"&&console.log(JSON.stringify(Je.toJSON()))});
